(function(y,o){typeof exports=="object"&&typeof module<"u"?o(exports,require("@emotion/react/jsx-runtime"),require("@mui/x-date-pickers/AdapterDateFns"),require("@mui/x-date-pickers/LocalizationProvider"),require("@date-io/date-fns"),require("date-fns/locale"),require("react"),require("@mui/material"),require("react-router-dom"),require("notistack"),require("@mui/icons-material/Error"),require("@mui/material/styles"),require("@mui/material/Tooltip"),require("@mui/icons-material"),require("react-fast-compare"),require("@mui/icons-material/Close"),require("object-hash"),require("@mui/icons-material/Adjust"),require("@mui/icons-material/Functions"),require("@mui/icons-material/Crop75"),require("@mui/icons-material/ShortText"),require("@mui/icons-material/Subject"),require("@mui/icons-material/AddLink"),require("@mui/icons-material/List"),require("@mui/icons-material/Schedule"),require("@mui/icons-material/UploadFile"),require("@mui/icons-material/DriveFolderUpload"),require("@mui/icons-material/Repeat"),require("@mui/icons-material/ViewStream"),require("@mui/icons-material/ListAlt"),require("@mui/icons-material/Link"),require("@mui/icons-material/Http"),require("@mui/icons-material/Flag"),require("@mui/icons-material/Numbers"),require("@mui/icons-material/FormatListNumbered"),require("@mui/icons-material/FormatQuote"),require("@mui/icons-material/Email"),require("@mui/icons-material/BallotOutlined"),require("@mui/icons-material/InfoOutlined"),require("formik"),require("@mui/icons-material/Clear"),require("@mui/icons-material/DescriptionOutlined"),require("@mui/icons-material/OpenInNew"),require("@mui/icons-material/ContentCopy"),require("markdown-it"),require("@mui/icons-material/KeyboardTab"),require("date-fns/format"),require("react-dropzone"),require("@mui/system"),require("react-dom"),require("@mui/utils"),require("@mui/icons-material/ArrowForward"),require("@mui/icons-material/StarBorder"),require("@mui/icons-material/Star"),require("@mui/icons-material/ExpandMore"),require("@mui/icons-material/Assignment"),require("react-window"),require("react-use-measure"),require("@mui/icons-material/ArrowUpward"),require("@mui/icons-material/ArrowDownward"),require("@mui/icons-material/ArrowDropDownCircle"),require("@mui/lab"),require("@mui/icons-material/LightModeOutlined"),require("@mui/icons-material/DarkModeOutlined"),require("@mui/icons-material/NavigateNext"),require("@mui/x-date-pickers/DatePicker"),require("@mui/x-date-pickers/DateTimePicker"),require("@mui/material/Menu"),require("@mui/material/MenuItem"),require("@mui/icons-material/Remove"),require("@mui/icons-material/ArrowDropDown"),require("@mui/icons-material/Add"),require("react-markdown-editor-lite"),require("@mui/icons-material/DragHandle"),require("@hello-pangea/dnd"),require("@mui/material/Select"),require("@mui/material/InputBase"),require("@mui/material/Button"),require("yup"),require("@mui/material/colors"),require("@emotion/react"),require("@mui/icons-material/Menu"),require("@mui/material/IconButton"),require("@mui/icons-material/ChevronLeft"),require("@mui/icons-material/ChevronRight"),require("js-search"),require("@mui/icons-material/Search"),require("clsx"),require("react-image-file-resizer"),require("@mui/icons-material/GetApp"),require("@mui/material/Dialog"),require("@mui/material/DialogContent"),require("@mui/material/DialogContentText"),require("@mui/material/DialogTitle"),require("@mui/icons-material/Edit"),require("@mui/icons-material/ErrorOutline"),require("@mui/icons-material/RemoveCircle"),require("@mui/icons-material/FilterListOff"),require("firebase/auth"),require("firebase/firestore"),require("firebase/storage"),require("firebase/app"),require("firebase/app-check"),require("@mui/icons-material/ArrowBack"),require("@mui/icons-material/PersonOutline")):typeof define=="function"&&define.amd?define(["exports","@emotion/react/jsx-runtime","@mui/x-date-pickers/AdapterDateFns","@mui/x-date-pickers/LocalizationProvider","@date-io/date-fns","date-fns/locale","react","@mui/material","react-router-dom","notistack","@mui/icons-material/Error","@mui/material/styles","@mui/material/Tooltip","@mui/icons-material","react-fast-compare","@mui/icons-material/Close","object-hash","@mui/icons-material/Adjust","@mui/icons-material/Functions","@mui/icons-material/Crop75","@mui/icons-material/ShortText","@mui/icons-material/Subject","@mui/icons-material/AddLink","@mui/icons-material/List","@mui/icons-material/Schedule","@mui/icons-material/UploadFile","@mui/icons-material/DriveFolderUpload","@mui/icons-material/Repeat","@mui/icons-material/ViewStream","@mui/icons-material/ListAlt","@mui/icons-material/Link","@mui/icons-material/Http","@mui/icons-material/Flag","@mui/icons-material/Numbers","@mui/icons-material/FormatListNumbered","@mui/icons-material/FormatQuote","@mui/icons-material/Email","@mui/icons-material/BallotOutlined","@mui/icons-material/InfoOutlined","formik","@mui/icons-material/Clear","@mui/icons-material/DescriptionOutlined","@mui/icons-material/OpenInNew","@mui/icons-material/ContentCopy","markdown-it","@mui/icons-material/KeyboardTab","date-fns/format","react-dropzone","@mui/system","react-dom","@mui/utils","@mui/icons-material/ArrowForward","@mui/icons-material/StarBorder","@mui/icons-material/Star","@mui/icons-material/ExpandMore","@mui/icons-material/Assignment","react-window","react-use-measure","@mui/icons-material/ArrowUpward","@mui/icons-material/ArrowDownward","@mui/icons-material/ArrowDropDownCircle","@mui/lab","@mui/icons-material/LightModeOutlined","@mui/icons-material/DarkModeOutlined","@mui/icons-material/NavigateNext","@mui/x-date-pickers/DatePicker","@mui/x-date-pickers/DateTimePicker","@mui/material/Menu","@mui/material/MenuItem","@mui/icons-material/Remove","@mui/icons-material/ArrowDropDown","@mui/icons-material/Add","react-markdown-editor-lite","@mui/icons-material/DragHandle","@hello-pangea/dnd","@mui/material/Select","@mui/material/InputBase","@mui/material/Button","yup","@mui/material/colors","@emotion/react","@mui/icons-material/Menu","@mui/material/IconButton","@mui/icons-material/ChevronLeft","@mui/icons-material/ChevronRight","js-search","@mui/icons-material/Search","clsx","react-image-file-resizer","@mui/icons-material/GetApp","@mui/material/Dialog","@mui/material/DialogContent","@mui/material/DialogContentText","@mui/material/DialogTitle","@mui/icons-material/Edit","@mui/icons-material/ErrorOutline","@mui/icons-material/RemoveCircle","@mui/icons-material/FilterListOff","firebase/auth","firebase/firestore","firebase/storage","firebase/app","firebase/app-check","@mui/icons-material/ArrowBack","@mui/icons-material/PersonOutline"],o):(y=typeof globalThis<"u"?globalThis:y||self,o(y.FireCMS={},y.jsxRuntime,y.AdapterDateFns,y.LocalizationProvider,y.DateFnsUtils,y.locales,y.React,y.material,y.reactRouterDom,y.notistack,y.ErrorIcon,y.styles$1,y.Tooltip,y.mui,y.equal,y.CloseIcon,y.hash,y.AdjustIcon,y.FunctionsIcon,y.Crop75Icon,y.ShortTextIcon,y.SubjectIcon,y.AddLinkIcon,y.ListIcon,y.ScheduleIcon,y.UploadFileIcon,y.DriveFolderUploadIcon,y.RepeatIcon,y.ViewStreamIcon,y.ListAltIcon,y.LinkIcon,y.HttpIcon,y.FlagIcon,y.NumbersIcon,y.FormatListNumberedIcon,y.FormatQuoteIcon,y.EmailIcon,y.BallotOutlinedIcon,y.InfoIcon,y.formik,y.ClearIcon,y.DescriptionOutlinedIcon,y.OpenInNewIcon,y.CopyIcon,y.MarkdownIt,y.KeyboardTabIcon,y.format,y.reactDropzone,y.system,y.ReactDOM,y.utils,y.ArrowForwardIcon,y.StarBorderIcon,y.StarIcon,y.ExpandMoreIcon,y.AssignmentIcon,y.reactWindow,y.useMeasure,y.ArrowUpwardIcon,y.ArrowDownwardIcon,y.ArrowDropDownCircleIcon,y.lab,y.LightModeOutlinedIcon,y.DarkModeOutlinedIcon,y.NavigateNextIcon,y.DatePicker,y.DateTimePicker,y.Menu,y.MenuItem,y.RemoveIcon,y.ArrowDropDownIcon,y.AddIcon,y.MdEditor,y.DragHandleIcon,y.dnd,y.Select,y.InputBase,y.Button,y.yup,y.colors,y.react,y.MenuIcon,y.IconButton,y.ChevronLeftIcon,y.ChevronRightIcon,y.JsSearch,y.SearchIcon,y.clsx,y.Resizer,y.GetAppIcon,y.Dialog,y.DialogContent,y.DialogContentText,y.DialogTitle,y.EditIcon,y.ErrorOutlineIcon,y.RemoveCircleIcon,y.FilterListOffIcon,y.auth,y.firestore,y.storage,y.app,y.appCheck,y.ArrowBackIcon,y.PersonOutlineIcon))})(this,function(y,o,js,qs,Js,Zs,A,c,fe,ft,zn,be,ht,Be,Ae,Xs,gt,Ks,Rs,el,ol,nl,rl,tl,il,sl,ll,pt,al,cl,bt,dl,Al,ul,vt,fl,yt,wt,hl,me,Ge,gl,To,Yn,xt,Nn,pl,Ct,Ro,bl,Do,vl,Bt,Et,yl,wl,xl,Un,mt,Cl,Bl,El,ml,kl,Sl,Hn,_n,kt,De,en,St,Ft,Re,Fl,fo,Il,It,Po,Tl,on,Dl,Pl,Tt,Ml,Ql,Ol,Gl,Ll,$l,Vl,Wl,zl,Dt,Yl,Nl,Ul,Hl,_l,ee,X,Ue,jl,nn,jn,ql){"use strict";function ho(e){const n=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(e){for(const r in e)if(r!=="default"){const t=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(n,r,t.get?t:{enumerable:!0,get:()=>e[r]})}}return n.default=e,Object.freeze(n)}const Pt=ho(Zs),Ee=ho(A),qn=ho(Be),Jl=ho(bl),ke=ho(Tl),Zl=ho(Ol),Xl={breadcrumbs:[],set:e=>{}},Mt=A.createContext(Xl),Kl=({children:e})=>{const[n,r]=A.useState([]),t=i=>{r(i.breadcrumbs)};return o.jsx(Mt.Provider,{value:{breadcrumbs:n,set:t},children:e})},Rl={mode:"light",setMode:e=>{},toggleMode:()=>{}},Jn=A.createContext(Rl),Qt=Jn.Provider;function ge(e){return Ot(Gt(e))}function Ot(e){return e.startsWith("/")?e.slice(1):e}function Gt(e){return e.endsWith("/")?e.slice(0,-1):e}function ea(e){return e.startsWith("/")?e:`/${e}`}function oa(e){const n=ge(e);if(n.includes("/")){const r=n.split("/");return r[r.length-1]}return n}function Zn(e,n){const r=ge(e),t=r.split("/");if(t.length%2===0)throw Error(`Collection paths must have an odd number of segments: ${e}`);const i=n.find(l=>l.alias===t[0]);let s;if(i&&(s=i.path),t.length>1){const l=rn(s??t[0],n);if(!l?.subcollections)return r;const a=r.split("/").slice(2).join("/");return(s??t[0])+"/"+t[1]+"/"+Zn(a,l.subcollections)}else return s??r}function rn(e,n){const r=ge(e).split("/");if(r.length%2===0)throw Error(`Collection paths must have an odd number of segments: ${e}`);const t=tn(r);let i;for(let s=0;s<t.length;s++){const l=t[s],a=n&&n.sort((d,u)=>(d.alias??"").localeCompare(u.alias??"")).find(d=>d.alias===l||d.path===l);if(a){if(l===e)i=a;else if(a.subcollections){const d=e.replace(l,"").split("/").slice(2).join("/");d.length>0&&(i=rn(d,a.subcollections))}}if(i)break}return i}function tn(e){const n=e.length>0&&e.length%2===0?e.splice(0,e.length-1):e,r=n.length,t=[];for(let i=r;i>0;i=i-2)t.push(n.slice(0,i).join("/"));return t}function Xn(e){const{path:n,collections:r=[],currentFullPath:t}=e,i=ge(n).split("/"),s=tn(i),l=[];for(let a=0;a<s.length;a++){const d=s[a],u=r&&r.find(f=>f.alias===d||f.path===d);if(u){const f=u.alias??u.path,h=t&&t.length>0?t+"/"+f:f;l.push({type:"collection",path:h,collection:u});const b=ge(ge(n).replace(d,"")),p=b.length>0?b.split("/"):[];if(p.length>0){const g=p[0],v=h+"/"+g;if(l.push({type:"entity",entityId:g,path:h,parentCollection:u}),p.length>1){const w=p.slice(1).join("/");if(!u)throw Error("collection not found resolving path: "+u);const E=u.views,x=E&&E.find(m=>m.path===w);if(x){const m=t&&t.length>0?t+"/"+x.path:x.path;l.push({type:"custom_view",path:m,view:x})}else u.subcollections&&l.push(...Xn({path:w,customViews:E,collections:u.subcollections,currentFullPath:v}))}}break}}return l}const go="100vw",sn="55vw",ln="700px",Lt=A.createContext({}),Fe=()=>A.useContext(Lt),$t=A.createContext({}),pe=()=>A.useContext($t),Vt=A.createContext({}),eo=()=>A.useContext(Vt),Wt=A.createContext({}),Mo=()=>A.useContext(Wt),zt=A.createContext({}),He=()=>A.useContext(zt),Yt=A.createContext({}),po=()=>A.useContext(Yt),_e=()=>{const{enqueueSnackbar:e,closeSnackbar:n}=ft.useSnackbar();return{open:A.useCallback(t=>{const{type:i,message:s,autoHideDuration:l}=t;e({message:s,variant:i,autoHideDuration:l})},[]),close:n}},Nt=A.createContext(void 0),bo=()=>A.useContext(Nt),Kn=A.createContext({sideDialogsController:{},sideEntityController:{},navigation:{},dataSource:{},storageSource:{},authController:{},snackbarController:{},fields:{}}),oe=()=>{const e=A.useContext(Kn),n=eo(),r=Mo(),t=He(),i=pe(),s=Fe(),l=po(),a=_e(),d=bo();return{...e,authController:n,sideDialogsController:r,sideEntityController:t,navigation:i,dataSource:s,storageSource:l,snackbarController:a,userConfigPersistence:d}};function Ut({path:e,collection:n,filterValues:r,sortBy:t,itemCount:i,searchString:s}){const l=Fe(),d=pe().resolveAliasesFrom(e),u=t?t[0]:void 0,f=t?t[1]:void 0,h=oe(),[b,p]=A.useState([]),[g,v]=A.useState(!1),[w,E]=A.useState(),[x,m]=A.useState(!1);return A.useEffect(()=>{v(!0);const C=async S=>{if(n.callbacks?.onFetch)try{S=await Promise.all(S.map(k=>n.callbacks.onFetch({collection:n,path:d,entity:k,context:h})))}catch(k){console.error(k)}v(!1),E(void 0),p(S),m(!i||S.length<i)},B=S=>{console.error("ERROR",S),v(!1),p([]),E(S)};return l.listenCollection?l.listenCollection({path:d,collection:n,onUpdate:C,onError:B,searchString:s,filter:r,limit:i,startAfter:void 0,orderBy:u,order:f}):(l.fetchCollection({path:d,collection:n,searchString:s,filter:r,limit:i,startAfter:void 0,orderBy:u,order:f}).then(C).catch(B),()=>{})},[d,i,f,u,r,s]),{data:b,dataLoading:g,dataLoadingError:w,noMoreToLoad:x}}const Rn={};function an({path:e,entityId:n,collection:r,useCache:t=!1}){const i=Fe(),l=pe().resolveAliasesFrom(e),a=oe(),[d,u]=A.useState(),[f,h]=A.useState(!0),[b,p]=A.useState();return A.useEffect(()=>{h(!0);const g=async w=>{if(r.callbacks?.onFetch&&w)try{w=await r.callbacks.onFetch({collection:r,path:l,entity:w,context:a})}catch(E){console.error(E)}Rn[`${l}/${n}`]=w,u(w),h(!1),p(void 0)},v=w=>{console.error("ERROR fetching entity",w),h(!1),u(void 0),p(w)};return n&&t&&Rn[`${l}/${n}`]?(u(Rn[`${l}/${n}`]),h(!1),p(void 0),()=>{}):n&&l&&r?i.listenEntity?i.listenEntity({path:l,entityId:n,collection:r,onUpdate:g,onError:v}):(i.fetchEntity({path:l,entityId:n,collection:r}).then(g).catch(v),()=>{}):(g(void 0),()=>{})},[n,l]),{entity:d,dataLoading:f,dataLoadingError:b}}async function er({collection:e,path:n,entityId:r,values:t,previousValues:i,status:s,dataSource:l,context:a,onSaveSuccess:d,onSaveFailure:u,onPreSaveHookError:f,onSaveSuccessHookError:h}){let b;const p=a.navigation.resolveAliasesFrom(n),g=e.callbacks;if(g?.onPreSave)try{const v=ve({collection:e,path:n,values:i,entityId:r,fields:a.fields});b=await g.onPreSave({collection:v,path:n,resolvedPath:p,entityId:r,values:t,previousValues:i,status:s,context:a})}catch(v){console.error(v),f&&f(v);return}else b=t;return l.saveEntity({collection:e,path:p,entityId:r,values:b,previousValues:i,status:s}).then(v=>{try{if(g?.onSaveSuccess){const w=ve({collection:e,path:n,values:b,entityId:r,fields:a.fields});g.onSaveSuccess({collection:w,path:n,resolvedPath:p,entityId:v.id,values:b,previousValues:i,status:s,context:a})}}catch(w){h&&h(w)}d&&d(v)}).catch(v=>{if(g?.onSaveFailure){const w=ve({collection:e,path:n,values:b,entityId:r,fields:a.fields});g.onSaveFailure({collection:w,path:n,resolvedPath:p,entityId:r,values:b,previousValues:i,status:s,context:a})}u&&u(v)})}async function Ht({dataSource:e,entity:n,collection:r,callbacks:t,onDeleteSuccess:i,onDeleteFailure:s,onPreDeleteHookError:l,onDeleteSuccessHookError:a,context:d}){console.debug("Deleting entity",n.path,n.id);const u={entity:n,collection:r,entityId:n.id,path:n.path,context:d};if(t?.onPreDelete)try{await t.onPreDelete(u)}catch(f){return console.error(f),l&&l(n,f),!1}return e.deleteEntity({entity:n}).then(()=>{i&&i(n);try{return t?.onDelete&&t.onDelete(u),!0}catch(f){return a&&a(n,f),!1}}).catch(f=>(s&&s(n,f),!1))}function Se({property:e,value:n,setValue:r}){const t=A.useRef(null);A.useEffect(()=>{typeof e.disabled=="object"&&!!e.disabled.clearOnDisabled?n!=null&&(t.current=n,r(null)):t.current&&(r(t.current),t.current=null)},[e])}function _t({path:e,context:n}){const r=n.dataSource,t=n.navigation;if(!t)throw Error("Calling getNavigationFrom, but main navigation has not yet been initialised");const s=Xn({path:e,collections:t.collections??[]}).map(l=>{if(l.type==="collection")return Promise.resolve(l);if(l.type==="entity"){const a=t.getCollection(l.path,l.entityId);if(!a)throw Error(`No collection defined in the navigation for the entity with path ${l.path}`);return r.fetchEntity({path:l.path,entityId:l.entityId,collection:a}).then(d=>{if(d)return{...l,entity:d}})}else{if(l.type==="custom_view")return Promise.resolve(l);throw Error("Unmapped element in useEntitiesFromPath")}}).filter(l=>!!l);return Promise.all(s)}function na({path:e}){const n=oe(),[r,t]=A.useState(),[i,s]=A.useState(!1),[l,a]=A.useState();return A.useEffect(()=>{n.navigation&&(s(!0),a(void 0),_t({path:e,context:n}).then(u=>{t(u)}).catch(u=>a(u)).finally(()=>s(!1)))},[e,n]),n.navigation?{data:r,dataLoading:i,dataLoadingError:l}:{dataLoading:!0}}const cn=()=>A.useContext(Jn),jt=e=>{const{onSuccess:n,onError:r,disableClipboardAPI:t=!1,copiedDuration:i}=e||{},s=A.useRef(null),[l,a]=A.useState(!1),[d,u]=A.useState("");A.useEffect(()=>{i&&setTimeout(()=>a(!1),i)},[l]);const f=()=>navigator.clipboard!==void 0,h=A.useCallback(x=>{if(r)r(x);else throw new Error(x)},[r]),b=A.useCallback(x=>{n&&n(x),a(!0),u(x)},[n]),p=A.useCallback(x=>{navigator.clipboard.writeText(x).then(()=>b(x)).catch(m=>{h(m),a(!1)})},[h,b]),g=()=>{f()&&navigator.clipboard.writeText("")},v=x=>E("copy",typeof x=="object"?void 0:x),w=()=>E("cut"),E=A.useCallback((x="copy",m)=>{const C=s.current,B=C&&(C.tagName==="INPUT"||C.tagName==="TEXTAREA"),S=s.current;f()&&!t&&(m?p(m):C?B?(p(S.value),x==="cut"&&(S.value="")):p(C.innerText):h("Both the ref & text were undefined"))},[t,p,h]);return{ref:s,isCoppied:l,clipboard:d,clearClipboard:g,isSupported:f,copy:v,cut:w}},dn=()=>A.useContext(Mt);function Qo(e){const n=pe(),r=Mo(),t=A.useCallback(()=>{if(e.path){let s=e.collection;if(s||(s=n.getCollection(e.path)),!s)throw Error("Not able to resolve the collection in useReferenceDialog");r.open({key:`reference_${e.path}`,component:o.jsx(gs,{collection:s,...e}),width:"90vw",onClose:()=>{e.onClose?.()}})}else throw Error("useReferenceDialog: You are trying to open a reference dialog, but have not declared the `path`")},[n,e,r]),i=A.useCallback(()=>{r.close()},[r]);return{open:t,close:i}}const ra=`data:image/png;base64,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
`;function qt(e,n){A.useEffect(()=>{if(document){document.title=`${e} - FireCMS`;let r=document.querySelector("link[rel~='icon']");r||(r=document.createElement("link"),r.rel="icon",document.getElementsByTagName("head")[0].appendChild(r)),r.href=n??ra}},[e,n])}const Jt=be.styled(({className:e,...n})=>o.jsx(c.Tooltip,{...n,classes:{popper:e}}))(({theme:e})=>({[`& .${ht.tooltipClasses.tooltip}`]:{margin:"0 8px",backgroundColor:e.palette.error.light},[`& .${ht.tooltipClasses.arrow}`]:{color:e.palette.error.light}}));function ue({title:e,error:n,tooltip:r}){const t=n instanceof Error?n.message:n,i=o.jsxs(c.Box,{sx:{display:"flex",alignItems:"center",margin:1},children:[o.jsx(zn,{fontSize:"small",color:"error"}),o.jsxs(c.Box,{sx:{paddingLeft:2},children:[e&&o.jsx(c.Typography,{variant:"body2",sx:{fontWeight:"500"},children:e}),o.jsx(c.Typography,{variant:"body2",children:t})]})]});return r?o.jsx(Jt,{title:r,children:i}):i}class Pe{id;path;constructor(n,r){this.id=n,this.path=r}get pathWithId(){return`${this.path}/${this.id}`}}class Oo{latitude;longitude;constructor(n,r){this.latitude=n,this.longitude=r}}function vo(){return o.jsx(c.Box,{sx:{borderRadius:"9999px",backgroundColor:"rgba(128,128,128,0.1)",width:"18px",height:"6px",display:"inline-block"}})}const ta=40,ia=100,sa=200;function yo(e){if(e==="tiny")return ta;if(e==="small")return ia;if(e==="regular")return sa;throw Error("Thumbnail size not mapped")}function oo(e){switch(e){case"xs":case"s":return"tiny";case"m":return"small";case"l":case"xl":return"regular";default:throw Error("Missing mapping value in getPreviewSizeFrom")}}function Zt({size:e,url:n}){const[r,t]=A.useState(!1),i=A.useMemo(()=>yo(e),[e]),s=c.useTheme();if(e==="tiny")return o.jsx("img",{src:n,style:{position:"relative",objectFit:"cover",width:i,height:i,borderRadius:s.shape.borderRadius,maxHeight:"100%"}},"tiny_image_preview_"+n);const l={maxWidth:"100%",maxHeight:"100%",borderRadius:s.shape.borderRadius};return o.jsxs(c.Box,{sx:{position:"relative",maxWidth:"100%",maxHeight:"100%",display:"flex",alignItems:"center",justifyContent:"center",width:i,height:i},onMouseEnter:()=>t(!0),onMouseMove:()=>t(!0),onMouseLeave:()=>t(!1),children:[o.jsx("img",{src:n,style:l}),r&&o.jsxs(o.Fragment,{children:[navigator&&o.jsx(c.Tooltip,{title:"Copy url to clipboard",children:o.jsx(c.Box,{sx:{borderRadius:"9999px",position:"absolute",bottom:-4,right:32,backgroundColor:s.palette.background.default},children:o.jsx(c.IconButton,{size:"small",onClick:a=>(a.stopPropagation(),navigator.clipboard.writeText(n)),children:o.jsx(Yn,{htmlColor:"#666",fontSize:"small"})})})}),o.jsx(c.Tooltip,{title:"Open image in new tab",children:o.jsx("a",{style:{borderRadius:"9999px",position:"absolute",bottom:-4,right:-4,backgroundColor:s.palette.background.default},href:n,rel:"noopener noreferrer",target:"_blank",children:o.jsx(c.IconButton,{size:"small",onClick:a=>a.stopPropagation(),children:o.jsx(To,{htmlColor:"#666",fontSize:"small"})})})})]})]},"image_preview_"+n)}function Go({url:e,previewType:n,size:r,hint:t}){return n?n==="image"?o.jsx(Zt,{url:e,size:r}):n==="audio"?o.jsxs("audio",{controls:!0,src:e,children:["Your browser does not support the",o.jsx("code",{children:"audio"})," element."]}):n==="video"?o.jsx(c.CardMedia,{sx:{maxWidth:r==="small"?300:500},component:"video",controls:!0,image:e}):o.jsxs(c.Box,{component:"a",href:e,rel:"noopener noreferrer",target:"_blank",onClick:i=>i.stopPropagation(),sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",width:yo(r),height:yo(r)},children:[o.jsx(gl,{sx:{flexGrow:1}}),t&&o.jsx(c.Tooltip,{title:t,children:o.jsx(c.Typography,{sx:{maxWidth:"100%",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",direction:"rtl",textAlign:"left"},variant:"caption",children:t})})]}):o.jsxs(c.Link,{sx:i=>({display:"flex",wordBreak:"break-word",alignItems:"center",fontWeight:i.typography.fontWeightMedium}),href:e,onMouseDown:i=>{i.preventDefault()},target:"_blank",children:[o.jsx(To,{style:{marginRight:8},fontSize:"small"}),e]})}function no({property:e,size:n}){e||console.error("No property assigned for skeleton component",e,n);let r;if(e.dataType==="string"){const t=e;t.url?r=ua(t,n):t.storage?r=nr(n):r=Le()}else if(e.dataType==="array"){const t=e;t.of&&(Array.isArray(t.of)?r=o.jsxs(o.Fragment,{children:[t.of.map((i,s)=>or(i,s))," "]}):t.of.dataType==="map"&&t.of.properties?r=aa(t.of.properties,n,t.of.previewProperties):t.of.dataType==="string"?t.of.enumValues?r=da():t.of.storage?r=or(t.of):r=ca():r=or(t.of))}else e.dataType==="map"?r=la(e,n):e.dataType==="date"?r=Le():e.dataType==="reference"?r=Aa():(e.dataType,r=Le());return r||null}function la(e,n){if(!e.properties)return o.jsx(o.Fragment,{});let r;return n==="regular"?r=Object.keys(e.properties):(r=e.previewProperties||Object.keys(e.properties),n==="small"?r=r.slice(0,3):n==="tiny"&&(r=r.slice(0,1))),n!=="regular"?o.jsx(c.Box,{sx:t=>({width:"100%",display:"flex",flexDirection:"column","& > *":{[t.breakpoints.down("md")]:{marginBottom:`${t.spacing(.5)} !important`},marginBottom:`${t.spacing(1)} !important`}}),children:r.map((t,i)=>o.jsx("div",{children:e.properties&&e.properties[t]&&o.jsx(no,{property:e.properties[t],size:"small"})},`map_${t}`))}):o.jsx(c.Table,{size:"small",children:o.jsx(c.TableBody,{children:r&&r.map((t,i)=>o.jsxs(c.TableRow,{sx:{"&:last-child th, &:last-child td":{borderBottom:0}},children:[o.jsx(c.TableCell,{sx:{verticalAlign:"top"},width:"30%",component:"th",children:o.jsx(c.Typography,{variant:"caption",color:"textSecondary",children:e.properties[t].name})},`table-cell-title--${t}`),o.jsx(c.TableCell,{width:"70%",component:"th",children:e.properties&&e.properties[t]&&o.jsx(no,{property:e.properties[t],size:"small"})},`table-cell-${t}`)]},`map_preview_table__${i}`))})})}function aa(e,n,r){let t=r;return(!t||!t.length)&&(t=Object.keys(e),n&&(t=t.slice(0,3))),o.jsx(c.Table,{size:"small",children:o.jsx(c.TableBody,{children:[0,1,2].map((i,s)=>o.jsx(c.TableRow,{children:t&&t.map(l=>o.jsx(c.TableCell,{component:"th",children:o.jsx(no,{property:e[l],size:"small"})},`table-cell-${l}`))},`table_${i}_${s}`))})})}function ca(){return o.jsx(c.Grid,{children:[0,1].map((e,n)=>Le(n))})}function da(){return o.jsx(c.Grid,{children:[0,1].map((e,n)=>o.jsx(o.Fragment,{children:Le(n)}))})}function or(e,n=0){return o.jsx(c.Grid,{children:[0,1].map((r,t)=>o.jsx(o.Fragment,{children:o.jsx(no,{property:e,size:"small"},`i_${t}`)}))},"array_index")}function nr(e){const n=e==="tiny"?40:e==="small"?100:200;return o.jsx(c.Skeleton,{variant:"rectangular",sx:r=>({borderRadius:`${r.shape.borderRadius}px`}),width:n,height:n})}function Aa(){return o.jsx(c.Skeleton,{variant:"rectangular",width:200,height:100})}function ua(e,n="regular"){return typeof e.url=="boolean"?o.jsxs("div",{style:{display:"flex"},children:[rr(),Le()]}):fa(n)}function fa(e){return o.jsx(c.Box,{sx:{width:yo(e),height:yo(e)},children:rr()})}function Le(e){return o.jsx(c.Skeleton,{variant:"text"},`skeleton_${e}`)}function ha(e){return o.jsx(c.Skeleton,{height:20,variant:"text"})}function rr(){return o.jsx(c.Skeleton,{variant:"rectangular",width:24,height:24})}const Xt=A.memo(Rt,ga);function ga(e,n){return e.size===n.size&&e.storagePathOrDownloadUrl===n.storagePathOrDownloadUrl&&e.storeUrl===n.storeUrl}const Kt={};function Rt({storeUrl:e,storagePathOrDownloadUrl:n,size:r}){const t=po(),[i,s]=A.useState(Kt[n]);if(A.useEffect(()=>{if(!n)return;let d=!1;return t.getDownloadURL(n).then(function(u){d||(s(u),Kt[n]=u)}),()=>{d=!0}},[n]),!n)return null;const l=i?.metadata?pa(i?.metadata.contentType):void 0,a=l?.startsWith("image")?"image":l?.startsWith("video")?"video":l?.startsWith("audio")?"audio":"file";return i?o.jsx(Go,{previewType:a,url:i.url,size:r,hint:n}):nr(r)}function pa(e){return e.startsWith("image")?"image/*":e.startsWith("video")?"video/*":e.startsWith("audio")?"audio/*":e.startsWith("application")?"application/*":e.startsWith("text")?"text/*":e.startsWith("font")?"font/*":e}const ba=new xt({html:!0}),An=A.memo(function({source:n}){const r=A.useMemo(()=>ba.render(typeof n=="string"?n:""),[n]);return o.jsx("div",{dangerouslySetInnerHTML:{__html:r}})},va);function va(e,n){return e.source===n.source}function ei(e){let n=0,r,t;for(r=0;r<e.length;r++)t=e.charCodeAt(r),n=(n<<5)-n+t,n|=0;return Math.abs(n)}const tr={blueLighter:{color:"#cfdfff",text:"#102046"},cyanLighter:{color:"#d0f0fd",text:"#04283f"},tealLighter:{color:"#c2f5e9",text:"#012524"},greenLighter:{color:"#d1f7c4",text:"#0b1d05"},yellowLighter:{color:"#ffeab6",text:"#3b2501"},orangeLighter:{color:"#fee2d5",text:"#6b2613"},redLighter:{color:"#ffdce5",text:"#4c0c1c"},pinkLighter:{color:"#ffdaf6",text:"#400832"},purpleLighter:{color:"#ede2fe",text:"#280b42"},grayLighter:{color:"#eee",text:"#040404"},blueLight:{color:"#9cc7ff",text:"#102046"},cyanLight:{color:"#77d1f3",text:"#04283f"},tealLight:{color:"#72ddc3",text:"#012524"},greenLight:{color:"#93e088",text:"#0b1d05"},yellowLight:{color:"#ffd66e",text:"#3b2501"},orangeLight:{color:"#ffa981",text:"#6b2613"},redLight:{color:"#ff9eb7",text:"#4c0c1c"},pinkLight:{color:"#f99de2",text:"#400832"},purpleLight:{color:"#cdb0ff",text:"#280b42"},grayLight:{color:"#ccc",text:"#040404"},blueDark:{color:"#2d7ff9",text:"#fff"},cyanDark:{color:"#18bfff",text:"#fff"},tealDark:{color:"#20d9d2",text:"#fff"},greenDark:{color:"#20c933",text:"#fff"},yellowDark:{color:"#fcb400",text:"#fff"},orangeDark:{color:"#ff6f2c",text:"#fff"},redDark:{color:"#f82b60",text:"#fff"},pinkDark:{color:"#ff08c2",text:"#fff"},purpleDark:{color:"#8b46ff",text:"#fff"},grayDark:{color:"#666",text:"#fff"},blueDarker:{color:"#2750ae",text:"#cfdfff"},cyanDarker:{color:"#0b76b7",text:"#d0f0fd"},tealDarker:{color:"#06a09b",text:"#c2f5e9"},greenDarker:{color:"#338a17",text:"#d1f7c4"},yellowDarker:{color:"#b87503",text:"#ffeab6"},orangeDarker:{color:"#d74d26",text:"#fee2d5"},redDarker:{color:"#ba1e45",text:"#ffdce5"},pinkDarker:{color:"#b2158b",text:"#ffdaf6"},purpleDarker:{color:"#6b1cb0",text:"#ede2fe"},grayDarker:{color:"#444",text:"#eee"}};function ir(e){const n=ei(e),r=Object.keys(tr),t=n%r.length;return tr[r[t]]}function un(e){return Array.isArray(e)?e:Object.entries(e).map(([n,r])=>typeof r=="string"?{id:n,label:r}:{...r,id:n})}function oi(e,n){if(n)return e.find(r=>r.id===n)}function ya(e,n){const r=oi(e,n);if(!r?.color)return ir(n.toString());if(typeof r=="object"&&"color"in r){if(typeof r.color=="string")return tr[r.color];if(typeof r.color=="object")return r.color}}function fn(e){return typeof e=="object"&&e.disabled}function wa(e){if(e!==void 0)return typeof e=="object"?e.label:e}function Ie({enumValues:e,enumKey:n,small:r}){if(!e)return null;const t=un(e),i=n!==void 0?oi(t,n):void 0,s=wa(i),l=ya(t,n);return o.jsx(sr,{colorScheme:l,label:s!==void 0?s:n,error:!s,outlined:!1,small:r})}function sr({label:e,colorScheme:n,error:r,outlined:t,small:i}){const s=c.useTheme(),l=n??ir(e);return o.jsx(c.Chip,{sx:{maxWidth:"100%",backgroundColor:r||!l?"#eee":l.color,color:r||!l?"red":l.text,fontWeight:s.typography.fontWeightRegular},size:i?"small":"medium",variant:t?"outlined":"filled",label:e})}function lr({propertyKey:e,value:n,property:r,size:t}){if(r.enumValues){const i=n,s=Pr(r);return o.jsx(Ie,{enumKey:i,enumValues:s.enumValues,small:t!=="regular"})}else if(r.previewAsTag){const i=ir(e??"");return o.jsx(re,{children:o.jsx(sr,{colorScheme:i,label:n,small:t!=="regular"})})}else{if(r.url)return o.jsx(Go,{size:t,url:n,previewType:typeof r.url=="string"?r.url:void 0});{if(!n)return o.jsx(o.Fragment,{});const i=n.split(`
`);return n&&n.includes(`
`)?o.jsx("div",{children:i.map((s,l)=>o.jsxs(A.Fragment,{children:[o.jsx("span",{children:s}),l!==i.length-1&&o.jsx("br",{})]},`string_preview_${l}`))}):o.jsx(o.Fragment,{children:n})}}}function ni({propertyKey:e,value:n,property:r,size:t,entity:i}){const s=oe(),l=Je({propertyKey:e,property:r,propertyValue:n,fields:s.fields});if(Array.isArray(l?.of))throw Error("Using array properties instead of single one in `of` in ArrayProperty");if(l?.dataType!=="array"||!l.of||l.of.dataType!=="map")throw Error("Picked wrong preview component ArrayOfMapsPreview");const a=l.of,d=a.properties;if(!d)throw Error(`You need to specify a 'properties' prop (or specify a custom field) in your map property ${e}`);const u=n,f=a.previewProperties;if(!u)return null;let h=f;return(!h||!h.length)&&(h=Object.keys(d),t&&(h=h.slice(0,3))),o.jsx(c.Table,{size:"small",children:o.jsx(c.TableBody,{children:u&&u.map((b,p)=>o.jsx(c.TableRow,{sx:{"&:last-child th, &:last-child td":{borderBottom:0}},children:h&&h.map(g=>o.jsx(c.TableCell,{component:"th",children:o.jsx(re,{children:o.jsx(we,{propertyKey:g,value:b[g],property:d[g],entity:i,size:"small"})})},`table-cell-${g}`))},`table_${b}_${p}`))})})}function ar({propertyKey:e,value:n,property:r,entity:t,size:i}){const s=oe(),l=Je({propertyKey:e,property:r,propertyValue:n,fields:s.fields});if(!l.of)throw Error(`You need to specify an 'of' prop (or specify a custom field) in your array property ${e}`);if(l.dataType!=="array")throw Error("Picked wrong preview component ArrayPreview");const a=n;if(!a)return null;const d=i==="regular"?"small":"tiny";return o.jsx(c.Box,{sx:{display:"flex",flexDirection:"column"},children:a&&a.map((u,f)=>{const h=l.resolvedProperties[f]??l.resolvedProperties[f]??(Array.isArray(l.of)?l.of[f]:l.of);return h?o.jsxs(A.Fragment,{children:[o.jsx(c.Box,{sx:{margin:1},children:o.jsx(re,{children:o.jsx(we,{propertyKey:e,entity:t,value:u,property:h,size:d})})}),f<a.length-1&&o.jsx(c.Divider,{})]},"preview_array_"+u+"_"+f):null})})}const Oe=e=>e.palette.mode==="light"?"rgb(238 238 240)":"rgb(39 39 41)",ro=e=>e.palette.mode==="light"?"rgb(232 232 234)":"rgb(49,49,50)",xa=e=>e.palette.mode==="light"?"rgb(224 224 226)":"rgb(47 47 49)",ri=e=>e.palette.mode==="light"?"rgb(248 248 249)":"rgb(21 21 23)",je=Ee.memo(Ba,Ca);function Ca(e,n){return e.disabled===n.disabled&&e.size===n.size&&e.onHover===n.onHover&&e.reference?.id===n.reference?.id&&e.reference?.path===n.reference?.path&&e.allowEntityNavigation===n.allowEntityNavigation}function Ba({disabled:e,reference:n,previewProperties:r,size:t,onHover:i,onClick:s,allowEntityNavigation:l=!0}){const a=oe(),d=pe(),u=He(),f=d.getCollection(n.path);if(!f)throw Error(`Couldn't find the corresponding collection view for the path: ${n.path}`);const{entity:h,dataLoading:b,dataLoadingError:p}=an({path:n.path,entityId:n.id,collection:f,useCache:!0});h&&ti.set(n.pathWithId,h);const g=h??ti.get(n.pathWithId),v=A.useMemo(()=>ve({collection:f,path:n.path,values:g?.values,fields:a.fields}),[f]),w=A.useMemo(()=>Wr(v,a.fields,r,t==="small"||t==="regular"?3:1),[r,v,t]);let E;return v?(n?n instanceof Pe?g&&!g.values?E=o.jsx(ue,{error:"Reference does not exist",tooltip:n.path}):E=o.jsxs(o.Fragment,{children:[o.jsxs(c.Box,{sx:{display:"flex",flexDirection:"column",flexGrow:1,width:"100%",maxWidth:"calc(100% - 52px)",margin:1},children:[t!=="tiny"&&(n?o.jsx(c.Box,{sx:{display:t!=="regular"?"block":void 0,whiteSpace:t!=="regular"?"nowrap":void 0,overflow:t!=="regular"?"hidden":void 0,textOverflow:t!=="regular"?"ellipsis":void 0},children:o.jsx(c.Typography,{variant:"caption",className:"mono",children:n.id})}):o.jsx(c.Skeleton,{variant:"text"})),w&&w.map(x=>{const m=v.properties[x];return m?o.jsx(c.Box,{sx:{my:w.length>1?.5:0},children:g?o.jsx(we,{propertyKey:x,value:Ye(g.values,x),property:m,entity:g,size:"tiny"}):o.jsx(no,{property:m,size:"tiny"})},"ref_prev_"+x):null})]}),o.jsx(c.Box,{sx:{my:t==="tiny"?.5:1},children:!e&&g&&l&&o.jsx(c.Tooltip,{title:`See details for ${g.id}`,children:o.jsx(c.IconButton,{color:"inherit",size:"small",onClick:x=>{x.stopPropagation(),a.onAnalyticsEvent?.("entity_click_from_reference",{path:g.path,entityId:g.id}),u.open({entityId:g.id,path:g.path,collection:v,updateUrl:!0})},children:o.jsx(Nn,{fontSize:"small"})})})})]}):(console.error("Reference preview received value of type",typeof n),E=o.jsx(ue,{error:"Unexpected value",tooltip:JSON.stringify(n)})):E=o.jsx(ue,{error:"Reference not set"}),o.jsx(Ea,{onClick:e?void 0:s,onHover:e?void 0:i,size:t,children:E})):o.jsx(ue,{error:"Could not find collection with id "+v})}function Ea({children:e,onHover:n,size:r,onClick:t}){return o.jsx(c.Typography,{variant:"label",sx:i=>{const s=t?{tabindex:0,backgroundColor:n?ro(i):Oe(i),transition:"background-color 300ms ease, box-shadow 300ms ease",boxShadow:n?"0 0 0 2px rgba(128,128,128,0.05)":void 0,cursor:n?"pointer":void 0}:{};return{width:"100%",display:"flex",borderRadius:`${i.shape.borderRadius}px`,overflow:"hidden",padding:r==="regular"?1:0,itemsAlign:r==="tiny"?"center":void 0,...s}},onClick:i=>{t&&(i.preventDefault(),t())},children:e})}const ti=new Map;function ii({propertyKey:e,value:n,property:r,size:t}){const i=oe(),s=Je({propertyKey:e,property:r,propertyValue:n,fields:i.fields});if(Array.isArray(s?.of))throw Error("Using array properties instead of single one in `of` in ArrayProperty");if(s?.dataType!=="array"||!s.of||s.of.dataType!=="reference")throw Error("Picked wrong preview component ArrayOfReferencesPreview");const l=t==="regular"?"small":"tiny";return o.jsx(c.Box,{sx:{display:"flex",flexDirection:"column",width:"100%"},children:n&&n.map((a,d)=>{const u=s.of;return o.jsx(c.Box,{sx:{marginTop:.25,marginBottom:.25,width:"100%"},children:o.jsx(je,{disabled:!u.path,previewProperties:u.previewProperties,size:l,reference:a})},`preview_array_ref_${e}_${d}`)})})}const si="ArrayOfStorageComponentsPreview",hn={arrayWrap:`${si}-arrayWrap`,arrayItem:`${si}-arrayItem`},ma=be.styled("div")(({theme:e})=>({[`&.${hn.arrayWrap}`]:{display:"flex",flexWrap:"wrap"},[`& .${hn.arrayItem}`]:{margin:e.spacing(.5)}}));function li({propertyKey:e,entity:n,value:r,property:t,size:i}){const s=oe(),l=Je({propertyKey:e,property:t,propertyValue:r,fields:s.fields});if(Array.isArray(l.of))throw Error("Using array properties instead of single one in `of` in ArrayProperty");if(l.dataType!=="array"||!l.of||l.of.dataType!=="string")throw Error("Picked wrong preview component ArrayOfStorageComponentsPreview");const a=i==="regular"?"small":"tiny";return o.jsx(ma,{className:hn.arrayWrap,children:r&&r.map((d,u)=>o.jsx("div",{className:hn.arrayItem,children:o.jsx(re,{children:o.jsx(we,{propertyKey:e,value:d,entity:n,property:l.of,size:a})})},`preview_array_storage_${e}_${u}`))})}function gn({name:e,value:n,enumValues:r,size:t}){return o.jsx(c.Box,{sx:i=>({display:"flex",flexWrap:"wrap",gap:i.spacing(.5)}),children:n&&n.map((i,s)=>o.jsx(re,{children:o.jsx(Ie,{enumKey:i,enumValues:r,small:t!=="regular"})},`preview_array_ref_${e}_${s}`))})}function cr({propertyKey:e,value:n,property:r,size:t}){if(r.dataType!=="array")throw Error("Picked wrong preview component ArrayEnumPreview");const i=r.of;if(!i.enumValues)throw Error("Picked wrong preview component ArrayEnumPreview");return n?o.jsx(gn,{name:e,value:n,enumValues:i.enumValues,size:t}):null}function ai({propertyKey:e,value:n,property:r,entity:t,size:i}){const s=oe(),l=Je({propertyKey:e,property:r,propertyValue:n,fields:s.fields});if(Array.isArray(l.of))throw Error("Using array properties instead of single one in `of` in ArrayProperty");if(!l.of||l.dataType!=="array"||l.of.dataType!=="string")throw Error("Picked wrong preview component ArrayOfStringsPreview");if(n&&!Array.isArray(n))return o.jsx("div",{children:`Unexpected value: ${n}`});const a=l.of;return o.jsx(c.Box,{sx:{display:"flex",gap:"2px",flexDirection:"column"},children:n&&n.map((d,u)=>o.jsx("div",{children:o.jsx(re,{children:o.jsx(lr,{propertyKey:e,property:a,value:d,entity:t,size:i})})},`preview_array_strings_${e}_${u}`))})}const Lo="type",pn="value",dr="ArrayOneOfPreview",$o={array:`${dr}-array`,arrayWrap:`${dr}-arrayWrap`,arrayItemBig:`${dr}-arrayItemBig`},ka=be.styled("div")(({theme:e})=>({[`&.${$o.array}`]:{display:"flex",flexDirection:"column"},[`& .${$o.arrayWrap}`]:{display:"flex",flexWrap:"wrap"},[`& .${$o.arrayItemBig}`]:{margin:e.spacing(1)}}));function ci({propertyKey:e,value:n,property:r,size:t,entity:i}){const s=oe(),l=Je({propertyKey:e,property:r,propertyValue:n,fields:s.fields});if(l?.dataType!=="array")throw Error("Picked wrong preview component ArrayPreview");if(!l?.oneOf)throw Error(`You need to specify an 'of' or 'oneOf' prop (or specify a custom field) in your array property ${e}`);const a=n;if(!a)return null;const d=t==="regular"?"small":"tiny",u=l.oneOf.typeField??Lo,f=l.oneOf.valueField??pn,h=l.oneOf.properties;return o.jsx(ka,{className:$o.array,children:a&&a.map((b,p)=>o.jsxs(A.Fragment,{children:[o.jsx("div",{className:$o.arrayItemBig,children:o.jsx(re,{children:b&&o.jsx(we,{propertyKey:e,value:b[f],entity:i,property:l.resolvedProperties[p]??h[b[u]],size:d})})}),p<a.length-1&&o.jsx(c.Divider,{})]},"preview_array_"+b+"_"+p))})}function di({propertyKey:e,value:n,property:r,entity:t,size:i}){if(r.dataType!=="map")throw Error("Picked wrong preview component MapPropertyPreview");const s=r;if(!s.properties)return o.jsx(Ai,{value:n});if(!n)return null;let l;return i==="regular"?l=Object.keys(s.properties):(l=s.previewProperties||Object.keys(s.properties),i==="small"?l=l.slice(0,3):i==="tiny"&&(l=l.slice(0,1))),i!=="regular"?o.jsx(c.Box,{sx:a=>({width:"100%",display:"flex",flexDirection:"column","& > *":{[a.breakpoints.down("md")]:{marginBottom:`${a.spacing(.5)} !important`},marginBottom:`${a.spacing(1)} !important`}}),children:l.map((a,d)=>o.jsx("div",{children:o.jsx(re,{children:o.jsx(we,{propertyKey:a,value:n[a],property:s.properties[a],entity:t,size:i})},"map_preview_"+s.name+a+d)},`map_${a}`))}):o.jsx(c.Box,{sx:{display:"flex",flexDirection:"column",width:"100%"},children:l&&l.map((a,d)=>o.jsxs(c.Box,{sx:u=>({display:"flex",flexDirection:"row",pt:.5,"&:not(:last-child)":{borderBottom:`1px solid ${u.palette.divider}`,pb:.5}}),children:[o.jsx(c.Box,{sx:{width:"25%",verticalAlign:"top",pr:1},children:o.jsx(c.Typography,{variant:"caption",className:"mono",color:"textSecondary",children:s.properties[a].name})},`table-cell-title-${a}-${a}`),o.jsx(c.Box,{sx:{flexGrow:1},children:o.jsx(re,{children:o.jsx(we,{propertyKey:a,value:n[a],property:s.properties[a],entity:t,size:"small"})})})]},`map_preview_table_${a}}`))})}function Ai({value:e}){return typeof e!="object"?null:o.jsx(c.Box,{sx:{display:"flex",flexDirection:"column",width:"100%"},children:Object.entries(e).map(([n,r])=>o.jsxs(c.Box,{sx:t=>({display:"flex",flexDirection:"row",pt:.5,"&:not(:last-child)":{borderBottom:`1px solid ${t.palette.divider}`,pb:.5}}),children:[o.jsx(c.Box,{sx:{width:"25%",verticalAlign:"top",pr:1},children:o.jsx(c.Typography,{variant:"caption",className:"mono",color:"textSecondary",children:n})},`table-cell-title-${n}-${n}`),o.jsx(c.Box,{sx:{flexGrow:1},children:o.jsx(c.Typography,{variant:"caption",className:"mono",children:o.jsx(re,{children:JSON.stringify(r)})})})]},`map_preview_table_${n}}`))})}const Sa="MMMM dd, yyyy, HH:mm:ss";function ui({date:e}){const n=oe(),r=n?.locale?Pt[n?.locale]:void 0,t=n?.dateTimeFormat??Sa,i=e?pl(e,t,{locale:r}):"";return o.jsx(o.Fragment,{children:i})}function fi({value:e}){return e?o.jsx(Be.CheckBox,{color:"secondary"}):o.jsx(Be.CheckBoxOutlineBlank,{color:"disabled"})}function hi({value:e,property:n,size:r}){if(n.enumValues){const t=e,i=No(n.enumValues);return i?o.jsx(Ie,{enumKey:t,enumValues:i,small:r!=="regular"}):o.jsx(o.Fragment,{children:e})}else return o.jsx(o.Fragment,{children:e})}function we(e){const n=oe();let r;const{property:t,propertyKey:i,value:s,size:l,height:a,width:d,entity:u}=e,f=Te({propertyKey:i,propertyOrBuilder:t,propertyValue:s,fields:n.fields});if(s===void 0||f===null)r=o.jsx(vo,{});else if(f.Preview)r=A.createElement(f.Preview,{propertyKey:i,value:s,property:f,size:l,height:a,width:d,entity:u,customProps:f.customProps});else if(s===null)r=o.jsx(vo,{});else if(f.dataType==="string"){const h=f;typeof s=="string"?h.url?typeof h.url=="boolean"?r=o.jsx(Go,{size:e.size,url:s}):typeof h.url=="string"&&(r=o.jsx(Go,{size:e.size,url:s,previewType:h.url})):h.storage?r=o.jsx(Xt,{storeUrl:f.storage?.storeUrl??!1,size:e.size,storagePathOrDownloadUrl:s}):h.markdown?r=o.jsx(An,{source:s}):r=o.jsx(lr,{...e,property:h,value:s}):r=to(i,f.dataType,s)}else if(f.dataType==="array")if(s instanceof Array){const h=f;if(!h.of&&!h.oneOf)throw Error(`You need to specify an 'of' or 'oneOf' prop (or specify a custom field) in your array property ${i}`);h.of?Array.isArray(h.of)?r=o.jsx(ar,{...e,value:s,property:f}):h.of.dataType==="map"?r=o.jsx(ni,{propertyKey:i,property:f,value:s,entity:u,size:l}):h.of.dataType==="reference"?typeof h.of.path=="string"?r=o.jsx(ii,{...e,value:s,property:f}):r=o.jsx(vo,{}):h.of.dataType==="string"?h.of.enumValues?r=o.jsx(cr,{...e,value:s,property:f}):h.of.storage?r=o.jsx(li,{...e,value:s,property:f}):r=o.jsx(ai,{...e,value:s,property:f}):h.of.dataType==="number"&&h.of.enumValues?r=o.jsx(cr,{...e,value:s,property:f}):r=o.jsx(ar,{...e,value:s,property:f}):h.oneOf&&(r=o.jsx(ci,{...e,value:s,property:f}))}else r=to(i,f.dataType,s);else f.dataType==="map"?typeof s=="object"?r=o.jsx(di,{...e,property:f}):r=to(i,f.dataType,s):f.dataType==="date"?s instanceof Date?r=o.jsx(ui,{date:s}):r=to(i,f.dataType,s):f.dataType==="reference"?typeof f.path=="string"?s instanceof Pe?r=o.jsx(je,{disabled:!f.path,previewProperties:f.previewProperties,size:e.size,onClick:e.onClick,reference:s}):r=to(i,f.dataType,s):r=o.jsx(vo,{}):f.dataType==="boolean"?typeof s=="boolean"?r=o.jsx(fi,{value:s}):r=to(i,f.dataType,s):f.dataType==="number"?typeof s=="number"?r=o.jsx(hi,{...e,value:s,property:f}):r=to(i,f.dataType,s):r=JSON.stringify(s);return r??o.jsx(vo,{})}function to(e,n,r){return console.error(`Unexpected value for property ${e}, of type ${n}`,r),o.jsx(ue,{title:"Unexpected value",error:`${JSON.stringify(r)}`})}const Fa=Ee.memo(function({builder:n}){const[r,t]=A.useState(!0),[i,s]=A.useState(null);return A.useEffect(()=>{let l=!1;return n.then(a=>{l||(t(!1),s(a))}).catch(a=>{t(!1),console.error(a)}),()=>{l=!0}},[n]),r?o.jsx(c.Skeleton,{variant:"text"}):o.jsx(Ee.Fragment,{children:i})}),gi=(e,...n)=>({...n.reduce((r,t)=>({...r,[t]:e[t]}),{})});function bn(e){return e&&typeof e=="object"&&!Array.isArray(e)}function $e(e,n){const r=bn(e),t=r?{...e}:e;return r&&bn(n)&&Object.keys(n).forEach(i=>{bn(n[i])?i in e?t[i]=$e(e[i],n[i]):Object.assign(t,{[i]:n[i]}):Object.assign(t,{[i]:n[i]})}),t}function Ye(e,n){if(e&&typeof e=="object"){if(n in e)return e[n];if(n.includes(".")){const r=n.split(".");return Ye(e[r[0]],r.slice(1).join("."))}}}function Ia(e,n){let r={...e};const t=n.split("."),i=t.pop();for(const s of t)r=r[s];return i&&delete r[i],r}function Ar(e){return typeof e=="object"?Object.entries(e).filter(([n,r])=>typeof r!="function").map(([n,r])=>Array.isArray(r)?{[n]:r.map(t=>Ar(t))}:typeof r=="object"?{[n]:Ar(r)}:{[n]:r}).reduce((n,r)=>({...n,...r}),{}):e}function ur(e){if(!e)return null;if(typeof e=="object"){if("id"in e)return e.id;if(e instanceof Date)return e.toLocaleString();if(e instanceof Oo)return gt(e)}return gt(e,{ignoreUnknown:!0})}function fr(e){if(typeof e=="function")return e;if(Array.isArray(e))return e.map(n=>fr(n));if(typeof e=="object"){const n={};return Object.keys(e).forEach(r=>{if(!hr(e)){const t=fr(e[r]);t!==void 0&&!hr(t)&&(n[r]=t)}}),n}return e}function hr(e){return e&&Object.getPrototypeOf(e)===Object.prototype&&Object.keys(e).length===0}function wo(e){return e.readOnly||e.dataType==="date"&&e.autoValue?!0:e.dataType==="reference"?!e.path:!1}function Vo(e){return typeof e.disabled=="object"&&!!e.disabled.hidden}function Me(e){return typeof e=="function"}function Wo(e){return e?Object.entries(e).map(([n,r])=>{const t=vn(r);return t===void 0?{}:{[n]:t}}).reduce((n,r)=>({...n,...r}),{}):{}}function vn(e){if(!Me(e))if(e.dataType==="map"&&e.properties){const n=Wo(e.properties);return Object.keys(n).length===0?void 0:n}else return e.defaultValue?e.defaultValue:gr(e.dataType)}function gr(e){return e==="string"||e==="number"?null:e==="boolean"?!1:e==="date"?null:e==="array"?[]:e==="map"?{}:null}function pi({inputValues:e,properties:n,status:r,timestampNowValue:t,setDateToMidnight:i}){return pr(e,n,(s,l)=>{if(l.dataType==="date"){let a;return r==="existing"&&l.autoValue==="on_update"||(r==="new"||r==="copy")&&(l.autoValue==="on_update"||l.autoValue==="on_create")?a=t:a=s,l.mode==="date"&&(a=i(a)),a}else return s})??{}}function bi(e,n){const r=e;return Object.entries(n).forEach(([t,i])=>{e&&e[t]!==void 0?r[t]=e[t]:i.validation?.required&&(r[t]=null)}),r}function io(e){return new Pe(e.id,e.path)}function pr(e,n,r){const t=Object.entries(n).map(([s,l])=>{const a=e&&e[s],d=yn(a,l,r);if(d!==void 0)return{[s]:d}}).reduce((s,l)=>({...s,...l}),{}),i={...e,...t};if(Object.keys(i).length!==0)return i}function yn(e,n,r){let t;if(n.dataType==="map"&&n.properties)t=pr(e,n.properties,r);else if(n.dataType==="array")if(n.of&&Array.isArray(e))t=e.map(i=>yn(i,n.of,r));else if(n.oneOf&&Array.isArray(e)){const i=n.oneOf?.typeField??Lo,s=n.oneOf?.valueField??pn;t=e.map(l=>{if(l===null)return null;if(typeof l!="object")return l;const a=l[i],d=n.oneOf?.properties[a];return!a||!d?l:{[i]:a,[s]:yn(l[s],d,r)}})}else t=e;else t=r(e,n);return t}function br(e,n){const r=e.subcollections?.map(i=>{const s=n.subcollections?.find(l=>l.path===i.path)??n.subcollections?.find(l=>l.alias===i.alias);return s?br(i,s):i}),t=$e(e,n);return{...t,subcollections:r,properties:vr(t.properties,t.propertiesOrder)}}function Ta(e,n){const r=e.map(s=>({...s,editable:!0,deletable:!0})),t=(n??[]).map(s=>{const l=r?.find(a=>a.path===s.path)??r?.find(a=>a.alias===s.alias);return l?{...br(s,l),deletable:!1}:{...s,deletable:!1}}),i=r.filter(s=>!t.map(l=>l.path).includes(s.path)||!t.map(l=>l.alias).includes(s.alias));return[...t,...i]}function vr(e,n){try{const r=Object.keys(e);return(n??r).map(i=>{if(e[i]){const s=e[i];return!Me(s)&&s?.dataType==="map"&&s.properties?{[i]:{...s,properties:vr(s.properties,s.propertiesOrder)}}:{[i]:s}}else return}).filter(i=>i!==void 0).reduce((i,s)=>({...i,...s}),{})}catch(r){return console.error("Error sorting properties",r),e}}function yr(e,n){if(e)return typeof e=="string"?e:e(n)}const Da=/[A-Z]{2,}(?=[A-Z][a-z]+[0-9]*|\b)|[A-Z]?[a-z]+[0-9]*|[A-Z]|[0-9]+/g,Pa=e=>{const n=e.match(Da);return n?n.map(r=>r.toLowerCase()).join("-"):""},Ma=/[A-Z]{2,}(?=[A-Z][a-z]+[0-9]*|\b)|[A-Z]?[a-z]+[0-9]*|[A-Z]|[0-9]+/g,Qa=e=>{const n=e.match(Ma);return n?n.map(r=>r.toLowerCase()).join("_"):""};function xo(e=5){return Math.random().toString(36).slice(2,2+e)}function Oa(){return Math.floor(Math.random()*16777215).toString(16)}const vi="::";function wr(e){return yi(Ne(e))}function yi(e){return e.length===1?e[0]:e.reduce((n,r)=>`${n}${vi}${r}`)}function Ne(e){return e.split("/").filter((n,r)=>r%2===0)}function Ga(e){return e?e.toString():""}function wi(e){if(!e)return;const n=e.match(/\/(.*?)\/([a-z]*)?$/i);return n?new RegExp(n[1],n[2]||""):new RegExp(e,"")}function La(e){return e.match(/\/((?![*+?])(?:[^\r\n[/\\]|\\.|\[(?:[^\r\n\]\\]|\\.)*])+)\/((?:g(?:im?|mi?)?|i(?:gm?|mg?)?|m(?:gi?|ig?)?)?)/)?!0:!!e.match(/((?![*+?])(?:[^\r\n[/\\]|\\.|\[(?:[^\r\n\]\\]|\\.)*])+)/)}function wn(e,n,r,t=300){const i=A.useRef(!1),s=()=>{n(),i.current=!1},l=A.useRef(void 0);A.useEffect(()=>(i.current=!0,clearTimeout(l.current),l.current=setTimeout(s,t),()=>{r&&s()}),[r,e])}function $a(e,n=300){const[r,t]=A.useState(e);return A.useEffect(()=>{const i=setTimeout(()=>{t(e)},n);return()=>{clearTimeout(i)}},[e,n]),r}function xn({name:e,addLabel:n,value:r,disabled:t=!1,buildEntry:i,small:s,onInternalIdAdded:l,includeAddButton:a,newDefaultEntry:d=null,setFieldValue:u}){return o.jsx(tt,{droppableId:e,addLabel:n,value:r,disabled:t,buildEntry:i,small:s,onInternalIdAdded:l,includeAddButton:a,newDefaultEntry:d,onValueChange:f=>u(e,f)})}function xe({property:e}){const n=typeof e.disabled=="object"?e.disabled.disabledMessage:void 0;return o.jsxs(c.Box,{display:"flex",children:[o.jsx(c.Box,{flexGrow:1,children:o.jsx(c.FormHelperText,{children:n||e.description})}),e.longDescription&&o.jsx(c.Tooltip,{title:o.jsx(c.Typography,{variant:"caption",children:e.longDescription}),placement:"bottom-start",arrow:!0,children:o.jsx(c.IconButton,{edge:"start",size:"small",sx:{alignSelf:"flex-start"},children:o.jsx(hl,{color:"disabled",fontSize:"small"})})})]})}function Ce({icon:e,title:n,small:r,sx:t,required:i}){return o.jsxs(c.Box,{sx:{display:"inline-flex",marginBottom:"2px",alignItems:"center",gap:r?1:1.5,...t},component:"span",children:[e,o.jsx(c.Typography,{component:"span",sx:{fontWeight:500,fontSize:r?"1rem":".85rem",transformOrigin:"left top",transform:r?"translate(8px, 0px) scale(0.75)":void 0},children:(n??"")+(i?" *":"")})]})}function Va(e){const n=A.useRef(),[r,t]=A.useState(e.value),i=A.useDeferredValue(r);A.useEffect(()=>{t(e.value)},[e.value]),A.useEffect(()=>{!e.value&&!i||i!==e.value&&n.current&&e.onChange&&e.onChange(n.current)},[i,e.value,e.onChange]);const s=A.useCallback(l=>{n.current=l,t(l.target.value)},[]);return o.jsx(c.TextField,{...e,onChange:s,value:r})}function Wa({field:e,form:n,label:r,tooltip:t,disabled:i,size:s="small"}){const l=o.jsx(c.FormControlLabel,{checked:e.value??!1,sx:{ml:0},disabled:i,control:o.jsx(c.Switch,{size:s,disabled:i,onChange:(a,d)=>n.setFieldValue(e.name,d)}),label:o.jsx(c.Typography,{variant:"body2",children:r})});return t?o.jsx(c.Tooltip,{title:t,children:l}):l}class re extends A.Component{constructor(n){super(n),this.state={error:null}}static getDerivedStateFromError(n){return{error:n}}componentDidCatch(n,r){console.error(n)}render(){return this.state.error?o.jsxs(c.Box,{display:"flex",flexDirection:"column",m:.5,children:[o.jsxs(c.Box,{display:"flex",alignItems:"center",m:.5,children:[o.jsx(zn,{color:"error",fontSize:"small"}),o.jsx(c.Box,{marginLeft:1,children:"Error"})]}),o.jsx(c.Typography,{variant:"caption",children:this.state.error?.message??"See the error in the console"})]}):this.props.children}}function xr({propertyKey:e,value:n,setValue:r,error:t,showError:i,isSubmitting:s,touched:l,tableMode:a,property:d,includeDescription:u,context:f}){if(!f.entityId)throw new Error("ReadOnlyFieldBinding: Entity id is null");const h={id:f.entityId,values:f.values,path:f.path};return o.jsxs(c.FormControl,{fullWidth:!0,error:i,children:[!a&&o.jsx(c.FormHelperText,{filled:!0,children:o.jsx(Ce,{icon:ye(d),required:d.validation?.required,title:d.name})}),o.jsx(c.Paper,{sx:b=>({minHeight:"56px",elevation:0,padding:b.spacing(2),[b.breakpoints.up("md")]:{padding:b.spacing(3)}}),variant:"outlined",children:o.jsx(re,{children:o.jsx(we,{propertyKey:e,value:n,property:d,entity:h,size:"regular"})})}),i&&typeof t=="string"&&o.jsx(c.FormHelperText,{error:!0,children:t}),u&&o.jsx(xe,{property:d})]})}const so=A.memo(za,(e,n)=>{if(e.propertyKey!==n.propertyKey)return!1;const r=Me(e.property)||e.property.fromBuilder,t=Me(n.property)||n.property.fromBuilder;return!((r===t||Ae(e.property,n.property))&&e.disabled===n.disabled)||Cn(n.property),!1});function za({propertyKey:e,property:n,context:r,includeDescription:t,underlyingValueHasChanged:i,disabled:s,tableMode:l,partOfArray:a,autoFocus:d,context:{values:u,collection:f,path:h,entityId:b}}){const p=oe(),v=Cn(n,p.plugins)?me.Field:me.FastField;return o.jsx(v,{name:e,children:w=>{let E;const x=Te({propertyKey:e,propertyValue:w.field.value,propertyOrBuilder:n,values:w.form.values,path:r.path,entityId:r.entityId,fields:p.fields});if(x===null||Vo(x))return o.jsx(o.Fragment,{});if(wo(x))E=xr;else if(x.Field)typeof x.Field=="function"&&(E=x.Field);else{const C=mn(x);if(!C)throw new Error(`INTERNAL: Could not find field config for property ${e}`);E=C.Field}if(!E)return o.jsx("div",{children:`Currently the field ${x.dataType} is not supported`});const m={propertyKey:e,property:x,includeDescription:t,underlyingValueHasChanged:i,context:r,disabled:s,tableMode:l,partOfArray:a,autoFocus:d};return o.jsx(Ya,{Component:E,componentProps:m,fieldProps:w})}})}function Ya({Component:e,componentProps:{propertyKey:n,property:r,includeDescription:t,underlyingValueHasChanged:i,tableMode:s,partOfArray:l,autoFocus:a,context:d,disabled:u},fieldProps:f}){const{plugins:h}=oe(),b=r.customProps,p=f.field.value,g=f.meta.initialValue,v=me.getIn(f.form.errors,n),w=me.getIn(f.form.touched,n),E=v&&(f.form.submitCount>0||r.validation?.unique)&&(!Array.isArray(v)||!!v.filter(I=>!!I).length),m=Na(d.path,d.collection,n,r,e,h)??e,C=f.form.isSubmitting,B=A.useCallback((I,F)=>{f.form.setFieldTouched(n,!0,!1),f.form.setFieldValue(n,I,F)},[]),S=A.useCallback((I,F,T)=>{f.form.setFieldTouched(n,!0,!1),f.form.setFieldValue(I,F,T)},[]),k={propertyKey:n,value:p,initialValue:g,setValue:B,setFieldValue:S,error:v,touched:w,showError:E,isSubmitting:C,includeDescription:t??!0,property:r,disabled:u??!1,underlyingValueHasChanged:i??!1,tableMode:s??!1,partOfArray:l??!1,autoFocus:a??!1,customProps:b,context:d};return o.jsxs(re,{children:[o.jsx(m,{...k}),i&&!C&&o.jsx(c.FormHelperText,{children:"This value has been updated elsewhere"})]})}const Cn=(e,n)=>{if(n?.some(i=>i.form?.fieldBuilder)||Me(e))return!0;const r=e,t=!!r.Field||"fromBuilder"in r&&r.fromBuilder;return r.dataType==="map"&&r.properties?t||Object.values(r.properties).some(i=>Cn(i,n)):r.dataType==="array"&&"resolvedProperties"in r?t||r.resolvedProperties?.some(i=>i&&Cn(i,n)):t};function Na(e,n,r,t,i,s){return A.useRef((()=>{let a=null;return s&&s.forEach(d=>{const u=Qr(t);if(u&&d.form?.fieldBuilder){const f={fieldConfigId:u,propertyKey:r,property:t,Field:i,plugin:d,path:e,collection:n},h=d.form?.fieldBuilderEnabled?.(f);(h===void 0||h)&&(a=d.form.fieldBuilder(f)||a)}u||console.warn("INTERNAL: Field id not found for property",t)}),a})()).current}function Ua({propertyKey:e,value:n,error:r,showError:t,isSubmitting:i,setValue:s,tableMode:l,property:a,includeDescription:d,underlyingValueHasChanged:u,context:f,disabled:h}){if(!Array.isArray(a.resolvedProperties))throw Error("ArrayCustomShapedFieldBinding misconfiguration. Property `of` not set");const b=a.expanded===void 0?!0:a.expanded;Se({property:a,value:n,setValue:s});const p=o.jsx(Ce,{icon:ye(a),required:a.validation?.required,title:a.name}),g=a.resolvedProperties.map((v,w)=>{const E={propertyKey:`${e}[${w}]`,disabled:h,property:v,includeDescription:d,underlyingValueHasChanged:u,context:f,tableMode:!1,partOfArray:!0,autoFocus:!1};return o.jsx(c.Box,{pb:1,children:o.jsx(so,{...E})},`custom_shaped_array_${w}`)});return o.jsxs(c.FormControl,{fullWidth:!0,error:t,children:[!l&&o.jsx(qe,{initiallyExpanded:b,title:p,children:g}),l&&g,d&&o.jsx(xe,{property:a}),t&&typeof r=="string"&&o.jsx(c.FormHelperText,{error:!0,children:r})]})}function Cr({propertyKey:e,value:n,setValue:r,error:t,showError:i,disabled:s,autoFocus:l,touched:a,property:d,includeDescription:u}){const f=d.enumValues;Se({property:d,value:n,setValue:r});const h=A.useCallback(()=>{r(null)},[r]);return o.jsxs(c.FormControl,{fullWidth:!0,error:i,disabled:s,sx:{"& .MuiInputLabel-root":{mt:1/2,ml:1/2},"& .MuiInputLabel-shrink":{mt:2}},children:[o.jsx(c.InputLabel,{id:`${e}-select-label`,children:o.jsx(Ce,{icon:ye(d),required:d.validation?.required,title:d.name})}),o.jsx(c.Select,{sx:b=>({minHeight:"64px",borderRadius:`${b.shape.borderRadius}px`}),variant:"filled",labelId:`${e}-select-label`,autoFocus:l,value:n??"",disabled:s,disableUnderline:!0,endAdornment:d.clearable&&o.jsx(c.IconButton,{sx:{position:"absolute",top:"12px",right:"32px"},onClick:h,children:o.jsx(Ge,{})}),onChange:b=>{const p=b.target.value,g=p?d.dataType==="number"?parseFloat(p):p:null;return r(g)},renderValue:b=>o.jsx(Ie,{enumKey:b,enumValues:f,small:!1}),children:f&&f.map(b=>o.jsx(c.MenuItem,{value:b.id,disabled:fn(b),children:o.jsx(Ie,{enumKey:b.id,enumValues:f,small:!0})},`select_${e}_${b.id}`))}),u&&o.jsx(xe,{property:d}),i&&o.jsx(c.FormHelperText,{error:!0,children:t})]})}function Br({propertyKey:e,value:n,setValue:r,error:t,showError:i,disabled:s,property:l,includeDescription:a,autoFocus:d}){const u=l.of;if(!u)throw Error("Using wrong component ArrayEnumSelect");if(Array.isArray(u))throw Error("Using array properties instead of single one in `of` in ArrayProperty");if(u.dataType!=="string"&&u.dataType!=="number")throw Error("Field misconfiguration: array field of type string or number");const f=u.enumValues;if(!f)throw console.error(l),Error("Field misconfiguration: array field of type string or number needs to have enumValues");Se({property:l,value:n,setValue:r});const h=A.useCallback(()=>{r(null)},[r]);if(f instanceof Error)return o.jsx(ue,{error:f.message});const b=!!n&&Array.isArray(n);return o.jsxs(c.FormControl,{fullWidth:!0,required:l.validation?.required,error:i,sx:{"& .MuiInputLabel-root":{mt:1/2,ml:1/2},"& .MuiInputLabel-shrink":{mt:2}},children:[o.jsx(c.InputLabel,{id:`${e}-multiselect-label`,children:o.jsx(Ce,{icon:ye(l),required:l.validation?.required,title:l.name})}),o.jsx(c.Select,{multiple:!0,sx:p=>({minHeight:"64px",borderRadius:`${p.shape.borderRadius}px`}),variant:"filled",labelId:`${e}-multiselect-label`,value:b?n.map(p=>p.toString()):[],autoFocus:d,disabled:s,disableUnderline:!0,endAdornment:u.clearable&&o.jsx(c.IconButton,{sx:{position:"absolute",top:"12px",right:"32px"},onClick:h,children:o.jsx(Ge,{})}),onChange:p=>{let g;return u?.dataType==="number"?g=p.target.value?p.target.value.map(v=>parseFloat(v)):[]:g=p.target.value,r(g)},renderValue:p=>o.jsx(gn,{value:p,name:e,enumValues:f,size:"regular"}),children:un(f).map(p=>{const g=p.id,v=b&&n.map(w=>w.toString()).includes(g.toString());return o.jsxs(c.MenuItem,{value:g,disabled:fn(p),dense:!0,children:[o.jsx(c.Checkbox,{checked:v}),o.jsx(c.ListItemText,{primary:o.jsx(Ie,{enumKey:g,enumValues:f,small:!0})})]},`form-select-${e}-${g}`)})}),a&&o.jsx(xe,{property:l}),i&&o.jsx(c.FormHelperText,{error:!0,children:t})]})}function xi({propertyKey:e,value:n,error:r,showError:t,isSubmitting:i,tableMode:s,property:l,includeDescription:a,setValue:d,setFieldValue:u}){const f=l.of;if(f.dataType!=="reference")throw Error("ArrayOfReferencesField expected a property containing references");const h=l.expanded===void 0?!0:l.expanded,[b,p]=A.useState(!1),g=n&&Array.isArray(n)?n.map(k=>k.id):[];Se({property:l,value:n,setValue:d});const v=pe(),w=A.useMemo(()=>f.path?v.getCollection(f.path):void 0,[f.path]);if(!w)throw Error(`Couldn't find the corresponding collection for the path: ${f.path}`);const E=A.useCallback(k=>{d(k.map(I=>io(I)))},[d]),x=Qo({multiselect:!0,path:f.path,collection:w,onMultipleEntitiesSelected:E,selectedEntityIds:g,forceFilter:f.forceFilter}),m=A.useCallback(()=>{x.open()},[x]),C=A.useCallback((k,I)=>{const F=n&&n.length>k?n[k]:void 0;return F?o.jsx("div",{onMouseEnter:()=>p(!0),onMouseMove:()=>p(!0),onMouseLeave:()=>p(!1),children:o.jsx(je,{disabled:!f.path,previewProperties:f.previewProperties,size:"regular",onClick:m,reference:F,onHover:b})}):o.jsx("div",{children:"Internal ERROR"})},[f.path,f.previewProperties,b,n]),B=o.jsx(Ce,{icon:ye(l),required:l.validation?.required,title:l.name}),S=o.jsxs(o.Fragment,{children:[!w&&o.jsx(ue,{error:"The specified collection does not exist. Check console"}),w&&o.jsxs(o.Fragment,{children:[o.jsx(xn,{value:n,addLabel:l.name?"Add reference to "+l.name:"Add reference",name:e,buildEntry:C,disabled:i,setFieldValue:u,newDefaultEntry:l.of.defaultValue}),o.jsx(c.Box,{p:1,justifyContent:"center",textAlign:"left",children:o.jsxs(c.Button,{variant:"outlined",color:"primary",disabled:i,onClick:m,children:["Edit ",l.name]})})]})]});return o.jsx(o.Fragment,{children:o.jsxs(c.FormControl,{fullWidth:!0,error:t,children:[!s&&o.jsx(qe,{initiallyExpanded:h,title:B,children:S}),s&&S,a&&o.jsx(xe,{property:l}),t&&typeof r=="string"&&o.jsx(c.FormHelperText,{error:!0,children:r})]})})}async function Ha(e,n,r,t,i,s,l,a){let d;return typeof e=="function"?(d=await e({path:i,entityId:t,values:r,property:s,file:l,storage:n,propertyKey:a}),d||console.warn("Storage callback returned empty result. Using default name value")):d=Ci(l,e,t,a,i),d||(d=xo()+"_"+l.name),d}function _a(e,n,r,t,i,s,l,a){let d;return typeof e=="function"?(d=e({path:i,entityId:t,values:r,property:s,file:l,storage:n,propertyKey:a}),d||console.warn("Storage callback returned empty result. Using default name value")):d=Ci(l,e,t,a,i),d||(d=xo()+"_"+l.name),d}function Ci(e,n,r,t,i){const s=e.name.split(".").pop();let l=n.replace("{entityId}",r).replace("{propertyKey}",t).replace("{rand}",xo()).replace("{file}",e.name).replace("{file.type}",e.type).replace("{path}",i);if(s){l=l.replace("{file.ext}",s);const a=e.name.replace(`.${s}`,"");l=l.replace("{file.name}",a)}return l||(l=xo()+"_"+e.name),l}function Bi({entityId:e,entityValues:n,path:r,value:t,property:i,propertyKey:s,storageSource:l,disabled:a,onChange:d}){const u=i.dataType==="string"?i.storage:i.dataType==="array"&&i.of.dataType==="string"?i.of.storage:void 0,f=i.dataType==="array";if(!u)throw Error("Storage meta must be specified");const h=u?.metadata,b=f?"small":"regular",p=u?.imageCompression,g=(f?t??[]:t?[t]:[]).map(k=>({id:Er(),storagePathOrDownloadUrl:k,metadata:h,size:b})),[v,w]=A.useState(t),[E,x]=A.useState(g);A.useEffect(()=>{Ae(v,t)||(w(t),x(g))},[g,t,v]);const m=A.useCallback(async k=>{if(u.fileName){const I=await Ha(u.fileName,u,n,e,r,i,k,s);if(!I||I.length===0)throw Error("You need to return a valid filename");return I}return xo()+"_"+k.name},[e,n,r,i,s,u]),C=A.useCallback(k=>_a(u.storagePath,u,n,e,r,i,k,s)??"/",[e,n,r,i,s,u]),B=A.useCallback(async(k,I,F)=>{console.debug("onFileUploadComplete",k,I);let T=k;u.storeUrl&&(T=(await l.getDownloadURL(k)).url),u.postProcess&&(T=await u.postProcess(T));let D;I.storagePathOrDownloadUrl=T,I.metadata=F,D=[...E],D=Ei(D),x(D);const P=D.filter(Q=>!!Q.storagePathOrDownloadUrl).map(Q=>Q.storagePathOrDownloadUrl);d(f?P:P?P[0]:null)},[E,f,d,u,l]),S=A.useCallback(async k=>{if(!k.length||a)return;let I;if(f)I=[...E,...await Promise.all(k.map(async F=>(p&&mr(F)&&(F=await ki(F,p)),{id:Er(),file:F,fileName:await m(F),metadata:h,size:b})))];else{let F=k[0];p&&mr(F)&&(F=await ki(F,p)),I=[{id:Er(),file:F,fileName:await m(F),metadata:h,size:b}]}I=Ei(I),x(I)},[a,m,E,h,f,b]);return{internalValue:E,setInternalValue:x,storage:u,fileNameBuilder:m,storagePathBuilder:C,onFileUploadComplete:B,onFilesAdded:S,multipleFilesSupported:f}}function Ei(e){return e.filter((n,r)=>(e.map(t=>t.storagePathOrDownloadUrl).indexOf(n.storagePathOrDownloadUrl)===r||!n.storagePathOrDownloadUrl)&&(e.map(t=>t.file).indexOf(n.file)===r||!n.file))}function Er(){return Math.floor(Math.random()*Math.floor(Number.MAX_SAFE_INTEGER))}const mi={"image/jpeg":"JPEG","image/png":"PNG","image/webp":"WEBP"},mr=e=>mi[e.type]?mi[e.type]:null,ja=100,ki=(e,n)=>new Promise(r=>{const t=n.quality===void 0?ja:n.quality,i=t>=0&&t<=100?t:100,s=mr(e);if(!s)throw Error("resizeAndCompressImage: Unsupported image format");$l.imageFileResizer(e,n.maxWidth||Number.MAX_VALUE,n.maxHeight||Number.MAX_VALUE,s,i,0,l=>r(l),"file")});function Si({storagePath:e,entry:n,metadata:r,onFileUploadComplete:t,imageSize:i,simple:s}){const l=po(),a=_e(),[d,u]=A.useState(),[f,h]=A.useState(!1),b=A.useRef(!1),p=A.useRef(!1),g=A.useCallback((v,w)=>{p.current||(p.current=!0,u(void 0),h(!0),l.uploadFile({file:v,fileName:w,path:e,metadata:r}).then(async({path:E})=>{console.debug("Upload successful"),await t(E,n,r),b.current&&h(!1)}).catch(E=>{console.error("Upload error",E),b.current&&(u(E),h(!1),a.open({type:"error",message:"Error uploading file: "+E.message}))}).finally(()=>{p.current=!1}))},[n,r,t,l,e]);return A.useEffect(()=>(b.current=!0,n.file&&g(n.file,n.fileName),()=>{b.current=!1}),[n.file,n.fileName,g]),s?o.jsx(c.Box,{m:1,sx:{width:i,height:i},children:f&&o.jsx(c.Skeleton,{variant:"rectangular",sx:{width:i,height:i}})}):o.jsx(c.Box,{m:1,children:o.jsxs(c.Paper,{elevation:0,sx:{padding:1,boxSizing:"border-box",minWidth:i,minHeight:i},variant:"outlined",children:[f&&o.jsx(c.Skeleton,{variant:"rectangular",sx:{width:"100%",height:"100%"}}),d&&o.jsx(ue,{title:"Error uploading file",error:d})]})})}function Fi({name:e,property:n,value:r,entity:t,onRemove:i,disabled:s,size:l}){return o.jsx(c.Box,{m:1,position:"relative",children:o.jsxs(c.Paper,{elevation:0,sx:{padding:1,boxSizing:"border-box",minWidth:l==="regular"?220:118,minHeight:l==="regular"?220:118},variant:"outlined",children:[!s&&o.jsx(c.Box,{sx:a=>({position:"absolute",borderRadius:"9999px",top:-8,right:-8,zIndex:1,backgroundColor:a.palette.background.paper}),children:o.jsx(c.Tooltip,{title:"Remove",children:o.jsx(c.IconButton,{size:"small",onClick:a=>{a.stopPropagation(),i(r)},children:o.jsx(en,{fontSize:"small"})})})}),r&&o.jsx(re,{children:o.jsx(we,{propertyKey:e,value:r,property:n,entity:t,size:l})})]})})}const Co="StorageUploadField",Qe={dropZone:`${Co}-dropZone`,disabled:`${Co}-disabled`,nonActiveDrop:`${Co}-nonActiveDrop`,activeDrop:`${Co}-activeDrop`,acceptDrop:`${Co}-acceptDrop`,rejectDrop:`${Co}-rejectDrop`},qa=be.styled(c.Box)(({theme:e})=>({[`&.${Qe.dropZone}`]:{position:"relative",paddingTop:"2px",border:"2px solid transparent",minHeight:"254px",outline:0,borderRadius:`${e.shape.borderRadius}px`,backgroundColor:Oe(e),boxSizing:"border-box",transition:"border-bottom-color 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms","&:focus":{border:`2px solid ${e.palette.primary.main}`}},[`&.${Qe.disabled}`]:{backgroundColor:"rgba(0, 0, 0, 0.12)",color:e.palette.mode==="light"?"rgba(0, 0, 0, 0.38)":"rgba(255, 255, 255, 0.38)",border:`1px dotted ${e.palette.grey[400]}`},[`&.${Qe.nonActiveDrop}`]:{"&:hover":{backgroundColor:ro(e)}},[`&.${Qe.activeDrop}`]:{paddingTop:"0px",boxSizing:"border-box",border:"2px solid"},[`&.${Qe.acceptDrop}`]:{transition:"background-color 200ms cubic-bezier(0.0, 0, 0.2, 1) 0ms",background:"repeating-linear-gradient( 45deg, rgba(0, 0, 0, 0.09), rgba(0, 0, 0, 0.09) 10px, rgba(0, 0, 0, 0.12) 10px, rgba(0, 0, 0, 0.12) 20px) !important",border:"2px solid",borderColor:e.palette.success.light},[`&.${Qe.rejectDrop}`]:{border:"2px solid",borderColor:e.palette.error.light}}));function kr({propertyKey:e,value:n,setValue:r,error:t,showError:i,autoFocus:s,tableMode:l,property:a,includeDescription:d,context:u,isSubmitting:f}){if(!u.entityId)throw new Error("StorageUploadFieldBinding: Entity id is null");const h=po(),b=wo(a)||!!a.disabled||f,{internalValue:p,setInternalValue:g,onFilesAdded:v,storage:w,onFileUploadComplete:E,storagePathBuilder:x,multipleFilesSupported:m}=Bi({entityValues:u.values,entityId:u.entityId,path:u.path,property:a,propertyKey:e,value:n,storageSource:h,disabled:b,onChange:r});Se({property:a,value:n,setValue:r});const C={id:u.entityId,values:u.values,path:u.path};return o.jsxs(c.FormControl,{fullWidth:!0,required:a.validation?.required,error:i,children:[!l&&o.jsx(c.FormHelperText,{filled:!0,children:o.jsx(Ce,{icon:ye(a),required:a.validation?.required,title:a.name})}),o.jsx(Za,{value:p,name:e,disabled:b,autoFocus:s,property:a,onChange:r,setInternalValue:g,onFilesAdded:v,entity:C,onFileUploadComplete:E,storagePathBuilder:x,storage:w,multipleFilesSupported:m}),d&&o.jsx(xe,{property:a}),i&&o.jsx(c.FormHelperText,{error:!0,children:t})]})}function Ja({storage:e,disabled:n,isDraggingOver:r,onFilesAdded:t,multipleFilesSupported:i,droppableProvided:s,autoFocus:l,internalValue:a,property:d,entity:u,onClear:f,metadata:h,storagePathBuilder:b,onFileUploadComplete:p,size:g,name:v,helpText:w}){const E=_e(),{getRootProps:x,getInputProps:m,isDragActive:C,isDragAccept:B,isDragReject:S}=Ct.useDropzone({accept:e.acceptedFiles?e.acceptedFiles.map(k=>({[k]:[]})).reduce((k,I)=>({...k,...I}),{}):void 0,disabled:n||r,noDragEventsBubbling:!0,maxSize:e.maxSize,onDrop:t,onDropRejected:(k,I)=>{for(const F of k)for(const T of F.errors)E.open({type:"error",message:`Error uploading file: File is larger than ${e.maxSize} bytes`})}});return o.jsxs(qa,{...x(),className:Ll(Qe.dropZone,{[Qe.nonActiveDrop]:!C,[Qe.activeDrop]:C,[Qe.rejectDrop]:S,[Qe.acceptDrop]:B,[Qe.disabled]:n}),sx:{display:i&&a.length?void 0:"flex",alignItems:"center"},children:[o.jsxs(c.Box,{...s.droppableProps,ref:s.innerRef,sx:{display:"flex",alignItems:"center",overflow:i&&a.length?"auto":void 0,minHeight:i&&a.length?180:250,p:1,"&::-webkit-scrollbar":{display:"none"}},children:[o.jsx("input",{autoFocus:l,...m()}),a.map((k,I)=>{let F;return k.storagePathOrDownloadUrl?F=o.jsx(Fi,{name:`storage_preview_${k.storagePathOrDownloadUrl}`,property:d,disabled:n,entity:u,value:k.storagePathOrDownloadUrl,onRemove:f,size:k.size}):k.file&&(F=o.jsx(Si,{entry:k,metadata:h,storagePath:b(k.file),onFileUploadComplete:p,imageSize:g==="regular"?220:118,simple:!1})),o.jsx(fo.Draggable,{draggableId:`array_field_${v}_${k.id}`,index:I,children:(T,D)=>o.jsx(c.Box,{ref:T.innerRef,...T.draggableProps,...T.dragHandleProps,style:T.draggableProps.style,sx:P=>({borderRadius:`${P.shape.borderRadius}px`}),children:F})},`array_field_${v}_${k.id}`)}),s.placeholder]}),o.jsx(c.Box,{sx:{flexGrow:1,minHeight:38,boxSizing:"border-box",m:2},children:o.jsx(c.Typography,{align:"center",variant:"label",children:w})})]})}function Za({property:e,name:n,value:r,setInternalValue:t,onChange:i,multipleFilesSupported:s,onFileUploadComplete:l,disabled:a,onFilesAdded:d,autoFocus:u,storage:f,entity:h,storagePathBuilder:b}){if(s){const C=e;if(C.of){if(Array.isArray(C.of)||C.of.dataType!=="string")throw Error("Storage field using array must be of data type string")}else throw Error("Storage field using array must be of data type string")}const p=f?.metadata,g=s?"small":"regular",v=A.useCallback((C,B)=>{if(!s)return;const S=[...r],k=S[C];S.splice(C,1),S.splice(B,0,k),t(S);const I=S.filter(F=>!!F.storagePathOrDownloadUrl).map(F=>F.storagePathOrDownloadUrl);i(I)},[s,i,t,r]),w=A.useCallback(C=>{C.destination&&v(C.source.index,C.destination.index)},[v]),E=A.useCallback(C=>{if(s){const B=r.filter(S=>S.storagePathOrDownloadUrl!==C);i(B.filter(S=>!!S.storagePathOrDownloadUrl).map(S=>S.storagePathOrDownloadUrl)),t(B)}else i(null),t([])},[r,s,i]),x=s?"Drag 'n' drop some files here, or click to select files":"Drag 'n' drop a file here, or click to select one",m=s?e.of:e;return o.jsx(fo.DragDropContext,{onDragEnd:w,children:o.jsx(fo.Droppable,{droppableId:`droppable_${n}`,direction:"horizontal",renderClone:(C,B,S)=>{const k=r[S.source.index];return o.jsx(c.Box,{ref:C.innerRef,...C.draggableProps,...C.dragHandleProps,style:C.draggableProps.style,sx:I=>({borderRadius:I.shape.borderRadius}),children:o.jsx(Fi,{name:`storage_preview_${k.storagePathOrDownloadUrl}`,property:m,disabled:!0,entity:h,value:k.storagePathOrDownloadUrl,onRemove:E,size:k.size})})},children:(C,B)=>o.jsx(Ja,{storage:f,disabled:a,isDraggingOver:B.isDraggingOver,droppableProvided:C,onFilesAdded:d,multipleFilesSupported:s,autoFocus:u,internalValue:r,property:m,entity:h,onClear:E,metadata:p,storagePathBuilder:b,onFileUploadComplete:l,size:g,name:n,helpText:x})})})}function Bn(e){return parseInt(e,10)||0}const Xa={shadow:{visibility:"hidden",position:"absolute",overflow:"hidden",height:0,top:0,left:0,transform:"translateZ(0)"}};function Ii(e){return e==null||Object.keys(e).length===0||e.outerHeightStyle===0&&!e.overflow}const Sr=Ee.forwardRef(function(n,r){const{onChange:t,onScroll:i,onResize:s,maxRows:l,minRows:a=1,style:d,value:u,onFocus:f,onBlur:h,sizeRef:b,...p}=n,{current:g}=Ee.useRef(u!=null),v=Ee.useRef(null),w=Do.unstable_useForkRef(r,v),E=Ee.useRef(null),x=Ee.useRef(0),[m,C]=Ee.useState({outerHeightStyle:0}),B=Ee.useCallback(()=>{const T=v.current,P=Do.unstable_ownerWindow(T).getComputedStyle(T);if(P.width==="0px")return{outerHeightStyle:0};const Q=b?.current??E.current,K=E.current;Q.style.width=P.width,K.value=T.value||n.placeholder||"x",K.value.slice(-1)===`
`&&(K.value+=" ");const L=P.boxSizing,z=Bn(P.paddingBottom)+Bn(P.paddingTop),H=Bn(P.borderBottomWidth)+Bn(P.borderTopWidth),J=Q.scrollHeight;K.value="x";const O=Q.scrollHeight;let G=J;a&&(G=Math.max(Number(a)*O,G)),l&&(G=Math.min(Number(l)*O,G)),G=Math.max(G,O);const U=G+(L==="border-box"?z+H:0),V=Math.abs(G-J)<=1;return{outerHeightStyle:U,overflow:V}},[l,a,n.placeholder]),S=(T,D)=>{const{outerHeightStyle:P,overflow:Q}=D;return x.current<20&&(P>0&&Math.abs((T.outerHeightStyle||0)-P)>1||T.overflow!==Q)?(x.current+=1,{overflow:Q,outerHeightStyle:P}):(process.env.NODE_ENV!=="production"&&x.current===20&&console.error(["MUI: Too many re-renders. The layout is unstable.","TextareaAutosize limits the number of renders to prevent an infinite loop."].join(`
`)),T)},k=Ee.useCallback(()=>{const T=B();Ii(T)||(s&&s(T),C(D=>S(D,T)))},[B,s]),I=()=>{const T=B();Ii(T)||Jl.flushSync(()=>{C(D=>S(D,T))})};Ee.useEffect(()=>{const T=Do.unstable_debounce(()=>{x.current=0,v.current&&I()});let D;const P=v.current,Q=Do.unstable_ownerWindow(P);return Q.addEventListener("resize",T),typeof ResizeObserver<"u"&&(D=new ResizeObserver(T),D.observe(P)),()=>{T.clear(),Q.removeEventListener("resize",T),D&&D.disconnect()}}),Do.unstable_useEnhancedEffect(()=>{k()}),Ee.useEffect(()=>{x.current=0},[u]);const F=T=>{x.current=0,g||k(),t&&t(T)};return o.jsxs(Ee.Fragment,{children:[o.jsx("textarea",{value:u,onChange:F,ref:w,onFocus:f,onBlur:h,rows:a,style:{height:m.outerHeightStyle,overflow:m.overflow?"hidden":void 0,...d},onScroll:i,...p}),o.jsx("textarea",{"aria-hidden":!0,className:n.className,readOnly:!0,ref:E,tabIndex:-1,style:{...Xa.shadow,...d,padding:0}})]})});function Ti({label:e,small:n,value:r}){return o.jsxs(c.Box,{sx:t=>({position:"relative",background:xa,borderRadius:`${t.shape.borderRadius}px`,maxWidth:"100%",minHeight:n?"48px":"64px",color:t.palette.text.disabled}),children:[o.jsx(c.InputLabel,{shrink:!!r,sx:{position:"absolute",color:t=>t.palette.text.disabled,left:0,top:"4px",pointerEvents:"none"},variant:"filled",children:e}),o.jsx(c.Box,{sx:{padding:e?"32px 12px 8px 12px":n?"12px":"8px 12px 8px 12px",overflow:"auto"},children:o.jsx(c.Typography,{variant:"body1",sx:{fontFamily:"inherit"},children:r})})]})}function zo({value:e,onChange:n,label:r,inputType:t="text",multiline:i=!1,disabled:s,error:l,endAdornment:a,autoFocus:d,placeholder:u,small:f}){const h=A.useRef(null),[b,p]=A.useState(document.activeElement===h.current),g=e!=null&&e!=="",v=A.useCallback(x=>{x.target.blur(),x.stopPropagation(),setTimeout(()=>{x.target.focus()},0)},[]);if(s)return o.jsx(Ti,{label:r,small:f,value:e});const w=i?o.jsx(Ra,{ref:h,placeholder:u,autoFocus:d,onFocus:()=>p(!0),onBlur:()=>p(!1),value:e??"",onChange:n}):o.jsx(Ka,{ref:h,onWheel:t==="number"?v:void 0,sx:{padding:r?"32px 12px 8px 12px":"8px 12px 8px 12px"},small:f??!1,placeholder:u,autoFocus:d,onFocus:()=>p(!0),onBlur:()=>p(!1),type:t,value:Number.isNaN(e)?"":e??"",onChange:n}),E=a?o.jsxs(c.Box,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[w,o.jsx(c.Box,{sx:{mr:2,my:1},children:a})]}):w;return o.jsxs(c.Box,{sx:x=>({position:"relative",background:Oe(x),borderRadius:`${x.shape.borderRadius}px`,maxWidth:"100%",minHeight:f?"48px":"64px","&:hover":{backgroundColor:ro(x)}}),children:[o.jsx(c.InputLabel,{shrink:g||b,sx:{position:"absolute",left:0,top:"4px",pointerEvents:"none",color:x=>l?x.palette.error.main:b?x.palette.primary.main:void 0},variant:"filled",children:r}),E]})}const Ka=Ro.styled("input")(({small:e})=>({width:"100%",outlineWidth:0,minHeight:e?"48px":"64px",fontSize:"16px",padding:"32px 12px 8px 12px",font:"inherit",letterSpacing:"inherit",color:"currentcolor",border:"0px",background:"none",height:"1.4375em",margin:"0px",WebkitTapHighlightColor:"transparent",display:"block",minWidth:"0px",animationName:"mui-auto-fill-cancel",animationDuration:"10ms","&::-webkit-inner-spin-button":{WebkitAppearance:"none",margin:0}})),Ra=Ro.styled(Sr)({width:"100%",outlineWidth:0,resize:"none",minHeight:"64px",fontSize:"16px",padding:"32px 12px 8px 12px",font:"inherit",letterSpacing:"inherit",color:"currentcolor",border:"0px",background:"none",height:"1.4375em",margin:"0px",WebkitTapHighlightColor:"transparent",display:"block",minWidth:"0px",animationName:"mui-auto-fill-cancel",animationDuration:"10ms"});function Bo({propertyKey:e,value:n,setValue:r,error:t,showError:i,disabled:s,autoFocus:l,property:a,includeDescription:d,allowInfinity:u}){let f,h;a.dataType==="string"&&(f=a.multiline,h=a.url),Se({property:a,value:n,setValue:r});const b=A.useCallback(()=>{r(null)},[r]),p=x=>{if(E==="number"){const m=x.target.value?parseFloat(x.target.value):void 0;m&&isNaN(m)?r(null):m!=null?r(m):r(null)}else r(x.target.value)},g=!!f,E=!((n??(a.dataType==="string"?"":n===0?0:""))===1/0)&&a.dataType==="number"?"number":void 0;return o.jsxs(o.Fragment,{children:[o.jsx(zo,{value:n,onChange:p,autoFocus:l,label:o.jsx(Ce,{icon:ye(a),required:a.validation?.required,title:a.name}),inputType:E,multiline:g,disabled:s,endAdornment:a.clearable&&o.jsx(c.IconButton,{onClick:b,children:o.jsx(Ge,{})}),error:i?t:void 0}),(i&&t||d&&(a.description||a.longDescription)||u)&&o.jsx(c.Box,{display:"flex",sx:{marginLeft:"14px"},children:o.jsxs(c.Box,{flexGrow:1,children:[i&&o.jsx(c.FormHelperText,{error:!0,children:t}),d&&o.jsx(xe,{property:a})]})}),h&&o.jsx(c.Collapse,{sx:{marginTop:1,marginLeft:1},in:!!n,appear:!0,timeout:500,children:o.jsx(we,{value:n,property:a,size:"regular"})})]})}const En=A.forwardRef(function({value:n,position:r="end",onChange:t,error:i,label:s,autoFocus:l,disabled:a,small:d},u){const[f,h]=A.useState(l??!1);return o.jsx(o.Fragment,{children:o.jsx(c.FormControl,{fullWidth:!0,children:o.jsx(c.FormControlLabel,{sx:b=>({color:i?b.palette.error.main:f?b.palette.primary.main:b.palette.text.secondary,justifyContent:"space-between",margin:0,width:"100%",minHeight:d?"48px":"64px",paddingLeft:d?"8px":"16px",paddingRight:d?"16px":"24px",boxSizing:"border-box",position:"relative",display:"inline-flex",alignItems:"center",flexDirection:r==="end"?"row-reverse":"row",backgroundColor:Oe(b),borderRadius:`${b.shape.borderRadius}px`,transition:"background-color 200ms cubic-bezier(0.0, 0, 0.2, 1) 0ms","&:hover":{backgroundColor:ro(b)}}),onClick:b=>h(!0),labelPlacement:"start",checked:!!n,inputRef:u,control:o.jsx(c.Switch,{size:d?"small":"medium",type:"checkbox",color:"secondary",autoFocus:l,disabled:a,onFocus:b=>h(!0),onBlur:b=>h(!1),onChange:b=>{h(!0),t?.(b)}}),disabled:a,label:s})})})}),Di=A.forwardRef(function({propertyKey:n,value:r,setValue:t,error:i,showError:s,autoFocus:l,disabled:a,touched:d,property:u,includeDescription:f},h){return Se({property:u,value:r,setValue:t}),o.jsxs(o.Fragment,{children:[o.jsx(En,{value:r,onChange:b=>t(b.target.checked),error:s,label:o.jsx(Ce,{icon:ye(u),required:u.validation?.required,title:u.name}),disabled:a,autoFocus:l,small:!1}),(s&&i||f&&(u.description||u.longDescription))&&o.jsxs(c.Box,{display:"flex",sx:{marginLeft:"14px"},children:[f&&o.jsx(xe,{property:u}),s&&o.jsx(c.FormHelperText,{error:!0,children:i})]})]})});function Pi({propertyKey:e,value:n,setValue:r,autoFocus:t,error:i,showError:s,disabled:l,touched:a,property:d,includeDescription:u}){const f=n||null;Se({property:d,value:n,setValue:r});const h=A.useCallback(()=>{r(null)},[r]),b=d.mode===void 0||d.mode==="date_time"?_n.DateTimePicker:Hn.DatePicker;return o.jsxs(o.Fragment,{children:[o.jsx(b,{autoFocus:t,value:f,renderInput:p=>o.jsx(c.TextField,{...p,fullWidth:!0,sx:g=>({minHeight:"64px",borderRadius:`${g.shape.borderRadius}px`,backgroundColor:Oe(g),"&:hover":{backgroundColor:ro(g)}}),label:o.jsx(Ce,{icon:ye(d),required:d.validation?.required,title:d.name}),InputProps:{...p.InputProps,sx:g=>({minHeight:"64px",borderRadius:`${g.shape.borderRadius}px`,backgroundColor:Oe(g),"&:hover":{backgroundColor:ro(g)}}),disableUnderline:!0,endAdornment:o.jsxs(c.Box,{sx:{pr:2,gap:2},children:[d.clearable&&o.jsx(c.IconButton,{sx:{position:"absolute",right:"56px",top:"12px"},onClick:h,children:o.jsx(Ge,{})}),p.InputProps?.endAdornment]})},error:s,variant:"filled",helperText:s?i:null}),disabled:l,onChange:p=>r(p)}),u&&o.jsx(xe,{property:d})]})}function ec({name:e,path:n,disabled:r,value:t,setValue:i,previewProperties:s,forceFilter:l}){const a=oe(),d=pe(),u=He(),f=A.useMemo(()=>d.getCollection(n),[n,d]);if(!f)throw Error(`Couldn't find the corresponding collection for the path: ${n}`);const h=t&&t instanceof Pe,{entity:b,dataLoading:p,dataLoadingError:g}=an({path:n,entityId:h?t.id:void 0,collection:f,useCache:!0}),v=A.useCallback(B=>{r||i(B?io(B):null)},[r,i]),w=Qo({multiselect:!1,path:n,collection:f,onSingleEntitySelected:v,forceFilter:l}),E=A.useCallback(()=>{w.open()},[w]),x=A.useCallback(B=>{B.stopPropagation(),i(null)},[i]),m=A.useCallback(B=>{B.stopPropagation(),b&&(a.onAnalyticsEvent?.("entity_click_from_reference",{path:b.path,entityId:b.id}),u.open({entityId:b.id,path:n,updateUrl:!0}))},[b,n,u]),C=B=>{const S=b&&!b.values;let k;if(!B)k=o.jsx(ue,{error:"The specified collection does not exist. Check console"});else if(S)k=o.jsx(c.Tooltip,{title:t&&t.path,children:o.jsxs(c.Box,{display:"flex",alignItems:"center",p:1,flexGrow:1,children:[o.jsx(zn,{fontSize:"small",color:"error"}),o.jsxs(c.Box,{marginLeft:1,children:["Missing reference ",b&&b.id]})]})});else if(h){const I=Wr(B,a.fields,s,3);k=o.jsx(c.Box,{display:"flex",flexDirection:"column",flexGrow:1,ml:1,mr:1,children:I&&I.map(F=>{const T=B.properties[F];return T?o.jsx(c.Box,{mt:.25,mb:.25,children:o.jsx(re,{children:b?o.jsx(we,{propertyKey:F,value:b.values[F],property:T,entity:b,size:"tiny"}):o.jsx(no,{property:T,size:"tiny"})})},`reference_previews_${F}`):null})})}else k=o.jsxs(c.Box,{p:1,onClick:r?void 0:E,justifyContent:"center",display:"flex",children:[o.jsx(c.Typography,{variant:"label",sx:I=>({flexGrow:1,textAlign:"center"}),children:"No value set"}),!r&&o.jsx(c.Button,{variant:"outlined",color:"primary",children:"Set"})]});return o.jsx(c.Box,{onClick:r?void 0:E,display:"flex",children:o.jsxs(c.Box,{display:"flex",flexDirection:"column",flexGrow:1,children:[o.jsxs(c.Box,{display:"flex",flexDirection:"row",flexGrow:1,children:[o.jsx(Ce,{icon:o.jsx(bt,{color:"inherit",fontSize:"inherit"}),sx:{flexGrow:1,color:"text.secondary",ml:1},title:e}),b&&o.jsx(c.Box,{alignSelf:"center",m:1,children:o.jsx(c.Tooltip,{title:t&&t.path,children:o.jsx(c.Typography,{variant:"caption",className:"mono",children:b.id})})}),!S&&b&&t&&o.jsx(c.Box,{children:o.jsx(c.Tooltip,{title:`See details for ${b.id}`,children:o.jsx("span",{children:o.jsx(c.IconButton,{onClick:m,size:"large",children:o.jsx(Nn,{})})})})}),t&&o.jsx(c.Box,{children:o.jsx(c.Tooltip,{title:"Clear",children:o.jsx("span",{children:o.jsx(c.IconButton,{disabled:r,onClick:r?void 0:x,size:"large",children:o.jsx(Ge,{})})})})})]}),k]})})};return o.jsx(c.Typography,{variant:"label",sx:B=>({elevation:0,width:"100%",padding:B.spacing(1),position:"relative",transition:"background-color 200ms cubic-bezier(0.0, 0, 0.2, 1) 0ms",borderRadius:`${B.shape.borderRadius}px`,backgroundColor:r?"rgba(0, 0, 0, 0.12)":Oe(B),"&:hover":{cursor:r?void 0:"pointer",backgroundColor:r?"rgba(0, 0, 0, 0.12)":ro(B)},color:r?B.palette.mode==="light"?"rgba(0, 0, 0, 0.38)":"rgba(255, 255, 255, 0.38)":void 0,fontWeight:B.typography.fontWeightMedium}),children:f&&C(f)})}function Mi(e){return typeof e.property.path!="string"?o.jsx(xr,{...e}):o.jsx(oc,{...e})}function oc({propertyKey:e,value:n,setValue:r,error:t,showError:i,disabled:s,touched:l,autoFocus:a,property:d,includeDescription:u,context:f}){if(!d.path)throw new Error("Property path is required for ReferenceFieldBinding");Se({property:d,value:n,setValue:r});const b=n&&n instanceof Pe?n.path:d.path;return o.jsxs(c.FormControl,{error:i,fullWidth:!0,children:[o.jsx(ec,{name:d.name,path:b,forceFilter:d.forceFilter,previewProperties:d.previewProperties,value:n,disabled:!!d.disabled,setValue:r}),u&&o.jsx(xe,{property:d}),i&&o.jsx(c.FormHelperText,{error:!0,children:t})]})}function Qi({propertyKey:e,value:n,showError:r,disabled:t,property:i,setValue:s,tableMode:l,includeDescription:a,underlyingValueHasChanged:d,autoFocus:u,context:f}){const h=i.pickOnlySomeKeys||!1,b=(i.expanded===void 0?!0:i.expanded)||u;if(!i.properties)throw Error(`You need to specify a 'properties' prop (or specify a custom field) in your map property ${e}`);let p;h?n?p=gi(i.properties,...Object.keys(n).filter(w=>w in i.properties)):p={}:p=i.properties,Se({property:i,value:n,setValue:s});const g=o.jsxs(o.Fragment,{children:[o.jsx(c.Box,{sx:{py:1,display:"flex",flexDirection:"column",gap:2},children:Object.entries(p).filter(([w,E])=>!Vo(E)).map(([w,E],x)=>{const m={propertyKey:`${e}.${w}`,disabled:t,property:E,includeDescription:a,underlyingValueHasChanged:d,context:f,tableMode:!1,partOfArray:!1,autoFocus:u&&x===0};return o.jsx("div",{children:o.jsx(so,{...m})},`map-${e}-${x}`)})}),h&&nc(t,i.properties,s,n)]}),v=o.jsx(Ce,{icon:ye(i),required:i.validation?.required,title:i.name});return o.jsxs(c.FormControl,{fullWidth:!0,error:r,children:[!l&&o.jsx(qe,{initiallyExpanded:b,title:v,children:g}),l&&g,a&&o.jsx(xe,{property:i})]})}const nc=(e,n,r,t)=>{const i=Object.keys(n).filter(l=>!t||!(l in t)),s=l=>{r({...t,[l.target.value]:null})};return i.length?o.jsx(c.Box,{m:1,children:o.jsxs(c.FormControl,{fullWidth:!0,children:[o.jsx(c.InputLabel,{children:"Add property"}),o.jsx(c.Select,{variant:"standard",value:"",disabled:e,onChange:s,children:i.map(l=>o.jsx(c.MenuItem,{value:l,children:n[l].name||l},l))})]})}):o.jsx(o.Fragment,{})};function Oi({propertyKey:e,value:n,showError:r,disabled:t,property:i,setValue:s,tableMode:l,includeDescription:a,underlyingValueHasChanged:d,autoFocus:u,context:f}){const h=(i.expanded===void 0?!0:i.expanded)||u;if(!i.keyValue)throw Error(`Your property ${e} needs to have the 'keyValue' prop in order to use this field binding`);const b=o.jsx(Fr,{value:n,setValue:s,disabled:t,fieldName:i.name??e}),p=o.jsx(Ce,{icon:ye(i),required:i.validation?.required,title:i.name});return o.jsxs(c.FormControl,{fullWidth:!0,error:r,children:[!l&&o.jsx(qe,{initiallyExpanded:h,title:p,children:b}),l&&b,a&&o.jsx(xe,{property:i})]})}function rc({rowId:e,fieldKey:n,value:r,onFieldKeyChange:t,onDeleteClick:i,setValue:s,entryValue:l,dataType:a,updateDataType:d,disabled:u}){const[f,h]=A.useState(null),b=!!f,p=E=>{h(E.currentTarget)},g=()=>{h(null)};function v(E,x,m){return m==="string"||m==="number"?o.jsx(zo,{value:E,inputType:m==="number"?"number":"text",small:!0,disabled:u||!x,onChange:C=>{if(m==="number"){const B=C.target.value?parseFloat(C.target.value):void 0;B&&isNaN(B)?s({...r,[x]:null}):B!=null?s({...r,[x]:B}):s({...r,[x]:null})}else s({...r,[x]:C.target.value})}},m):m==="date"?o.jsx(Dn,{value:E,small:!0,disabled:u||!x,onChange:C=>{s({...r,[x]:C})}}):m==="boolean"?o.jsx(En,{value:E,small:!0,position:"start",disabled:u||!x,onChange:C=>{const B=C.target.checked;s({...r,[x]:B})}}):m==="array"?o.jsx(c.Box,{sx:C=>({ml:1,pl:1,borderLeft:`1px solid ${C.palette.divider}`}),children:o.jsx(tt,{value:E,newDefaultEntry:"",droppableId:e.toString(),addLabel:x?`Add to ${x}`:"Add",small:!0,disabled:u||!x,includeAddButton:!0,onValueChange:C=>{s({...r,[x]:C})},buildEntry:(C,B)=>o.jsx(tc,{index:C,id:B,value:E[C],disabled:u||!x,setValue:S=>{const k=[...E];k[C]=S,s({...r,[x]:k})}})})}):m==="map"?o.jsx(c.Box,{sx:C=>({ml:1,pl:1,borderLeft:`1px solid ${C.palette.divider}`}),children:o.jsx(Fr,{value:E,fieldName:x,setValue:C=>{s({...r,[x]:C})}})}):o.jsx(c.Typography,{variant:"caption",children:`Data type ${m} not supported yet`})}function w(E){d(e,E),g()}return o.jsxs(o.Fragment,{children:[o.jsxs(c.Typography,{component:"div",className:"mono",sx:{display:"flex",flexDirection:"row",gap:1,alignItems:"center"},children:[o.jsx(c.Box,{sx:{width:"200px",maxWidth:"25%"},children:o.jsx(zo,{value:n,disabled:u||!!l,small:!0,onChange:E=>{t(E.target.value)}})}),o.jsx(c.Box,{sx:{flexGrow:1},children:a!=="map"&&a!=="array"&&v(l,n,a)}),o.jsx(c.IconButton,{size:"small",sx:E=>({background:E.palette.background.default,height:"28px",width:"28px"}),onClick:p,children:o.jsx(St,{})}),o.jsx(c.IconButton,{"aria-label":"delete",size:"small",onClick:i,sx:{height:"28px",width:"28px"},children:o.jsx(en,{fontSize:"small"})})]},e.toString()),(a==="map"||a==="array")&&v(l,n,a),o.jsxs(kt,{anchorEl:f,open:b,onClose:g,children:[o.jsx(De,{dense:!0,onClick:()=>w("string"),children:"string"}),o.jsx(De,{dense:!0,onClick:()=>w("number"),children:"number"}),o.jsx(De,{dense:!0,onClick:()=>w("boolean"),children:"boolean"}),o.jsx(De,{dense:!0,onClick:()=>w("date"),children:"date"}),o.jsx(De,{dense:!0,onClick:()=>w("map"),children:"map"}),o.jsx(De,{dense:!0,onClick:()=>w("array"),children:"array"})]})]})}function tc({id:e,index:n,value:r,setValue:t}){const[i,s]=A.useState(Tr(r)??"string");function l(p){s(p),h()}const[a,d]=A.useState(null),u=!!a,f=p=>{d(p.currentTarget)},h=()=>{d(null)};function b(p,g){return g==="string"||g==="number"?o.jsx(zo,{value:p,inputType:g==="number"?"number":"text",small:!0,onChange:v=>{if(g==="number"){const w=v.target.value?parseFloat(v.target.value):void 0;w&&isNaN(w)?t(null):w!=null?t(w):t(null)}else t(v.target.value)}}):g==="date"?o.jsx(Dn,{value:p,small:!0,onChange:v=>{t(v)}}):g==="boolean"?o.jsx(En,{value:p,small:!0,position:"start",onChange:v=>{t(v.target.checked)}}):g==="array"?o.jsx(c.Typography,{variant:"caption",children:"Arrays of arrays are not supported."}):g==="map"?o.jsx(c.Box,{sx:v=>({ml:1,pl:1,borderLeft:`1px solid ${v.palette.divider}`}),children:o.jsx(Fr,{value:p,setValue:v=>{t(v)}})}):o.jsx(c.Typography,{variant:"caption",children:`Data type ${g} not supported yet`})}return o.jsxs(o.Fragment,{children:[o.jsxs(c.Typography,{component:"div",className:"mono",sx:{display:"flex",minHeight:"48px",flexDirection:"row",gap:1,alignItems:"center"},children:[o.jsx(c.Box,{sx:{flexGrow:1},children:i!=="map"&&b(r,i)}),o.jsx(c.IconButton,{size:"small",sx:p=>({background:p.palette.background.default,height:"28px",width:"28px"}),onClick:f,children:o.jsx(St,{})})]},e.toString()),i==="map"&&b(r,i),o.jsxs(kt,{anchorEl:a,open:u,onClose:h,children:[o.jsx(De,{dense:!0,onClick:()=>l("string"),children:"string"}),o.jsx(De,{dense:!0,onClick:()=>l("number"),children:"number"}),o.jsx(De,{dense:!0,onClick:()=>l("boolean"),children:"boolean"}),o.jsx(De,{dense:!0,onClick:()=>l("map"),children:"map"}),o.jsx(De,{dense:!0,onClick:()=>l("date"),children:"date"})]})]})}function Fr({value:e,setValue:n,fieldName:r,disabled:t}){const[i,s]=A.useState(Object.keys(e??{}).map(d=>[Ir(),{key:d,dataType:Tr(e[d])??"string"}]));A.useEffect(()=>{const d=i.map(([p,{key:g}])=>g),u=Object.entries(e??{}).filter(([p,g])=>g!==void 0).map(([p])=>p),f=u.filter(p=>!d.includes(p)),h=d.filter(p=>!u.includes(p)),b=[...i];f.forEach(p=>{b.push([Ir(),{key:p,dataType:Tr(e[p])??"string"}])}),h.forEach(p=>{const g=b.findIndex(([v,{key:w}])=>w===p);b.splice(g,1)}),s(b)},[e]);const l=A.useRef(e),a=(d,u)=>{if(!d){console.warn("No key selected for data type update");return}s(i.map(f=>f[0]===d?[f[0],{key:f[1].key,dataType:u}]:f)),n({...e,[i.find(f=>f[0]===d)?.[1].key??""]:gr(u)})};return o.jsxs(c.Box,{sx:{py:1,display:"flex",flexDirection:"column",gap:1},children:[i.map(([d,{key:u,dataType:f}],h)=>{const b=u?e[u]:"",p=g=>{if(s(i.map(w=>w[0]===d?[d,{key:g??"",dataType:w[1].dataType}]:w)),typeof e=="object"&&g in e)return;const v={...e};l.current&&u in l.current?v[u]=void 0:delete v[u],n({...v,[g??""]:b})};return o.jsx(rc,{rowId:d,fieldKey:u,value:e,onDeleteClick:()=>{const g={...e};l.current&&u in l.current?g[u]=void 0:delete g[u],s(i.filter(v=>v[0]!==d)),n({...g})},onFieldKeyChange:p,setValue:n,entryValue:b,dataType:f,disabled:t,updateDataType:a},d)}),o.jsx(c.Box,{p:1,justifyContent:"center",textAlign:"left",children:o.jsx(c.Button,{variant:"text",size:"small",color:"primary",fullWidth:!1,disabled:t,startIcon:o.jsx(Ft,{}),onClick:()=>{n({...e,"":null}),s([...i,[Ir(),{key:"",dataType:"string"}]])},children:r?`Add to ${r}`:"Add"})})]})}function Ir(){return Math.floor(Math.random()*Math.floor(Number.MAX_SAFE_INTEGER))}function Tr(e){if(typeof e=="string")return"string";if(typeof e=="number")return"number";if(typeof e=="boolean")return"boolean";if(Array.isArray(e))return"array";if(e instanceof Date)return"date";if(e instanceof Pe)return"reference";if(e instanceof Oo)return"geopoint";if(typeof e=="object")return"map"}function qe({title:e,children:n,invisible:r=!1,initiallyExpanded:t=!0,highlightOnHover:i=!1,padding:s=1,dark:l=!0,onExpandedChange:a}){const[d,u]=A.useState(!1),f=A.useCallback(()=>u(!0),[]),h=A.useCallback(()=>u(!1),[]),[b,p]=A.useState(t);return o.jsxs(c.Accordion,{variant:"outlined",onMouseEnter:f,onMouseMove:f,onMouseLeave:h,disableGutters:!0,expanded:b,sx:g=>({backgroundColor:r?"transparent":l?d&&i?ri(g):"transparent":"inherit",borderRadius:r?0:`${g.shape.borderRadius}px`,border:r?"none":void 0,"&::before":{display:"none"}}),TransitionProps:{unmountOnExit:!0},onChange:A.useCallback((g,v)=>{a?.(v),p(v)},[a]),children:[o.jsx(c.AccordionSummary,{expandIcon:o.jsx(yl,{}),sx:g=>({color:g.palette.text.secondary,padding:r?0:void 0,minHeight:"56px",alignItems:"center",borderTopLeftRadius:`${g.shape.borderRadius}px`,borderTopRightRadius:`${g.shape.borderRadius}px`,borderBottomLeftRadius:!b&&!r?`${g.shape.borderRadius}px`:void 0,borderBottomRightRadius:!b&&!r?`${g.shape.borderRadius}px`:void 0,border:r?"none":void 0,borderBottom:r?`1px solid ${g.palette.divider}`:void 0,"&.Mui-expanded":{borderBottom:`1px solid ${g.palette.divider}`}}),children:e}),o.jsx(c.AccordionDetails,{sx:g=>({padding:r?0:typeof s=="string"?s:g.spacing(s),py:g.spacing(2),border:r?"none":void 0,color:"inherit"}),children:n})]})}function Gi({propertyKey:e,value:n,error:r,showError:t,isSubmitting:i,setValue:s,setFieldValue:l,tableMode:a,property:d,includeDescription:u,underlyingValueHasChanged:f,context:h,disabled:b}){if(!d.of)throw Error("RepeatFieldBinding misconfiguration. Property `of` not set");if(!d.resolvedProperties||!Array.isArray(d.resolvedProperties))throw Error("RepeatFieldBinding - Internal error: Expected array in 'property.resolvedProperties'");const p=d.expanded===void 0?!0:d.expanded,g=d.of,[v,w]=A.useState();Se({property:d,value:n,setValue:s});const E=(C,B)=>{const S=d.resolvedProperties[C]??g,k={propertyKey:`${e}.${C}`,disabled:b,property:S,includeDescription:u,underlyingValueHasChanged:f,context:h,tableMode:!1,partOfArray:!0,autoFocus:B===v};return o.jsx(so,{...k})},x=o.jsx(xn,{value:n,addLabel:d.name?"Add entry to "+d.name:"Add entry",name:e,setFieldValue:l,buildEntry:E,onInternalIdAdded:w,disabled:i||!!d.disabled,includeAddButton:!d.disabled,newDefaultEntry:d.of.defaultValue}),m=o.jsx(Ce,{icon:ye(d),required:d.validation?.required,title:d.name});return o.jsxs(c.FormControl,{fullWidth:!0,error:t,children:[!a&&o.jsx(qe,{initiallyExpanded:p,title:m,children:x}),a&&x,u&&o.jsx(xe,{property:d}),t&&typeof r=="string"&&o.jsx(c.FormHelperText,{error:!0,children:r})]})}function Li({propertyKey:e,value:n,error:r,showError:t,isSubmitting:i,setValue:s,setFieldValue:l,tableMode:a,property:d,includeDescription:u,underlyingValueHasChanged:f,context:h,disabled:b}){if(!d.oneOf)throw Error("ArrayOneOfField misconfiguration. Property `oneOf` not set");const p=d.expanded===void 0?!0:d.expanded;Se({property:d,value:n,setValue:s});const[g,v]=A.useState(),w=A.useCallback((C,B)=>o.jsx(ic,{name:`${e}.${C}`,index:C,value:n[C],typeField:d.oneOf.typeField??Lo,valueField:d.oneOf.valueField??pn,properties:d.oneOf.properties,autoFocus:B===g,context:h},`array_one_of_${C}`),[h,g,d.oneOf,e,n]),E=o.jsx(Ce,{icon:ye(d),required:d.validation?.required,title:d.name}),x=Object.keys(d.oneOf.properties)[0],m=o.jsx(xn,{value:n,name:e,addLabel:d.name?"Add entry to "+d.name:"Add entry",buildEntry:w,onInternalIdAdded:v,disabled:i||!!d.disabled,includeAddButton:!d.disabled,setFieldValue:l,newDefaultEntry:{[d.oneOf.typeField??Lo]:x,[d.oneOf.valueField??pn]:vn(d.oneOf.properties[x])}});return o.jsxs(c.FormControl,{fullWidth:!0,error:t,children:[!a&&o.jsx(qe,{initiallyExpanded:p,title:E,children:m}),a&&m,u&&o.jsx(xe,{property:d}),t&&typeof r=="string"&&o.jsx(c.FormHelperText,{error:!0,children:r})]})}function ic({name:e,index:n,value:r,typeField:t,valueField:i,properties:s,autoFocus:l,context:a}){const d=r&&r[t],[u,f]=A.useState(d??void 0),h=me.useFormikContext();A.useEffect(()=>{d||E(Object.keys(s)[0])},[]),A.useEffect(()=>{d!==u&&f(d)},[d]);const b=u?s[u]:void 0,p=Object.entries(s).map(([x,m])=>({id:x,label:m.name??x})),g=`${e}.${t}`,v=`${e}.${i}`,w=b?{propertyKey:v,property:b,context:a,autoFocus:l,tableMode:!1}:void 0,E=x=>{const m=x?s[x]:void 0;f(x),h.setFieldTouched(g),h.setFieldValue(g,x),h.setFieldValue(v,m?vn(m):null)};return o.jsxs(c.Paper,{sx:x=>({background:"transparent",padding:x.spacing(1),my:1,py:2}),elevation:0,children:[o.jsx(me.FastField,{required:!0,name:g,children:x=>o.jsxs(c.FormControl,{fullWidth:!0,size:"small",children:[o.jsx(c.InputLabel,{id:`${e}_${n}_select_label`,children:o.jsx("span",{children:"Type"})}),o.jsx(c.Select,{fullWidth:!0,sx:{marginBottom:2},labelId:`${e}_${n}_select_label`,label:"Type",value:x.field.value!==void 0&&x.field.value!==null?x.field.value:"",onChange:m=>{const C=m.target.value;E(C)},renderValue:m=>o.jsx(Ie,{enumKey:m,enumValues:p,small:!0}),children:p.map(m=>{const C=m.id;return o.jsx(c.MenuItem,{value:C,children:o.jsx(Ie,{enumKey:C,enumValues:p,small:!0})},`select_${e}_${n}_${C}`)})})]})}),w&&o.jsx(c.FormControl,{fullWidth:!0,children:o.jsx(so,{...w})},`form_control_${e}_${u}`)]})}const sc=new xt;Re.use(Re.Plugins.AutoResize,{min:100}),Re.unuse(Re.Plugins.FontUnderline),Re.unuse(Re.Plugins.Clear);function $i({propertyKey:e,value:n,setValue:r,error:t,showError:i,disabled:s,autoFocus:l,touched:a,property:d,tableMode:u,includeDescription:f,context:h}){const[b,p]=A.useState(n),g=A.useRef(n),v=A.useDeferredValue({internalValue:b,value:n});return A.useEffect(()=>{g.current=n,p(n)},[n]),A.useEffect(()=>{v.internalValue!==g.current&&r(v.internalValue)},[v]),o.jsxs(lc,{required:d.validation?.required,error:i,fullWidth:!0,children:[!u&&o.jsx(c.FormHelperText,{filled:!0,children:o.jsx(Ce,{icon:ye(d),required:d.validation?.required,title:d.name})}),o.jsx(Re,{value:b??"",readOnly:s,renderHTML:w=>sc.render(w),view:{menu:!0,md:!0,html:!1},onChange:({html:w,text:E})=>{p(E??null)}}),o.jsx(c.Box,{display:"flex",children:o.jsxs(c.Box,{flexGrow:1,children:[i&&typeof t=="string"&&o.jsx(c.FormHelperText,{error:!0,children:t}),f&&o.jsx(xe,{property:d})]})})]})}const lc=be.styled(c.FormControl)(({theme:e})=>`
  @font-face {
    font-family: rmel-iconfont;
    src: url(data:application/vnd.ms-fontobject;base64,fBkAAMAYAAABAAIAAAAAAAIABQMAAAAAAAABAJABAAAAAExQAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAB9vj4gAAAAAAAAAAAAAAAAAAAAAAABoAcgBtAGUAbAAtAGkAYwBvAG4AZgBvAG4AdAAAAA4AUgBlAGcAdQBsAGEAcgAAABYAVgBlAHIAcwBpAG8AbgAgADEALgAwAAAAGgByAG0AZQBsAC0AaQBjAG8AbgBmAG8AbgB0AAAAAAAAAQAAAAsAgAADADBHU1VCsP6z7QAAATgAAABCT1MvMj3jT5QAAAF8AAAAVmNtYXBA5I9dAAACPAAAAwhnbHlmMImhbQAABXwAAA9gaGVhZBtQ+k8AAADgAAAANmhoZWEH3gObAAAAvAAAACRobXR4aAAAAAAAAdQAAABobG9jYTX6MgAAAAVEAAAANm1heHABMAB7AAABGAAAACBuYW1lc9ztwgAAFNwAAAKpcG9zdCcpv64AABeIAAABNQABAAADgP+AAFwEAAAAAAAEAAABAAAAAAAAAAAAAAAAAAAAGgABAAAAAQAA4uPbB18PPPUACwQAAAAAANwY2ykAAAAA3BjbKQAA//8EAAMBAAAACAACAAAAAAAAAAEAAAAaAG8ADAAAAAAAAgAAAAoACgAAAP8AAAAAAAAAAQAAAAoAHgAsAAFERkxUAAgABAAAAAAAAAABAAAAAWxpZ2EACAAAAAEAAAABAAQABAAAAAEACAABAAYAAAABAAAAAAABBAABkAAFAAgCiQLMAAAAjwKJAswAAAHrADIBCAAAAgAFAwAAAAAAAAAAAAAAAAAAAAAAAAAAAABQZkVkAEDnbe2iA4D/gABcA4AAgAAAAAEAAAAAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAAAAAUAAAADAAAALAAAAAQAAAHMAAEAAAAAAMYAAwABAAAALAADAAoAAAHMAAQAmgAAABYAEAADAAbnbelB7TztRe1h7XXteO2A7Y3tov//AADnbelB7TvtRO1f7W/td+2A7Yztn///AAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAWABYAFgAYABoAHgAqACwALAAuAAAAAQAEAAUAAwAGAAcACAAJAAoACwAMAA0ADgAPABAAEQASABMAAgAUABUAFgAXABgAGQAAAQYAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAABPAAAAAAAAAAZAADnbQAA520AAAABAADpQQAA6UEAAAAEAADtOwAA7TsAAAAFAADtPAAA7TwAAAADAADtRAAA7UQAAAAGAADtRQAA7UUAAAAHAADtXwAA7V8AAAAIAADtYAAA7WAAAAAJAADtYQAA7WEAAAAKAADtbwAA7W8AAAALAADtcAAA7XAAAAAMAADtcQAA7XEAAAANAADtcgAA7XIAAAAOAADtcwAA7XMAAAAPAADtdAAA7XQAAAAQAADtdQAA7XUAAAARAADtdwAA7XcAAAASAADteAAA7XgAAAATAADtgAAA7YAAAAACAADtjAAA7YwAAAAUAADtjQAA7Y0AAAAVAADtnwAA7Z8AAAAWAADtoAAA7aAAAAAXAADtoQAA7aEAAAAYAADtogAA7aIAAAAZAAAAAABmAMwBHgGEAbwB/gJmAsgC/gM0A3IDogRABKgE7gUuBXAFygYKBmoGpAbEBugHRgewAAAABQAAAAADVgLWAAsAGAAlADQAQAAAEyEyFhQGByEuATQ2Fz4BNyEeARQGIyEiJgM0NjchHgEUBiMhIiY3PgEzITIeARQOASMhIiYnFhQPAQYmNRE0NhfWAlQSGRkS/awSGRnaARgTAWASGRkS/qASGfQZEgJUEhkZEv2sEhnzARgTAWAMFAsLFAz+oBIZOQgIkgseHgsC1RklGAEBGCUZ8hMYAQEYJRkZ/oUTGAEBGCUZGdkSGQsVFxQMGoYGFgaVDAwRASoRDAwAAAAADAAAAAADqwKrAA8AEwAXABsAHwAjACcAMwA3ADsAPwBDAAABIQ4BBwMeARchPgE3ES4BBTMVIxUzFSMnMxUjFTMVKwI1MzUjNTMBISImNDYzITIWFAY3IzUzNSM1MxcjNTM1IzUzA1X9ViQwAQEBMSQCqiQxAQEx/lxWVlZWgFZWVlYqVlZWVgFV/wASGBgSAQASGBgZVlZWVoBWVlZWAqsBMST+ViQxAQExJAGqJDF/VipW1lYqVlYqVv6AGCQZGSQYqlYqVtZWKlYAAwAAAAADKwMAAA8AHwAzAAAlHgEXIT4BNxEuASchDgEHMyEyFhcRDgEHIS4BJxE+ASUnJisBIg8BIyIGFBYzITI2NCYjAQABMCQBViQwAQEwJP6qJDABgAEAExcBARcT/wATFwEBFwEoHgsStBILHmsTFxcTAgARGRkRVSQwAQEwJAGrJDABATAkFxT+qxEZAQEZEQFVFBfVHg0NHhcnFxcnFwADAAAAAAOrAtkAFgAtAD4AAAEVBg8BBiIvASY0PwEnJjQ/ATYyHwEWBTc2NC8BJiIPAQYHFRYfARYyPwE2NCcBJyYGBwMGFh8BFjY3EzYmJwOrAQmwBxEHHgYGk5MGBh4HEQewCf0PkwYGHwYSBrAJAQEJsAcRBx4GBgFCKQkPBOMCBwgoCQ8E4gMHCQGIEA0KsAYGHgcRBpOTBhIGHgYGsAoVkwYRBx4GBrAKDRANCrAGBh4GEgYB2Q8DBwj9jAgQAw4DBwgCcwgPBAACAAAAAAOaAm8AEAAhAAAlJzc2NCYiDwEGFB8BFjI2NCU3JyY0NjIfARYUDwEGIiY0AXOmpg0ZJAzEDQ3EDiEaAQ2mpg0aIQ7EDQ3EDiEa2qamDiEaDcQNIg3EDRohDqamDCQZDcQNIg3EDRkkAAAAAwAAAAADuAKsAAsAFwAjAAABDgEHHgEXPgE3LgEDLgEnPgE3HgEXDgEDDgEHHgEXPgE3LgECAJjrNTXrmJjrNTXrmFZwAgJwVlZwAgJwVjRDAQFDNDRDAQFDAqwCpIaGpAICpIaGpP4OAnBWVnACAnBWVnABPgFDNDRDAQFDNDRDAAAABQAAAAADgAKrAAsAFwAjADAAQAAAEyEyNjQmIyEiBhQWFyE+ATQmJyEOARQWEyEyNjQmIyEiBhQWJx4BFyE+ATQmJyEOASUhHgEXEQ4BByEuATURNDarAQATFxcT/wARGRkRAQATFxcT/wARGRkRAQATFxcT/wARGRkaARkRAQATFxcT/wARGQHUAQARGQEBGRH/ABMXFwEAFycXFycXqwEZIhkBARkiGQFVFycXFycX1RMXAQEXJhcBARcYARcT/gARGQEBGRECABMXAAAAAAMAAAAAA6sCVgAZACYAQAAAASMiBhQWOwEeARcOAQcjIgYUFjsBPgE3LgEFHgEXIT4BNCYnIQ4BFyMuASc+ATczMjY0JisBDgEHHgEXMzI2NCYC1YASGBgSgDdIAQFIN4ASGBgSgFt4AwN4/iUBGBIBABIYGBL/ABIYVYA3SAEBSDeAEhgYEoBbeAMDeFuAEhgYAlUYJBkBSTY2SQEZJBgCeFtbeNMSGAEBGCQYAQEYkgFJNjZJARkkGAJ4W1t4AhgkGQABAAAAAAOsAisAHgAAAS4BJw4BBwYWFxY2Nz4BNzIWFwcGFhczPgE3NS4BBwMSO5ZVh9Q4ChMXFCMJK6FnP28sURMTHu4SGAECMRYBvDQ6AQKJchcqCAYPElZpASslUhYxAgEYEu8dFBMAAAABAAAAAAOyAisAHgAAAQ4BBycmBgcVHgEXMz4BLwE+ATMeARceATc+AScuAQIUVZY7URYxAgEYEu4eFBNSLW8+Z6ErCSQTFxMKOdMCKwE6NFAUFB3vEhgBAjEWUiUrAWlWEg8GCCoXcokAAAADAAAAAAL1Ar8AFAAcACQAAAE+ATcuAScjDgEHER4BFyE+ATc0JiUzHgEUBgcjEyM1Mx4BFAYCkyEpAQJmTu8UGQEBGRQBB0lpAjT+1IgdJycdiJ+fnx0nJwGKF0QkTmYCARoT/d4TGgECYUk1UtkBJjsmAf7viQEmOyYAAQAAAAADEgK/ABwAAAEeARczAyMOARQWFzM+ATQmJyMTMz4BNCYnIw4BAaUBJh0hnDsdJiYd5B0mJh0hnDsdJiYd5B0mAnodJgH+lAEmOicBASc6JgEBbAEmOicBAScABgAAAAADlgLWAAsAFwAjAEEAUgBuAAABIT4BNCYnIQ4BFBYBIQ4BFBYXIT4BNCYDIQ4BFBYXIT4BNCYFIyIGFBY7ARUjIgYUFjsBFSMiBhQWOwEyNjc1LgEDMxUeATI2PQE0JisBIgYUFhcjIgYUFjsBBwYdARQWOwEyNjQmKwE3Nj0BLgEBawIAEhgYEv4AEhkZAhL+ABIZGRICABIYGBL+ABIZGRICABIYGP1YVQkMDAlAFQoLCwoVQAkMDAlVCgsBAQtfFQELEwwMCSsJDAxeVQkMDAk3RwUMCVUKCwsKN0gFAQsCVQEYJBgBARgkGP5VARgkGAEBGCQYAQEBGCQYAQEYJBjVDBIMFgwSDBYMEgwMCYAJDAHWawkMDAmACQwMEgzWDBIMVAYICQkMDBIMVAYICQkMAAAAAAYAAAAAA4sCwAAIABEAGgAmADIAPwAAEw4BFBYyNjQmAw4BFBYyNjQmAw4BFBYyNjQmFyE+ATQmJyEOARQWNyE+ATQmJyEOARQWAx4BFyE+ATQmJyEOAbUbJCQ3JCQcGyQkNyQkHBskJDYlJI8CABIYGBL+ABIYGBICABIYGBL+ABIYGBkBGBICABIYGBL+ABIYAcABJDYkJDYkAQEBJDYkJDYk/gEBJDYkJDYkagEYJBgBARgkGP8BGCQYAQEYJBgBKhIYAQEYJBgBARgAAAACAAAAAANWAlYAFgAtAAAlMjY/ATY9AS4BKwEiBh0BFBYXMwcGFgUyNj8BNj0BNCYrASIGBxUeARczBwYWATIRGwc9CQEYEqsSGBgSViwOIAHMEBsIPAkYEqsSGAEBGBJVLA0gqxEOeRIUwhIYGBKrEhgBWB4zAREOeRIUwhIYGBKrEhgBWB4zAAAAAAMAAAAAA4ACwAAIABkAJQAAJT4BNzUjFR4BAR4BFzMVMzUzPgE0JichDgEDIT4BNCYnIQ4BFBYCACQwAaoBMP75ASQblqqWGyQkG/4qGyQrAqoSGRkS/VYSGRlAATAkKyskMAI/GyQBgIABJDYkAQEk/noBGCQYAQEYJBgAAAAAAgAA//8DKwMBABsAKAAAJT4BNxEuASIGBxEUBgcGLgI1ES4BIgYHER4BBx4BMyEyNjQmIyEiBgIiYnoCAR4tHgFBNSFBNR0BHi0eAQOm1AEYEgIAEhgYEv4AEhitD5NlARcWHh4W/uQ3UwwHDys8IwEgFh4eFv7gdpR2EhkZJBgYAAAAAwAAAAADcALHAAsALQA5AAATIT4BNCYjISIGFBYFISIGFBYXITIWFxYGByM1LgEPAQYUHwEWNjc1Mz4BJy4BBSMiBhQWFzM+ATQmwAJVEhkZEv2rEhgYAgv+BxIYGBICBiAzBgUxKGABGQtMBgZMDBgBVU1iBQhk/m2rEhgYEqsSGBgCcQEYJBgYJBisGCQYAScgKTkCIg8KCkwHEQdMCgoPIgJrTkRV/xgkGAEBGCQYAAAAAgAAAAADlgLAABQAKAAAARQWFzMRHgEyNjcRMz4BNCYnIQ4BAzMVFBYyNjc1MzI2NCYnIQ4BFBYBayQclQEkNiQBlRwkJBz+VhwkwEAkNyQBQBskJBv/ABwkJAKAGyQB/kAbJCQbAcABJDYkAQEk/tDrGyQkG+skNyQBASQ3JAAKAAAAAAN4AvgADwAWABoAIQAlACkALQA0ADgAPwAAASEOAQcRHgEXIT4BNxEuAQEjIiY9ATM1IzUzNSM1NDY7ARMjNTM1IzUzNSM1MxMjNTMVFAY3IzUzNSM1MzIWFQMs/aggKgEBKiACWCAqAQEq/h5xDxaWlpaWFg9x4ZaWlpaWlrxxlhYWlpaWcQ8WAvcBKiD9qCAqAQEqIAJYICr9XhYPcUuWS3EPFv2olkuWS5b9qJZxDxbhlkuWFg8AAAACAAD//wOAAwAADwAgAAAlES4BJyEOAQcRHgEXIT4BJRc3NjIfARYGIyEiJj8BPgEDgAEwJP2qJDABATAkAlYkMP39WYUHFAeVCAwN/gEOCwhqBxRVAlYkMAEBMCT9qiQwAQEw+2yqCAnHCxcXC4kIAQAAAAEAAAAAAzUCNgAQAAABBwYUFjI/ARcWMjY0LwEmIgHZ/hAhLBHX1xEsIRD+EC4CJv4RLCEQ19cQISwR/hAAAAABAAAAAAM1AjYAEgAAAQcnJiciDgEWHwEWMj8BNjQuAQLW1tcQFxEbDQYM/hEsEf4QIS0CJtfXDwESICAM/hAQ/hAtIAEAAAAEAAAAAANrAusAEAAhADMARAAANzMVFBYyNj0BNCYrASIGFBYTIyIGFBY7ATI2PQE0JiIGFQEyNj0BMzI2NCYrASIGHQEUFhM1NCYiBh0BFBY7ATI2NCYjyWgeLB0dFpwWHR1+aBYdHRacFh0dLB4BahYeaBYdHRacFh0dSh4sHR0WnBYdHRaxaBYdHRacFh0dLB4Bnh4sHR0WnBYdHRb9Xx0WaB4sHR0WnBYdAjloFh0dFpwWHR0sHgAAAAQAAAAAA1QC1AARACMANABGAAATDgEHFR4BFzM+ATQmKwE1NCYnPgE9ATMyNjQmJyMOAQcVHgEBIyIGFBYXMz4BNzUuASIGFQMeATsBFRQWMjY3NS4BJyMOAd0VGwEBGxWRFRsbFWEcFBQcYRUbGxWRFRsBARsCK2EVGxsVkRUbAQEbKRySARsVYRwpGwEBGxWRFRsBHwEbFZEVGwEBGykcYRUbwwEbFWEcKRsBARsVkRUb/qscKRsBARsVkRUbGxUBtRQcYRUbGxWRFRsBARsAAAAAAAASAN4AAQAAAAAAAAAVAAAAAQAAAAAAAQANABUAAQAAAAAAAgAHACIAAQAAAAAAAwANACkAAQAAAAAABAANADYAAQAAAAAABQALAEMAAQAAAAAABgANAE4AAQAAAAAACgArAFsAAQAAAAAACwATAIYAAwABBAkAAAAqAJkAAwABBAkAAQAaAMMAAwABBAkAAgAOAN0AAwABBAkAAwAaAOsAAwABBAkABAAaAQUAAwABBAkABQAWAR8AAwABBAkABgAaATUAAwABBAkACgBWAU8AAwABBAkACwAmAaUKQ3JlYXRlZCBieSBpY29uZm9udApybWVsLWljb25mb250UmVndWxhcnJtZWwtaWNvbmZvbnRybWVsLWljb25mb250VmVyc2lvbiAxLjBybWVsLWljb25mb250R2VuZXJhdGVkIGJ5IHN2ZzJ0dGYgZnJvbSBGb250ZWxsbyBwcm9qZWN0Lmh0dHA6Ly9mb250ZWxsby5jb20ACgBDAHIAZQBhAHQAZQBkACAAYgB5ACAAaQBjAG8AbgBmAG8AbgB0AAoAcgBtAGUAbAAtAGkAYwBvAG4AZgBvAG4AdABSAGUAZwB1AGwAYQByAHIAbQBlAGwALQBpAGMAbwBuAGYAbwBuAHQAcgBtAGUAbAAtAGkAYwBvAG4AZgBvAG4AdABWAGUAcgBzAGkAbwBuACAAMQAuADAAcgBtAGUAbAAtAGkAYwBvAG4AZgBvAG4AdABHAGUAbgBlAHIAYQB0AGUAZAAgAGIAeQAgAHMAdgBnADIAdAB0AGYAIABmAHIAbwBtACAARgBvAG4AdABlAGwAbABvACAAcAByAG8AagBlAGMAdAAuAGgAdAB0AHAAOgAvAC8AZgBvAG4AdABlAGwAbABvAC4AYwBvAG0AAAAAAgAAAAAAAAAKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAaAQIBAwEEAQUBBgEHAQgBCQEKAQsBDAENAQ4BDwEQAREBEgETARQBFQEWARcBGAEZARoBGwADdGFiCGtleWJvYXJkBmRlbGV0ZQpjb2RlLWJsb2NrBGNvZGUKdmlzaWJpbGl0eQp2aWV3LXNwbGl0BGxpbmsEcmVkbwR1bmRvBGJvbGQGaXRhbGljDGxpc3Qtb3JkZXJlZA5saXN0LXVub3JkZXJlZAVxdW90ZQ1zdHJpa2V0aHJvdWdoCXVuZGVybGluZQR3cmFwCWZvbnQtc2l6ZQRncmlkBWltYWdlC2V4cGFuZC1sZXNzC2V4cGFuZC1tb3JlD2Z1bGxzY3JlZW4tZXhpdApmdWxsc2NyZWVuAAAAAAA=);
    src: url(data:font/ttf;base64,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) format("truetype")
  }

  .rmel-iconfont {
    font-family: rmel-iconfont !important;
    font-size: 16px;
    font-style: normal;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale
  }

  .rmel-icon-tab:before {
    content: "\\e76d"
  }

  .rmel-icon-keyboard:before {
    content: "\\ed80"
  }

  .rmel-icon-delete:before {
    content: "\\ed3c"
  }

  .rmel-icon-code-block:before {
    content: "\\e941"
  }

  .rmel-icon-code:before {
    content: "\\ed3b"
  }

  .rmel-icon-visibility:before {
    content: "\\ed44"
  }

  .rmel-icon-view-split:before {
    content: "\\ed45"
  }

  .rmel-icon-link:before {
    content: "\\ed5f"
  }

  .rmel-icon-redo:before {
    content: "\\ed60"
  }

  .rmel-icon-undo:before {
    content: "\\ed61"
  }

  .rmel-icon-bold:before {
    content: "\\ed6f"
  }

  .rmel-icon-italic:before {
    content: "\\ed70"
  }

  .rmel-icon-list-ordered:before {
    content: "\\ed71"
  }

  .rmel-icon-list-unordered:before {
    content: "\\ed72"
  }

  .rmel-icon-quote:before {
    content: "\\ed73"
  }

  .rmel-icon-strikethrough:before {
    content: "\\ed74"
  }

  .rmel-icon-underline:before {
    content: "\\ed75"
  }

  .rmel-icon-wrap:before {
    content: "\\ed77"
  }

  .rmel-icon-font-size:before {
    content: "\\ed78"
  }

  .rmel-icon-grid:before {
    content: "\\ed8c"
  }

  .rmel-icon-image:before {
    content: "\\ed8d"
  }

  .rmel-icon-expand-less:before {
    content: "\\ed9f"
  }

  .rmel-icon-expand-more:before {
    content: "\\eda0"
  }

  .rmel-icon-fullscreen-exit:before {
    content: "\\eda1"
  }

  .rmel-icon-fullscreen:before {
    content: "\\eda2"
  }

  .rc-md-editor {
    padding-bottom: 1px;
    position: relative;
    -webkit-box-sizing: border-box;
    box-sizing: border-box;
    display: -webkit-box;
    display: -webkit-flex;
    display: -ms-flexbox;
    display: flex;
    overflow: hidden;
    -webkit-box-orient: vertical;
    -webkit-box-direction: normal;
    -webkit-flex-direction: column;
    -ms-flex-direction: column;
    flex-direction: column;
            border-radius: 6px;
            background-color: ${Oe(e)};
  }

  .rc-md-editor.full {
    width: 100%;
    height: 100% !important;
    position: fixed;
    left: 0;
    top: 0;
    z-index: 1000
  }

  .rc-md-editor .editor-container {
    -webkit-box-flex: 1;
    -webkit-flex: 1;
    -ms-flex: 1;
    flex: 1;
    display: -webkit-box;
    display: -webkit-flex;
    display: -ms-flexbox;
    display: flex;
    width: 100%;
    min-height: 0;
    position: relative;
                background-color: ${Oe(e)};

  }

  .rc-md-editor .editor-container > .section {
    -webkit-box-flex: 1;
    -webkit-flex-grow: 1;
    -ms-flex-positive: 1;
    flex-grow: 1;
    -webkit-flex-shrink: 1;
    -ms-flex-negative: 1;
    flex-shrink: 1;
    -webkit-flex-basis: 1px;
    -ms-flex-preferred-size: 1px;
    flex-basis: 1px;
    padding: 4px;
    
            border: none
  }

  .rc-md-editor .editor-container > .section.in-visible {
    display: none
  }

  .rc-md-editor .editor-container > .section > .section-container {
    padding: 8x 16px 16px
  }
  
  .rc-md-editor .editor-container > .section:last-child {
    border-radius: unset
  }

  .rc-md-editor .editor-container .sec-md {
    min-height: 0;
    min-width: 0
  }

  .rc-md-editor .editor-container .sec-md .input {
    display: block;
    -webkit-box-sizing: border-box;
    box-sizing: border-box;
    width: 100%;
    height: 100%;
    overflow-y: scroll;
    border: none;
    resize: none;
    outline: none;
    min-height: 0;
    color: inherit;
    font-size: 14px;
    line-height: 1.7;   
             background-color: ${Oe(e)};

  }

  .rc-md-editor .editor-container .sec-html {
    min-height: 0;
    min-width: 0;         
       background-color: ${Oe(e)};

  }

  .rc-md-editor .editor-container .sec-html .html-wrap {
    height: 100%;
    -webkit-box-sizing: border-box;
    box-sizing: border-box;
    overflow: auto
  }

  .custom-html-style {
    color: inherit
  }

  .custom-html-style h1 {
    font-size: 32px;
    padding: 0;
    border: none;
    font-weight: 700;
    margin: 32px 0;
    line-height: 1.2
  }

  .custom-html-style h2 {
    font-size: 24px;
    padding: 0;
    border: none;
    font-weight: 700;
    margin: 24px 0;
    line-height: 1.7
  }

  .custom-html-style h3 {
    font-size: 18px;
    margin: 18px 0;
    padding: 0;
    line-height: 1.7;
    border: none
  }

  .custom-html-style p {
    font-size: 14px;
    line-height: 1.7;
    margin: 8px 0
  }

  .custom-html-style a {
    color: ${c.darken(e.palette.text.secondary,0)}
  }

  .custom-html-style a:hover {
    text-decoration: none
  }

  .custom-html-style strong {
    font-weight: 700
  }

  .custom-html-style ol, .custom-html-style ul {
    font-size: 14px;
    line-height: 28px;
    padding-left: 36px
  }

  .custom-html-style li {
    margin-bottom: 8px;
    line-height: 1.7
  }

  .custom-html-style hr {
    margin-top: 20px;
    margin-bottom: 20px;
    border: 0;
    border-top: 1px solid ${e.palette.divider}
  }

  .custom-html-style pre {
    display: block;
    padding: 20px;
    line-height: 28px;
    word-break: break-word
  }

  .custom-html-style code, .custom-html-style pre {
    background-color: ${c.darken(e.palette.background.default,.1)};
    font-size: 14px;
    border-radius: 0;
    overflow-x: auto
  }

  .custom-html-style code {
    padding: 3px 0;
    margin: 0;
    word-break: normal
  }

  .custom-html-style code:after, .custom-html-style code:before {
    letter-spacing: 0
  }

  .custom-html-style blockquote {
    position: relative;
    margin: 16px 0;
    padding: 5px 8px 5px 30px;
    background: none repeat scroll 0 0 rgb(39 39 41);
    color: inherit;
    border: none;
    border-left: 10px solid #d6dbdf
  }

  .custom-html-style img, .custom-html-style video {
    max-width: 100%
  }

  .custom-html-style table {
    font-size: 14px;
    line-height: 1.7;
    max-width: 100%;
    overflow: auto;
    border: 1px solid ${e.palette.divider};
    border-collapse: collapse;
    border-spacing: 0;
    -webkit-box-sizing: border-box;
    box-sizing: border-box
  }

  .custom-html-style table td, .custom-html-style table th {
    word-break: break-all;
    word-wrap: break-word;
    white-space: normal
  }

  .custom-html-style table tr {
    border: 1px solid ${e.palette.divider}
  }

  .custom-html-style table tr:nth-of-type(2n) {
    background-color: transparent
  }

  .custom-html-style table th {
    text-align: center;
    font-weight: 700;
    border: 1px solid ${e.palette.divider};
    padding: 10px 6px;
    background-color: #f5f7fa;
    word-break: break-word
  }

  .custom-html-style table td {
    border: 1px solid ${e.palette.divider};
    text-align: left;
    padding: 10px 15px;
    word-break: break-word;
    min-width: 60px
  }

  .rc-md-editor .drop-wrap {
    display: block;
    position: absolute;
    left: 0;
    top: 28px;
    z-index: 2;
    min-width: 20px;
    padding: 10px 0;
    text-align: center;
    background-color: ${c.darken(e.palette.background.default,0)};
    border-color: ${e.palette.divider};
    border-style: solid;
    border-width: 1px
  }

  .rc-md-editor .drop-wrap.hidden {
    display: none !important
  }

  .rc-md-editor .rc-md-navigation {
    min-height: 38px;
    padding: 0 8px;
    -webkit-box-sizing: border-box;
    box-sizing: border-box;
    border-bottom: 1px solid ${e.palette.divider};
    font-size: 16px;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
    display: -webkit-box;
    display: -webkit-flex;
    display: -ms-flexbox;
    display: flex;
    -webkit-box-orient: horizontal;
    -webkit-box-direction: normal;
    -webkit-flex-direction: row;
    -ms-flex-direction: row;
    flex-direction: row;
    -webkit-box-pack: justify;
    -webkit-justify-content: space-between;
    -ms-flex-pack: justify;
    justify-content: space-between;
    
            color: "inherit",
            background-color: ${e.palette.mode==="light","rgb(39 39 41)"};
        
  }

  .rc-md-editor .rc-md-navigation.in-visible {
    display: none
  }

  .rc-md-editor .rc-md-navigation .navigation-nav {
    -webkit-box-align: center;
    -webkit-align-items: center;
    -ms-flex-align: center;
    align-items: center;
    -webkit-box-pack: center;
    -webkit-justify-content: center;
    -ms-flex-pack: center;
    justify-content: center;
    font-size: 14px;
    color: ${c.darken(e.palette.text.secondary,0)};
  }

  .rc-md-editor .rc-md-navigation .button-wrap, .rc-md-editor .rc-md-navigation .navigation-nav {
    display: -webkit-box;
    display: -webkit-flex;
    display: -ms-flexbox;
    display: flex;
    -webkit-box-orient: horizontal;
    -webkit-box-direction: normal;
    -webkit-flex-direction: row;
    -ms-flex-direction: row;
    flex-direction: row
  }

  .rc-md-editor .rc-md-navigation .button-wrap {
    -webkit-flex-wrap: wrap;
    -ms-flex-wrap: wrap;
    flex-wrap: wrap
  }

  .rc-md-editor .rc-md-navigation .button-wrap .button {
    position: relative;
    min-width: 22px;
    height: 28px;
    margin-left: 3px;
    margin-right: -2px;
    display: inline-block;
    cursor: pointer;
    line-height: 28px;
    text-align: center;
    color: ${e.palette.text.secondary};
  }

  .rc-md-editor .rc-md-navigation .button-wrap .button:hover {
    color: ${c.darken(e.palette.text.secondary,.2)};
  }

  .rc-md-editor .rc-md-navigation .button-wrap .button.disabled {
    color: ${c.darken(e.palette.text.disabled,0)};
    cursor: not-allowed
  }

  .rc-md-editor .rc-md-navigation .button-wrap .button:first-of-type {
    margin-left: 0
  }

  .rc-md-editor .rc-md-navigation .button-wrap .button:last-child {
    margin-right: 0
  }

  .rc-md-editor .rc-md-navigation .button-wrap .rmel-iconfont {
    font-size: 18px
  }

  .rc-md-editor .rc-md-navigation li, .rc-md-editor .rc-md-navigation ul {
    list-style: none;
    margin: 0;
    padding: 0
  }

  .rc-md-editor .rc-md-navigation .h1, .rc-md-editor .rc-md-navigation .h2, .rc-md-editor .rc-md-navigation .h3, .rc-md-editor .rc-md-navigation .h4, .rc-md-editor .rc-md-navigation .h5, .rc-md-editor .rc-md-navigation .h6, .rc-md-editor .rc-md-navigation h1, .rc-md-editor .rc-md-navigation h2, .rc-md-editor .rc-md-navigation h3, .rc-md-editor .rc-md-navigation h4, .rc-md-editor .rc-md-navigation h5, .rc-md-editor .rc-md-navigation h6 {
    font-family: inherit;
    font-weight: 500;
    color: inherit;
    padding: 0;
    margin: 0;
    line-height: 1.1
  }

  .rc-md-editor .rc-md-navigation h1 {
    font-size: 34px
  }

  .rc-md-editor .rc-md-navigation h2 {
    font-size: 30px
  }

  .rc-md-editor .rc-md-navigation h3 {
    font-size: 24px
  }

  .rc-md-editor .rc-md-navigation h4 {
    font-size: 18px
  }

  .rc-md-editor .rc-md-navigation h5 {
    font-size: 14px
  }

  .rc-md-editor .rc-md-navigation h6 {
    font-size: 12px
  }

  .rc-md-editor .tool-bar {
    position: absolute;
    z-index: 1;
    right: 8px;
    top: 8px
  }

  .rc-md-editor .tool-bar .button {
    min-width: 24px;
    height: 28px;
    margin-right: 5px;
    display: inline-block;
    cursor: pointer;
    font-size: 14px;
    line-height: 28px;
    text-align: center;
    color: #999
  }

  .rc-md-editor .tool-bar .button:hover {
    color: inherit
  }

  .rc-md-editor .rc-md-divider {
    display: block;
    width: 1px;
    background-color: ${c.darken(e.palette.background.paper,0)}
  }

  .rc-md-editor .table-list.wrap {
    position: relative;
    margin: 0 10px;
    -webkit-box-sizing: border-box;
    box-sizing: border-box
  }

  .rc-md-editor .table-list.wrap .list-item {
    position: absolute;
    top: 0;
    left: 0;
    display: inline-block;
    width: 20px;
    height: 20px;
    background-color: ${c.darken(e.palette.background.paper,.05)};
    border-radius: 4px
  }

  .rc-md-editor .table-list.wrap .list-item.active {
    background: ${c.lighten(e.palette.background.paper,.2)}
  }

  .rc-md-editor .tab-map-list .list-item {
    width: 120px;
    -webkit-box-sizing: border-box;
    box-sizing: border-box
  }

  .rc-md-editor .tab-map-list .list-item:hover {
    background: ${c.darken(e.palette.background.default,.1)}
  }

  .rc-md-editor .tab-map-list .list-item.active {
    font-weight: 700
  }

  .rc-md-editor .header-list .list-item {
    width: 100px;
    -webkit-box-sizing: border-box;
    box-sizing: border-box;
    padding: 8px 0
  }

  .rc-md-editor .header-list .list-item:hover {
    background: ${c.darken(e.palette.background.default,.1)}
  }

`);ke.addMethod(ke.array,"uniqueInArray",function(e=r=>r,n){return this.test("uniqueInArray",n,r=>!r||r.length===new Set(r.map(e)).size)});function Vi(e,n,r){const t={};return Object.entries(n).forEach(([i,s])=>{t[i]=Yo({property:s,customFieldValidator:r,name:i,entityId:e})}),ke.object().shape(t)}function Yo(e){const n=e.property;if(Me(n))throw console.error("Error in property",e),Error("Trying to create a yup mapping from a property builder. Please use resolved properties only");if(n.dataType==="string")return cc(e);if(n.dataType==="number")return dc(e);if(n.dataType==="boolean")return hc(e);if(n.dataType==="map")return ac(e);if(n.dataType==="array")return pc(e);if(n.dataType==="date")return uc(e);if(n.dataType==="geopoint")return Ac(e);if(n.dataType==="reference")return fc(e);throw console.error("Unsupported data type in yup mapping",n),Error("Unsupported data type in yup mapping")}function ac({property:e,entityId:n,customFieldValidator:r,name:t}){const i={};return e.validation,e.properties&&Object.entries(e.properties).forEach(([s,l])=>{i[s]=Yo({property:l,parentProperty:e,customFieldValidator:r,name:`${t}[${s}]`,entityId:n})}),ke.object().shape(i)}function cc({property:e,parentProperty:n,customFieldValidator:r,name:t,entityId:i}){let s=ke.string();const l=e.validation;if(e.enumValues){l?.required&&(s=s.required(l?.requiredMessage?l.requiredMessage:"Required"));const a=un(e.enumValues);s=s.oneOf((l?.required?a:[...a,null]).map(d=>d?.id??null)).nullable(!0)}if(l){if(s=l.required?s.required(l?.requiredMessage?l.requiredMessage:"Required").nullable(!0):s.notRequired().nullable(!0),l.unique&&r&&t&&(s=s.test("unique","This value already exists and should be unique",(a,d)=>r({name:t,property:e,parentProperty:n,value:a,entityId:i}))),(l.min||l.min===0)&&(s=s.min(l.min,`${e.name} must be min ${l.min} characters long`)),(l.max||l.max===0)&&(s=s.max(l.max,`${e.name} must be max ${l.max} characters long`)),l.matches){const a=typeof l.matches=="string"?wi(l.matches):l.matches;a&&(s=s.matches(a,l.matchesMessage?{message:l.matchesMessage}:void 0))}l.trim&&(s=s.trim()),l.lowercase&&(s=s.lowercase()),l.uppercase&&(s=s.uppercase()),e.email&&(s=s.email(`${e.name} must be an email`)),e.url&&(s=s.url(`${e.name} must be a url`))}else s=s.notRequired().nullable(!0);return s}function dc({property:e,parentProperty:n,customFieldValidator:r,name:t,entityId:i}){const s=e.validation;let l=ke.number().typeError("Must be a number");return s?(l=s.required?l.required(s.requiredMessage?s.requiredMessage:"Required").nullable(!0):l.notRequired().nullable(!0),s.unique&&r&&t&&(l=l.test("unique","This value already exists and should be unique",a=>r({name:t,property:e,parentProperty:n,value:a,entityId:i}))),(s.min||s.min===0)&&(l=l.min(s.min,`${e.name} must be higher or equal to ${s.min}`)),(s.max||s.max===0)&&(l=l.max(s.max,`${e.name} must be lower or equal to ${s.max}`)),(s.lessThan||s.lessThan===0)&&(l=l.lessThan(s.lessThan,`${e.name} must be higher than ${s.lessThan}`)),(s.moreThan||s.moreThan===0)&&(l=l.moreThan(s.moreThan,`${e.name} must be lower than ${s.moreThan}`)),s.positive&&(l=l.positive(`${e.name} must be positive`)),s.negative&&(l=l.negative(`${e.name} must be negative`)),s.integer&&(l=l.integer(`${e.name} must be an integer`))):l=l.notRequired().nullable(!0),l}function Ac({property:e,parentProperty:n,customFieldValidator:r,name:t,entityId:i}){let s=ke.object();const l=e.validation;return l?.unique&&r&&t&&(s=s.test("unique","This value already exists and should be unique",a=>r({name:t,property:e,parentProperty:n,value:a,entityId:i}))),l?.required?s=s.required(l.requiredMessage).nullable(!0):s=s.notRequired().nullable(!0),s}function uc({property:e,parentProperty:n,customFieldValidator:r,name:t,entityId:i}){if(e.autoValue)return ke.object().nullable();let s=ke.date();const l=e.validation;return l?(s=l.required?s.required(l?.requiredMessage?l.requiredMessage:"Required"):s.notRequired(),l.unique&&r&&t&&(s=s.test("unique","This value already exists and should be unique",a=>r({name:t,property:e,parentProperty:n,value:a,entityId:i}))),l.min&&(s=s.min(l.min,`${e.name} must be after ${l.min}`)),l.max&&(s=s.max(l.max,`${e.name} must be before ${l.min}`))):s=s.notRequired(),s.transform(a=>a instanceof Date?a:null).nullable()}function fc({property:e,parentProperty:n,customFieldValidator:r,name:t,entityId:i}){let s=ke.object();const l=e.validation;return l?(s=l.required?s.required(l?.requiredMessage?l.requiredMessage:"Required").nullable(!0):s.notRequired().nullable(!0),l.unique&&r&&t&&(s=s.test("unique","This value already exists and should be unique",a=>r({name:t,property:e,parentProperty:n,value:a,entityId:i})))):s=s.notRequired().nullable(!0),s}function hc({property:e,parentProperty:n,customFieldValidator:r,name:t,entityId:i}){let s=ke.boolean();const l=e.validation;return l?(s=l.required?s.required(l?.requiredMessage?l.requiredMessage:"Required").nullable(!0):s.notRequired().nullable(!0),l.unique&&r&&t&&(s=s.test("unique","This value already exists and should be unique",a=>r({name:t,property:e,parentProperty:n,value:a,entityId:i})))):s=s.notRequired().nullable(!0),s}function gc(e){return e.validation?.uniqueInArray?!0:e.dataType==="map"&&e.properties?Object.entries(e.properties).filter(([n,r])=>r.validation?.uniqueInArray):!1}function pc({property:e,parentProperty:n,customFieldValidator:r,name:t,entityId:i}){let s=ke.array();if(e.of)if(Array.isArray(e.of)){const a=e.of.map((d,u)=>({[`${t}[${u}]`]:Yo({property:d,parentProperty:e,entityId:i})})).reduce((d,u)=>({...d,...u}),{});return ke.array().of(ke.mixed().test("Dynamic object validation","Dynamic object validation error",(d,u)=>Ye(a,u.path).validate(d)))}else{s=s.of(Yo({property:e.of,parentProperty:e,entityId:i}));const a=gc(e.of);a&&(typeof a=="boolean"?s=s.uniqueInArray(d=>d,`${e.name} should have unique values within the array`):Array.isArray(a)&&a.forEach(([d,u])=>{s=s.uniqueInArray(f=>f&&f[d],`${e.name} → ${u.name??d}: should have unique values within the array`)}))}const l=e.validation;return l?(s=l.required?s.required(l?.requiredMessage?l.requiredMessage:"Required").nullable(!0):s.notRequired().nullable(!0),(l.min||l.min===0)&&(s=s.min(l.min,`${e.name} should be min ${l.min} entries long`)),l.max&&(s=s.max(l.max,`${e.name} should be max ${l.max} entries long`))):s=s.notRequired().nullable(!0),s}const bc=({containerRef:e})=>{const{isSubmitting:n,isValidating:r,errors:t}=me.useFormikContext();return A.useEffect(()=>{const i=Object.keys(t);if(i.length>0&&n&&!r){const s=e?.current?.querySelector(`#form_field_${i[0]}`);if(s&&e?.current){const l=Wi(e.current);if(l){const d=s.getBoundingClientRect().top;l.scrollTo({top:l.scrollTop+d-64,behavior:"smooth"})}const a=s.querySelector("input");a&&a.focus()}}},[n,r,t,e]),null},vc=e=>{const n=e&&e.scrollHeight>e.clientHeight,r=e?window.getComputedStyle(e).overflowY:null,t=r&&r.indexOf("hidden")!==-1;return n&&!t},Wi=e=>!e||e===document.body?document.body:vc(e)?e:Wi(e.parentNode),ve=({collection:e,path:n,entityId:r,values:t,previousValues:i,userConfigPersistence:s,fields:l})=>{const a=s?.getCollectionConfig(n),d=Ye(a,"properties"),u=Wo(e.properties),f=t??u,h=i??t??u,b=Object.entries(e.properties).map(([v,w])=>{const E=f?me.getIn(f,v):void 0;return{[v]:Te({propertyKey:v,propertyOrBuilder:w,values:f,previousValues:h,path:n,propertyValue:E,entityId:r,fields:l})}}).filter(v=>v!==null).reduce((v,w)=>({...v,...w}),{}),p=$e(b,d),g=Object.entries(p).filter(([v,w])=>!!w?.dataType).map(([v,w])=>({[v]:w})).reduce((v,w)=>({...v,...w}),{});return{...e,properties:g,originalCollection:e}};function Te({propertyOrBuilder:e,propertyValue:n,fromBuilder:r=!1,...t}){if(typeof e=="object"&&"resolved"in e)return e;let i=null;if(e)if(Me(e)){const s=t.path;if(!s)throw Error("Trying to resolve a property builder without specifying the entity path");const l=e({...t,path:s,propertyValue:n,values:t.values??{},previousValues:t.previousValues??t.values??{}});if(!l)return console.debug("Property builder not returning `Property` so it is not rendered",s,t.entityId,e),null;i=Te({...t,propertyValue:n,propertyOrBuilder:l,fromBuilder:!0})}else{const s=e;if(s.dataType==="map"&&s.properties){const l=Dr({...t,properties:s.properties,propertyValue:n});i={...s,resolved:!0,fromBuilder:r,properties:l}}else s.dataType==="array"?i=Je({property:s,propertyValue:n,fromBuilder:r,...t}):(s.dataType==="string"||s.dataType==="number")&&s.enumValues&&(i=Pr(s,r))}else return null;if(i||(i={...e,resolved:!0,fromBuilder:r}),i.fieldConfig){const s=t.fields;if(!s)throw Error(`Trying to resolve a property with key ${i.fieldConfig} that inherits from a custom field but no custom fields were provided. Use the property 'fields' in your top level component to provide them`);const l=s[i.fieldConfig];if(!l)throw Error(`Trying to resolve a property that inherits from a custom field but no custom field with id ${i.fieldConfig} was found. Check the \`fields\` in your top level component`);if(l.defaultProperty){const a=Te({propertyOrBuilder:l.defaultProperty,propertyValue:n,...t});a&&(i=$e(a,i))}l.Field&&(i.Field=l.Field)}return i?{...i,resolved:!0}:null}function Je({propertyKey:e,property:n,propertyValue:r,...t}){if(n.of){if(Array.isArray(n.of))return{...n,resolved:!0,fromBuilder:t.fromBuilder,resolvedProperties:n.of.map((i,s)=>Te({propertyKey:`${e}.${s}`,propertyOrBuilder:i,propertyValue:Array.isArray(r)?r[s]:void 0,...t,index:s}))};{const i=n.of,s=Array.isArray(r)?r.map((a,d)=>Te({propertyKey:`${e}.${d}`,propertyOrBuilder:i,propertyValue:a,...t,index:d})).filter(a=>!!a):[],l=Te({propertyKey:`${e}`,propertyOrBuilder:i,propertyValue:void 0,...t});if(!l)throw Error("When using a property builder as the 'of' prop of an ArrayProperty, you must return a valid child property");return{...n,resolved:!0,fromBuilder:t.fromBuilder,of:l,resolvedProperties:s}}}else if(n.oneOf){const i=n.oneOf?.typeField??Lo,s=Array.isArray(r)?r.map((a,d)=>{const u=a&&a[i],f=n.oneOf?.properties[u];return!u||!f?null:Te({propertyKey:`${e}.${d}`,propertyOrBuilder:f,propertyValue:r,...t})}).filter(a=>!!a):[],l=Dr({properties:n.oneOf.properties,propertyValue:void 0,...t});return{...n,resolved:!0,oneOf:{...n.oneOf,properties:l},fromBuilder:t.fromBuilder,resolvedProperties:s}}else{if(n.Field)return{...n,resolved:!0,fromBuilder:t.fromBuilder};throw Error("The array property needs to declare an 'of' or a 'oneOf' property, or provide a custom `Field`")}}function Dr({properties:e,propertyValue:n,...r}){return Object.entries(e).map(([t,i])=>({[t]:Te({propertyKey:t,propertyOrBuilder:i,propertyValue:n&&typeof n=="object"?Ye(n,t):void 0,...r})})).filter(t=>t!==null).reduce((t,i)=>({...t,...i}),{})}function Pr(e,n){return typeof e.enumValues=="object"?{...e,resolved:!0,enumValues:No(e.enumValues)?.filter(r=>r&&r.id&&r.label)??[],fromBuilder:n??!1}:e}function No(e){return typeof e=="object"?Object.entries(e).map(([n,r])=>typeof r=="string"?{id:n,label:r}:r):Array.isArray(e)?e:void 0}const zi="CustomIdField",Mr={input:`${zi}-input`,select:`${zi}-select`},yc=be.styled(c.FormControl)(({theme:e})=>({marginBottom:"16px",[`& .${Mr.input}`]:{minHeight:"64px"},[`& .${Mr.select}`]:{paddingTop:e.spacing(1/2)}}));function wc({customId:e,entityId:n,status:r,onChange:t,error:i,entity:s}){const l=r==="existing"||!e,a=r!=="existing"&&!e,d=A.useMemo(()=>{if(!(!e||typeof e=="boolean"||e==="optional"))return No(e)},[e]),u=_e(),{copy:f}=jt({onSuccess:g=>u.open({type:"success",message:`Copied ${g}`})}),h=oe(),b={sx:g=>({minHeight:"64px",borderRadius:`${g.shape.borderRadius}px`}),disableUnderline:!0,endAdornment:s?o.jsxs(c.InputAdornment,{position:"end",children:[o.jsx(c.IconButton,{onClick:g=>f(s.id),"aria-label":"copy-id",size:"large",children:o.jsx(c.Tooltip,{title:"Copy",children:o.jsx("svg",{className:"MuiSvgIcon-root MuiSvgIcon-fontSizeSmall",fill:"currentColor",width:"20",height:"20",viewBox:"0 0 24 24",children:o.jsx("path",{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"})})})}),h?.entityLinkBuilder&&o.jsx("a",{href:h.entityLinkBuilder({entity:s}),rel:"noopener noreferrer",target:"_blank",children:o.jsx(c.IconButton,{onClick:g=>g.stopPropagation(),"aria-label":"go-to-datasource",size:"large",children:o.jsx(c.Tooltip,{title:"Open in the console",children:o.jsx(To,{fontSize:"small"})})})})]}):void 0},p={label:a?"ID is set automatically":"ID",disabled:l,name:"id",type:null,value:(s&&r==="existing"?s.id:n)??"",variant:"filled",sx:g=>({minHeight:"64px",borderRadius:`${g.shape.borderRadius}px`})};return Dl.createElement(yc,{fullWidth:!0,error:i,...p,key:"custom-id-field"},d&&o.jsxs(o.Fragment,{children:[o.jsx(c.InputLabel,{id:"id-label",children:p.label}),o.jsx(c.Select,{labelId:"id-label",fullWidth:!0,className:Mr.select,disableUnderline:!0,error:i,...p,onChange:g=>t(g.target.value),children:d.map(g=>o.jsx(c.MenuItem,{value:g.id,children:`${g.id} - ${g.label}`},`custom-id-item-${g.id}`))})]}),!d&&o.jsx(c.TextField,{...p,error:i,InputProps:b,helperText:e==="optional"?"Autogenerated ID, it can be manually changed":r==="new"||r==="copy"?"ID of the new document":"ID of the document",onChange:g=>{let v=g.target.value;return v&&(v=v.trim()),t(v.length?v:void 0)}}),o.jsx(me.ErrorMessage,{name:"id",component:"div",children:g=>"You need to specify an ID"}))}const Yi=A.memo(xc,(e,n)=>e.status===n.status&&e.path===n.path&&Ae(e.entity?.values,n.entity?.values));function xc({status:e,path:n,collection:r,entity:t,onEntitySaveRequested:i,onDiscard:s,onModified:l,onValuesChanged:a,onIdChange:d,onFormContextChange:u,hideId:f,autoSave:h,onIdUpdateError:b}){const p=oe(),g=Fe(),v=p.plugins,w=A.useMemo(()=>ve({collection:r,path:n,values:t?.values,fields:p.fields}),[t?.values,n]),E=(e==="new"||e==="copy")&&!!w.customId&&w.customId!=="optional",x=A.useMemo(()=>e==="new"||e==="copy"?E?void 0:g.generateEntityId(n):t?.id,[]),m=A.useRef(!1),C=A.useMemo(()=>{const W=w.properties;if((e==="existing"||e==="copy")&&t)return t.values??Wo(W);if(e==="new")return Wo(W);throw console.error({status:e,entity:t}),new Error("Form has not been initialised with the correct parameters")},[e,w,t]),[B,S]=A.useState(x),[k,I]=A.useState(!1),[F,T]=A.useState(),D=A.useRef(t?.values??C),P=D.current,[Q,K]=A.useState(P),L=W=>{K(W),a&&a(W),h&&W&&!Ae(W,P)&&O(W)};A.useEffect(()=>{B&&d&&d(B)},[B,d]);const z=ve({collection:r,path:n,entityId:B,values:Q,previousValues:P,fields:p.fields}),H=z.callbacks?.onIdUpdate;A.useEffect(()=>{if(H&&Q&&(e==="new"||e==="copy"))try{const W=H({collection:z,path:n,entityId:B,values:Q,context:p});S(W)}catch(W){b&&b(W),console.error(W)}},[B,Q,e]);const J=A.useMemo(()=>P&&e==="existing"?Object.entries(z.properties).map(([W,j])=>{if(Vo(j))return{};const _=P[W],M=C[W];return Ae(_,M)?{}:{[W]:M}}).reduce((W,j)=>({...W,...j}),{}):{},[C,z.properties,P,e]),O=W=>i({collection:z,path:n,entityId:B,values:W,previousValues:t?.values,closeAfterSave:m.current,autoSave:h??!1}).then(j=>{const _=e==="new"?"new_entity_saved":e==="copy"?"entity_copied":e==="existing"?"entity_edited":"unmapped_event";p.onAnalyticsEvent?.(_,{path:n}),D.current=W}).catch(j=>{console.error(j),T(j)}).finally(()=>{m.current=!1}),G=(W,j)=>{if(E&&!B){console.error("Missing custom Id"),I(!0),j.setSubmitting(!1);return}if(T(void 0),I(!1),e==="existing"){if(!t?.id)throw Error("Form misconfiguration when saving, no id for existing entity")}else if(e==="new"||e==="copy"){if(z.customId&&z.customId!=="optional"&&!B)throw Error("Form misconfiguration when saving, entityId should be set")}else throw Error("New FormType added, check EntityForm");O(W)?.then(_=>{j.resetForm({values:W,submitCount:0,touched:{}})}).finally(()=>{j.setSubmitting(!1)})},U=A.useCallback(({name:W,value:j,property:_})=>g.checkUniqueField(n,W,j,_,B),[g,n,B]),V=A.useMemo(()=>B?Vi(B,z.properties,U):void 0,[B,z.properties,U]);return o.jsx(me.Formik,{initialValues:C,onSubmit:G,validationSchema:V,validate:W=>console.debug("Validating",W),onReset:()=>s&&s(),children:W=>{const j=[],_={setFieldValue:W.setFieldValue,values:W.values,collection:ve({collection:z,path:n,fields:p.fields}),entityId:B,path:n,save:O};if(A.useEffect(()=>{u&&u(_)},[u,_]),v&&z){const M={entityId:B,path:n,status:e,collection:r,context:p,currentEntityId:B,formContext:_};j.push(...v.map((N,q)=>N.form?.Actions?o.jsx(N.form.Actions,{...M},`actions_${N.name}`):null).filter(Boolean))}return o.jsx(o.Fragment,{children:o.jsxs(c.Box,{sx:M=>({paddingLeft:M.spacing(4),paddingRight:M.spacing(4),paddingTop:M.spacing(3),paddingBottom:M.spacing(4),marginBottom:M.spacing(2),[M.breakpoints.down("lg")]:{paddingLeft:M.spacing(2),paddingRight:M.spacing(2),paddingTop:M.spacing(2),paddingBottom:M.spacing(3)},[M.breakpoints.down("md")]:{padding:M.spacing(2)}}),children:[j.length>0&&o.jsx(c.Box,{sx:M=>({width:"100%",display:"flex",justifyContent:"flex-end",background:M.palette.mode==="light"?"rgba(255,255,255,0.6)":c.alpha(M.palette.background.paper,.1),backdropFilter:"blur(8px)",borderBottom:`1px solid ${M.palette.divider}`,flexDirection:"row",alignItems:"center",position:"absolute",top:0,right:0,left:0,textAlign:"right",zIndex:2,"& > *:not(:last-child)":{[M.breakpoints.down("md")]:{mr:M.spacing(1)},mr:M.spacing(2)}}),children:j}),o.jsx(c.Box,{sx:M=>({width:"100%",marginTop:M.spacing(4+(j?4:0)),paddingY:2,display:"flex",alignItems:"center",[M.breakpoints.down("lg")]:{marginTop:M.spacing(3+(j?4:0))},[M.breakpoints.down("md")]:{marginTop:M.spacing(2+(j?4:0))}}),children:o.jsx(c.Typography,{sx:{marginTop:4,marginBottom:z.hideIdFromForm?0:4,flexGrow:1},variant:"h4",children:z.singularName??z.name+" entry"})}),!f&&o.jsx(wc,{customId:z.customId,entityId:B,status:e,onChange:S,error:k,entity:t}),B&&o.jsx(Cc,{...W,initialValues:P,onModified:l,onValuesChanged:L,underlyingChanges:J,entity:t,collection:z,formContext:_,status:e,savingError:F,closeAfterSaveRef:m,autoSave:h})]})})}})}function Cc(e){const{values:n,onModified:r,onValuesChanged:t,underlyingChanges:i,formContext:s,entity:l,touched:a,setFieldValue:d,collection:u,isSubmitting:f,status:h,handleSubmit:b,savingError:p,dirty:g,closeAfterSaveRef:v,autoSave:w}=e,E=g;A.useEffect(()=>{r&&r(E),t&&t(n)},[E,n]),A.useEffect(()=>{!w&&i&&l&&Object.entries(i).forEach(([B,S])=>{const k=n[B];!Ae(S,k)&&!a[B]&&(console.debug("Updated value from the datasource:",B,S),d(B,S!==void 0?S:null))})},[w,i,l,n,a,d]);const x=o.jsx(c.Grid,{container:!0,spacing:6,children:Object.entries(u.properties).map(([B,S])=>{const k=!!i&&Object.keys(i).includes(B)&&!!a[B],I=!w&&f||wo(S)||!!S.disabled;if(Vo(S))return null;const T={propertyKey:B,disabled:I,property:S,includeDescription:!0,underlyingValueHasChanged:k&&!w,context:s,tableMode:!1,partOfArray:!1,autoFocus:!1};return o.jsx(c.Grid,{item:!0,xs:12,id:`form_field_${B}`,children:o.jsx(so,{...T})},`field_${u.name}_${B}`)}).filter(Boolean)}),m=f||!E&&h==="existing",C=A.createRef();return o.jsxs(me.Form,{onSubmit:b,noValidate:!0,children:[o.jsxs(c.Box,{sx:{mt:4},ref:C,children:[x,o.jsx(bc,{containerRef:C})]}),o.jsx(c.Box,{sx:{height:56}}),!w&&o.jsxs(Ze,{position:"absolute",children:[p&&o.jsx(c.Box,{textAlign:"right",children:o.jsx(c.Typography,{color:"error",children:p.message})}),o.jsx(Po,{variant:"text",color:"primary",disabled:m,type:"reset",children:h==="existing"?"Discard":"Clear"}),o.jsxs(Po,{variant:"text",color:"primary",type:"submit",disabled:m,onClick:()=>{v.current=!1},children:[h==="existing"&&"Save",h==="copy"&&"Create copy",h==="new"&&"Create"]}),o.jsxs(Po,{variant:"contained",color:"primary",type:"submit",disabled:m,onClick:()=>{v.current=!0},children:[h==="existing"&&"Save and close",h==="copy"&&"Create copy and close",h==="new"&&"Create and close"]})]})]})}const Ni={text_field:{name:"Text field",description:"Simple short text",dataType:"string",Icon:ol,color:"#2d7ff9",Field:Bo},multiline:{name:"Multiline",description:"Text with multiple lines",dataType:"string",Icon:nl,color:"#2d7ff9",Field:Bo},markdown:{name:"Markdown",description:"Text with advanced markdown syntax",dataType:"string",Icon:fl,color:"#2d7ff9",Field:$i},url:{name:"Url",description:"Text with URL validation",dataType:"string",Icon:dl,color:"#154fb3",Field:Bo},email:{name:"Email",description:"Text with email validation",dataType:"string",Icon:yt,color:"#154fb3",Field:Bo},select:{name:"Select/enum",description:"Select one text value from within an enumeration",dataType:"string",Icon:tl,color:"#4223c9",Field:Cr},multi_select:{name:"Multi select",description:"Select multiple text values from within an enumeration",dataType:"array",Icon:cl,color:"#4223c9",Field:Br},number_input:{name:"Number input",description:"Simple number field with validation",dataType:"number",Icon:ul,color:"#bec920",Field:Bo},number_select:{name:"Number select",description:"Select a number value from within an enumeration",dataType:"number",Icon:vt,color:"#bec920",Field:Cr},multi_number_select:{name:"Multiple number select",description:"Select multiple number values from within an enumeration",dataType:"array",Icon:vt,color:"#bec920",Field:Br},file_upload:{name:"File upload",description:"Input for uploading single files",dataType:"string",Icon:sl,color:"#f92d9a",Field:kr},multi_file_upload:{name:"Multiple file upload",description:"Input for uploading multiple files",dataType:"array",Icon:ll,color:"#f92d9a",Field:kr},reference:{name:"Reference",description:"The value refers to a different collection",dataType:"reference",Icon:bt,color:"#ff0042",Field:Mi},multi_references:{name:"Multiple references",description:"Multiple values that refer to a different collection",dataType:"array",Icon:rl,color:"#ff0042",Field:xi},switch:{name:"Switch",description:"True or false field (or yes or no, 0 or 1...)",dataType:"boolean",Icon:Al,color:"#20d9d2",Field:Di},date_time:{name:"Date/time",description:"A date time select field",dataType:"date",Icon:il,color:"#8b46ff",Field:Pi},group:{name:"Group",description:"Group of multiple fields",dataType:"map",Icon:wt,color:"#ff9408",Field:Qi},key_value:{name:"Key-value",description:"Flexible field that allows the user to add multiple key-value pairs",dataType:"map",Icon:wt,color:"#ff9408",Field:Oi},repeat:{name:"Repeat/list",description:"A field that gets repeated multiple times (e.g. multiple text fields)",dataType:"array",Icon:pt,color:"#ff9408",Field:Gi},custom_array:{name:"Custom array",description:"A field that saved its value as an array of custom objects",dataType:"array",Icon:pt,color:"#ff9408",Field:Ua},block:{name:"Block",description:"A complex field that allows the user to compose different fields together, with a key->value format",dataType:"array",Icon:al,color:"#ff9408",Field:Li}};function mn(e){const n=Qr(e);return n?Ni[n]:void 0}function Qr(e){if(e.dataType==="string")return e.multiline?"multiline":e.markdown?"markdown":e.storage?"file_upload":e.url?"url":e.email?"email":e.enumValues?"select":"text_field";if(e.dataType==="number")return e.enumValues?"number_select":"number_input";if(e.dataType==="map"){if(e.keyValue)return"key_value";if(e.properties)return"group"}else if(e.dataType==="array"){const n=e.of,r=e.oneOf;return Array.isArray(n)?"custom_array":Me(n)?"repeat":n?.dataType==="string"&&n.enumValues?"multi_select":n?.dataType==="number"&&n.enumValues?"multi_number_select":n?.dataType==="string"&&n.storage?"multi_file_upload":n?.dataType==="reference"?"multi_references":r?"block":"repeat"}else{if(e.dataType==="boolean")return"switch";if(e.dataType==="date")return"date_time";if(e.dataType==="reference")return"reference"}console.error("Unsupported field config mapping",e)}function Ui(e,n){const r=Te({propertyKey:"ignore",propertyOrBuilder:e,fields:n});return r?r.dataType==="reference"?!0:r.dataType==="array"?Array.isArray(r.of)?!1:r.of?.dataType==="reference":!1:null}function Hi(e="inherit",n="inherit"){return o.jsx(Ks,{color:e,fontSize:n})}function _i(e,n,r){const t=e?.Icon??el;return o.jsx(t,{color:n,fontSize:r})}function ye(e,n="inherit",r="inherit"){if(Me(e))return o.jsx(Rs,{color:n,fontSize:r});{const t=mn(e);return _i(t,n,r)}}function Bc(e,n="inherit"){return o.jsx(c.Box,{sx:{background:e?.color??"#888",height:"32px",width:"32px",padding:.5,borderRadius:"50%",boxShadow:"0px 2px 1px -1px rgb(0 0 0 / 20%), 0px 1px 1px 0px rgb(0 0 0 / 14%), 0px 1px 3px 0px rgb(0 0 0 / 12%)",color:"white"},children:_i(e,n,"medium")})}function Ec(e){return Me(e)?"#888":mn(e)?.color??"#666"}function Or(e,n){if(typeof e=="object"){if(n in e)return e[n];if(n.includes(".")){const r=n.split("."),t=e[r[0]];if(typeof t=="object"&&t.dataType==="map"&&t.properties)return Or(t.properties,r.slice(1).join("."))}}}function Gr(e,n){if(typeof e=="object"){if(n in e)return e[n];if(n.includes(".")){const r=n.split("."),t=e[r[0]];if(t.dataType==="map"&&t.properties)return Gr(t.properties,r.slice(1).join("."))}}}function mc(e){return e.replace(/\.([^.]*)/g,"[$1]")}const kn={read:!0,edit:!0,create:!0,delete:!0};function Uo(e,n,r,t){const i=e.permissions;if(i===void 0)return kn;if(typeof i=="object")return i;if(typeof i=="function")return i({entity:t,user:n.user,authController:n,collection:e,pathSegments:r});throw console.error("Permissions:",i),Error("New type of permission added and not mapped")}function Lr(e,n,r,t){return Uo(e,n,r,t).edit??kn.edit}function Sn(e,n,r,t){return Uo(e,n,r,t).create??kn.create}function $r(e,n,r,t){return Uo(e,n,r,t).delete??kn.delete}function ji(e){if(e)return e in qn?qn[e]:void 0}function Fn(e){const n=ji(e.icon);if(e?.icon&&n)return n;const r=Vr.length,t=Vr[ei(e.path)%r];return qn[t]}const Vr=["AcUnit","Adjust","AlignHorizontalCenter","Album","AllInclusive","AllOut","Animation","Assistant","Attractions","Audiotrack","AutoAwesome","AutoAwesomeMosaic","BeachAccess","Bolt","Brightness1","BreakfastDining","BrokenImage","Brightness5","Cable","CalendarViewMonth","CatchingPokemon","Casino","Category","Cloud","ColorLens","CreditCard","Coronavirus","Earbuds","EggAlt","FiberSmartRecord","Flag","Healing","HeatPump","Hive","Hub","LocalFireDepartment","LocalPizza","Memory","Outlet","Pages","PanoramaPhotosphere","SignalCellular0Bar","SportsBaseball","Storm","Stairs"];function kc(e,n){if(n!==void 0&&n===1)return e;const r={"(quiz)$":"$1zes","^(ox)$":"$1en","([m|l])ouse$":"$1ice","(matr|vert|ind)ix|ex$":"$1ices","(x|ch|ss|sh)$":"$1es","([^aeiouy]|qu)y$":"$1ies","(hive)$":"$1s","(?:([^f])fe|([lr])f)$":"$1$2ves","(shea|lea|loa|thie)f$":"$1ves",sis$:"ses","([ti])um$":"$1a","(tomat|potat|ech|her|vet)o$":"$1oes","(bu)s$":"$1ses","(alias)$":"$1es","(octop)us$":"$1i","(ax|test)is$":"$1es","(us)$":"$1es","([^s]+)$":"$1s"},t={move:"moves",foot:"feet",goose:"geese",sex:"sexes",child:"children",man:"men",tooth:"teeth",person:"people"};if(["sheep","fish","deer","moose","series","species","money","rice","information","equipment","bison","cod","offspring","pike","salmon","shrimp","swine","trout","aircraft","hovercraft","spacecraft","sugar","tuna","you","wood"].indexOf(e.toLowerCase())>=0)return e;for(const s in t){const l=new RegExp(`${s}$`,"i"),a=t[s];if(l.test(e))return e.replace(l,a)}for(const s in r){const l=new RegExp(s,"i");if(l.test(e))return e.replace(l,r[s])}return e}function Sc(e,n){if(n!==void 0&&n!==1)return e;const r={"(quiz)zes$":"$1","(matr)ices$":"$1ix","(vert|ind)ices$":"$1ex","^(ox)en$":"$1","(alias)es$":"$1","(octop|vir)i$":"$1us","(cris|ax|test)es$":"$1is","(shoe)s$":"$1","(o)es$":"$1","(bus)es$":"$1","([m|l])ice$":"$1ouse","(x|ch|ss|sh)es$":"$1","(m)ovies$":"$1ovie","(s)eries$":"$1eries","([^aeiouy]|qu)ies$":"$1y","([lr])ves$":"$1f","(tive)s$":"$1","(hive)s$":"$1","(li|wi|kni)ves$":"$1fe","(shea|loa|lea|thie)ves$":"$1f","(^analy)ses$":"$1sis","((a)naly|(b)a|(d)iagno|(p)arenthe|(p)rogno|(s)ynop|(t)he)ses$":"$1$2sis","([ti])a$":"$1um","(n)ews$":"$1ews","(h|bl)ouses$":"$1ouse","(corpse)s$":"$1","(us)es$":"$1",s$:""},t={move:"moves",foot:"feet",goose:"geese",sex:"sexes",child:"children",man:"men",tooth:"teeth",person:"people"};if(["sheep","fish","deer","moose","series","species","money","rice","information","equipment","bison","cod","offspring","pike","salmon","shrimp","swine","trout","aircraft","hovercraft","spacecraft","sugar","tuna","you","wood"].indexOf(e.toLowerCase())>=0)return e;for(const s in t){const l=new RegExp(`${t[s]}$`,"i");if(l.test(e))return e.replace(l,s)}for(const s in r){const l=new RegExp(s,"i");if(l.test(e))return e.replace(l,r[s])}return e}function Wr(e,n,r,t=3){const i=Object.keys(e.properties);let s=r?.filter(l=>i.includes(l));return s&&s.length>0?s:(s=i,s.filter(l=>{const a=e.properties[l];return a&&!Me(a)&&!Ui(a,n)}).slice(0,t))}const In="EntityPreview",Ve={property:`${In}-property`,valuePreview:`${In}-valuePreview`,iconCell:`${In}-iconCell`,titleCell:`${In}-titleCell`},Fc=be.styled(c.TableContainer)(({theme:e})=>({[`& .${Ve.property}`]:{display:"flex"},[`& .${Ve.valuePreview}`]:{height:"72px",padding:e.spacing(2,3)},[`& .${Ve.iconCell}`]:{paddingTop:e.spacing(1)},[`& .${Ve.titleCell}`]:{width:"25%",padding:e.spacing(1)}}));function zr({entity:e,collection:n,path:r}){const t=oe(),i=Ee.useMemo(()=>ve({collection:n,path:r,entityId:e.id,values:e.values,fields:t.fields}),[n,r,e]),s=oe(),l=i.properties;return o.jsxs(o.Fragment,{children:[o.jsx(c.Box,{sx:a=>({width:"100%",marginTop:a.spacing(3),paddingLeft:a.spacing(4),paddingRight:a.spacing(4),paddingTop:a.spacing(3),[a.breakpoints.down("lg")]:{marginTop:a.spacing(2),paddingLeft:a.spacing(2),paddingRight:a.spacing(2),paddingTop:a.spacing(2)},[a.breakpoints.down("md")]:{marginTop:a.spacing(1),paddingLeft:a.spacing(2),paddingRight:a.spacing(2),paddingTop:a.spacing(2)}}),children:o.jsx(c.Typography,{sx:{marginTop:4,marginBottom:4},variant:"h4",children:n.singularName??n.name+" entry"})}),o.jsx(Fc,{children:o.jsx(c.Table,{"aria-label":"entity table",children:o.jsxs(c.TableBody,{children:[o.jsxs(c.TableRow,{children:[o.jsx(c.TableCell,{align:"right",component:"td",scope:"row",className:Ve.titleCell,children:o.jsx(c.Typography,{variant:"caption",color:"textSecondary",children:"Id"})}),o.jsx(c.TableCell,{padding:"none",className:Ve.iconCell,children:Hi("disabled","small")}),o.jsx(c.TableCell,{className:Ve.valuePreview,children:o.jsxs(c.Box,{display:"flex",alignItems:"center",children:[e.id,s?.entityLinkBuilder&&o.jsx("a",{href:s.entityLinkBuilder({entity:e}),rel:"noopener noreferrer",target:"_blank",children:o.jsx(c.IconButton,{"aria-label":"go-to-entity-datasource",size:"large",children:o.jsx(To,{fontSize:"small"})})})]})})]}),n&&Object.entries(l).map(([a,d])=>{const u=e.values[a];return o.jsxs(c.TableRow,{children:[o.jsx(c.TableCell,{align:"right",component:"td",scope:"row",className:Ve.titleCell,children:o.jsx(c.Typography,{sx:{paddingLeft:2},variant:"caption",color:"textSecondary",children:d.name})}),o.jsx(c.TableCell,{padding:"none",className:Ve.iconCell,children:ye(d,"disabled","small")}),o.jsx(c.TableCell,{className:Ve.valuePreview,children:o.jsx(re,{children:o.jsx(we,{propertyKey:a,value:u,entity:e,property:d,size:"regular"})})})]},"entity_prev"+d.name+a)})]})})})]})}function Ic(e){return e.dataType==="boolean"?"center":e.dataType==="number"?e.enumValues?"left":"right":e.dataType==="date"?"right":"left"}function qi(e){if(e.columnWidth)return e.columnWidth;if(e.dataType==="string")return e.url?280:e.storage?160:e.enumValues?200:e.multiline||e.markdown?300:(e.email,200);if(e.dataType==="array"){const n=e;return n.of?Array.isArray(e.of)?300:qi(n.of):300}else return e.dataType==="number"?e.enumValues?200:140:e.dataType==="map"?360:e.dataType==="date"?200:e.dataType==="reference"?220:e.dataType==="boolean"?140:200}function Ji(e){return`subcollection:${e.alias??e.path}`}function Tc(e){const n=A.createRef(),{disabled:r,value:t,multiline:i,updateValue:s,focused:l}=e,a=A.useRef(t),[d,u]=A.useState(t),f=A.useRef(!1);A.useEffect(()=>{a.current!==t&&t!==d&&u(t),a.current=t},[t]);const h=A.useCallback(()=>{!t&&!d||d!==t&&(a.current=d,s(d))},[d,t]);return wn(d,h,!l,2e3),A.useEffect(()=>{n.current&&l&&!f.current?(f.current=!0,n.current.focus({preventScroll:!0}),n.current.selectionStart=n.current.value.length,n.current.selectionEnd=n.current.value.length):f.current=l},[l,n]),o.jsx(Sr,{ref:n,style:{padding:0,margin:0,width:"100%",color:"unset",fontWeight:"unset",lineHeight:"unset",fontSize:"unset",fontFamily:"unset",background:"unset",border:"unset",resize:"none",outline:"none"},value:d??"",onChange:b=>{const p=b.target.value;(i||!p.endsWith(`
`))&&u(p)},onFocus:()=>{f.current=!0,e.setFocused(!0)},onBlur:()=>{f.current=!1,h(),e.setFocused(!1)}})}function Yr(e){const{name:n,enumValues:r,error:t,internalValue:i,disabled:s,small:l,focused:a,updateValue:d,multiple:u,valueType:f}=e,[h,b]=A.useState(!1),p=A.useCallback(()=>{b(!0)},[]),g=A.useCallback(()=>{b(!1)},[]),v=Array.isArray(i)&&u||!Array.isArray(i)&&!u,w=A.createRef();A.useEffect(()=>{w.current&&a&&w.current?.focus({preventScroll:!0})},[a,w]);const E=A.useCallback(m=>{if(f==="number")if(u){const C=m.target.value.map(B=>parseFloat(B));d(C)}else d(parseFloat(m.target.value));else if(f==="string")m.target.value?d(m.target.value):d(null);else throw Error("Missing mapping in TableSelect")},[u,d,f]),x=m=>u&&Array.isArray(m)?o.jsx(gn,{value:m,name:n,enumValues:r,size:l?"small":"regular"}):o.jsx(Ie,{enumKey:m,enumValues:r,small:l});return o.jsx(c.Select,{variant:"standard",inputRef:w,sx:{height:"100%"},open:h,disabled:s,multiple:u,onClose:g,onOpen:p,fullWidth:!0,inputProps:{sx:{height:"100% !important",display:"flex",alignItems:"center",padding:"0px 0 0px",background:"transparent !important"}},disableUnderline:!0,error:!!t,value:v?u?i.map(m=>m.toString()):i:u?[]:"",onChange:E,renderValue:x,children:un(r).map(m=>{const C=m.id,B=o.jsx(Ie,{enumKey:C,enumValues:r,small:!0});return u?o.jsxs(c.MenuItem,{value:C,disabled:fn(m),dense:!0,children:[o.jsx(c.Checkbox,{checked:Array.isArray(i)&&i.map(S=>S.toString()).includes(C.toString())}),o.jsx(c.ListItemText,{primary:B})]},`select-${n}-${C}`):o.jsx(c.MenuItem,{value:C,disabled:fn(m),dense:!0,children:B},`select-${n}-${C}`)})},`table_select_${n}`)}function Dc(e){const{align:n,value:r,updateValue:t,focused:i,disabled:s}=e,l=r&&typeof r=="number"?r.toString():"",[a,d]=A.useState(l),u=A.useRef(r);A.useEffect(()=>{u.current!==r&&String(r)!==a&&d(r?r.toString():null),u.current=r},[r]);const f=A.useCallback(()=>{if(a!==l)if(a!=null){const p=parseFloat(a);if(isNaN(p))return;p!=null&&t(p)}else t(null)},[a,r]);wn(a,f,!i,2e3),A.useEffect(()=>{!i&&l!==a&&d(r!=null?r.toString():null)},[r,i]);const h=A.createRef();A.useEffect(()=>{h.current&&i&&h.current.focus({preventScroll:!0})},[i,h]);const b=/^-?[0-9]+[,.]?[0-9]*$/;return o.jsx(c.Input,{inputRef:h,sx:{width:"100%",fontSize:"unset",fontFamily:"unset",background:"unset",border:"unset",resize:"none",outline:"none",padding:0,margin:0,color:"unset",fontWeight:"unset",lineHeight:"unset",textAlign:"right"},inputProps:{style:{textAlign:n}},disabled:s,disableUnderline:!0,value:a??"",onFocus:()=>{e.setFocused(!0)},onBlur:()=>{f(),e.setFocused(!1)},onChange:p=>{const g=p.target.value.replace(",",".");g.length===0&&d(null),(b.test(g)||g.startsWith("-"))&&d(g)}})}function Pc(e){const{disabled:n,internalValue:r,updateValue:t,focused:i}=e,s=A.createRef();return A.useEffect(()=>{s.current&&i&&s.current.focus({preventScroll:!0})},[i,s]),o.jsx(c.Switch,{inputRef:s,color:"secondary",checked:!!r,disabled:n,onChange:l=>{const a=l.target.checked;t(a)}})}function Mc(e){const{disabled:n,error:r,mode:t,internalValue:i,updateValue:s}=e,l=t===void 0||t==="date_time"?_n.DateTimePicker:Hn.DatePicker;return o.jsx(l,{value:i??null,disabled:n,onChange:a=>{s(a)},renderInput:a=>o.jsx(c.TextField,{...a,fullWidth:!0,variant:"standard",error:!!r,style:{height:"100%"},InputProps:{...a.InputProps,style:{fontSize:14},disableUnderline:!0,endAdornment:o.jsx(c.Box,{sx:{pr:1},children:a.InputProps?.endAdornment})}}),InputAdornmentProps:{style:{fontSize:"small",height:26}}})}function Zi(e){const{name:n,internalValue:r,updateValue:t,multiselect:i,path:s,size:l,previewProperties:a,title:d,disabled:u,forceFilter:f}=e,[h,b]=A.useState(!1),p=A.useCallback(()=>b(!0),[]),g=A.useCallback(()=>b(!1),[]),w=pe().getCollection(s);if(!w)throw Error(`Couldn't find the corresponding collection view for the path: ${s}`);const E=A.useCallback(F=>{t(F?io(F):null)},[t]),x=A.useCallback(F=>{t(F.map(T=>io(T)))},[t]),m=r?Array.isArray(r)?r.map(F=>F.id):r.id?[r.id]:[]:[],C=Qo({multiselect:i,path:s,collection:w,onMultipleEntitiesSelected:x,onSingleEntitySelected:E,selectedEntityIds:m,forceFilter:f}),B=A.useCallback(()=>{u||C.open()},[u,C]),S=!r||Array.isArray(r)&&r.length===0,k=()=>r instanceof Pe?o.jsx(je,{onClick:u?void 0:B,size:oo(l),reference:r,onHover:h,disabled:!s,previewProperties:a}):o.jsx(ue,{error:"Data is not a reference"}),I=()=>Array.isArray(r)?o.jsx(o.Fragment,{children:r.map((F,T)=>o.jsx(c.Box,{sx:{m:.5,width:"100%"},children:o.jsx(je,{onClick:u?void 0:B,size:"tiny",reference:F,onHover:h,disabled:!s,previewProperties:a})},`preview_array_ref_${n}_${T}`))}):o.jsx(ue,{error:"Data is not an array of references"});return w?o.jsxs(c.Box,{sx:{width:"100%"},onMouseEnter:p,onMouseMove:p,onMouseLeave:g,children:[r&&!i&&k(),r&&i&&I(),S&&o.jsxs(c.Button,{onClick:B,size:"small",variant:"outlined",color:"primary",children:["Edit ",d]})]}):o.jsx(ue,{error:"The specified collection does not exist"})}const Qc=e=>({transition:"background-color 200ms cubic-bezier(0.0, 0, 0.2, 1) 0ms",position:"relative",height:"100%",width:"100%",outline:0,display:"flex",flexDirection:"row",flexWrap:"wrap",justifyContent:e?"start":"center",alignItems:"center",border:"2px solid",borderColor:"transparent"}),Oc=e=>({background:(e.palette.mode==="light","repeating-linear-gradient( 45deg, rgba(128, 128, 128, 0.2), rgba(128, 128, 128, 0.2) 10px, rgba(128, 128, 128, 0.25) 10px, rgba(128, 128, 128, 0.25) 20px) !important"),borderRadius:`${e.shape.borderRadius}px`,border:"2px solid",borderColor:"transparent"}),Gc=e=>({background:"repeating-linear-gradient( 45deg, rgba(128, 128, 128, 0.2), rgba(128, 128, 128, 0.2) 10px, rgba(128, 128, 128, 0.25) 10px, rgba(128, 128, 128, 0.25) 20px) !important",borderColor:e.palette.success.light,border:"2px solid"}),Lc=e=>({borderColor:e.palette.error.light,border:"2px solid"});function $c(e){const{propertyKey:n,error:r,value:t,disabled:i,property:s,entity:l,path:a,previewSize:d,updateValue:u}=e,f=po(),{internalValue:h,setInternalValue:b,onFilesAdded:p,storage:g,onFileUploadComplete:v,storagePathBuilder:w,multipleFilesSupported:E}=Bi({entityValues:l.values,entityId:l.id,path:a,property:s,propertyKey:n,storageSource:f,onChange:u,value:t,disabled:i});return o.jsx(Vc,{internalValue:h,setInternalValue:b,name:n,disabled:i,autoFocus:!1,property:s,onChange:u,entity:l,storagePathBuilder:w,storage:g,multipleFilesSupported:E,onFilesAdded:p,onFileUploadComplete:v,previewSize:d})}function Vc({property:e,name:n,internalValue:r,setInternalValue:t,entity:i,onChange:s,multipleFilesSupported:l,previewSize:a,disabled:d,autoFocus:u,storage:f,onFilesAdded:h,onFileUploadComplete:b,storagePathBuilder:p}){const[g,v]=A.useState(!1),w=l&&a==="regular"?"small":a;if(l){const L=e;if(Array.isArray(L.of))throw Error("Using array properties instead of single one in `of` in ArrayProperty");if(L.of){if(L.of.dataType!=="string")throw Error("Storage field using array must be of data type string")}else throw Error("Storage field using array must be of data type string")}const E=f?.metadata,x=!!r,m=_e(),{open:C,getRootProps:B,getInputProps:S,isDragActive:k,isDragAccept:I,isDragReject:F}=Ct.useDropzone({accept:f.acceptedFiles?f.acceptedFiles.map(L=>({[L]:[]})).reduce((L,z)=>({...L,...z}),{}):void 0,disabled:d,maxSize:f.maxSize,noClick:!0,noKeyboard:!0,onDrop:h,onDropRejected:(L,z)=>{for(const H of L)for(const J of H.errors)m.open({type:"error",message:`Error uploading file: File is larger than ${f.maxSize} bytes`})}}),{...T}=B(),D=l?"Drag 'n' drop some files here, or click here to edit":"Drag 'n' drop a file here, or click here edit",P=l?e.of:e,Q=A.useMemo(()=>yo(w),[w]),K=c.useTheme();return o.jsxs(c.Box,{...T,onMouseEnter:()=>v(!0),onMouseMove:()=>v(!0),onMouseLeave:()=>v(!1),sx:{...Qc(x),...k?Oc(K):{},...I?Gc(K):{},...F?Lc(K):{}},children:[o.jsx("input",{autoFocus:u,...S()}),r.map((L,z)=>{let H;return L.storagePathOrDownloadUrl?H=o.jsx(Wc,{property:P,value:L.storagePathOrDownloadUrl,entity:i,size:w},`storage_preview_${z}`):L.file&&(H=o.jsx(Si,{entry:L,metadata:E,storagePath:p(L.file),onFileUploadComplete:b,imageSize:Q,simple:!0},`storage_progress_${z}`)),H}),!r&&o.jsx(c.Box,{sx:{flexGrow:1,m:2,maxWidth:200},onClick:C,children:o.jsx(c.Typography,{sx:{color:L=>L.palette.mode==="light"?"#999":"#444"},variant:"body2",align:"center",children:D})}),g&&o.jsx(c.IconButton,{color:"inherit",size:"small",onClick:C,sx:{position:"absolute",bottom:2,right:2},children:o.jsx(Nl,{sx:{width:16,height:16,fill:"#888"}})})]})}function Wc({property:e,value:n,size:r,entity:t}){return o.jsx(c.Box,{m:1,position:"relative",children:n&&o.jsx(re,{children:o.jsx(we,{propertyKey:"ignore",value:n,property:e,entity:t,size:r})})})}function Eo(e){switch(e){case"xl":return 400;case"l":return 280;case"m":return 140;case"s":return 80;case"xs":return 54;default:throw Error("Missing mapping for collection size -> height")}}function zc(e,n,r,t,i,s){if(e&&!r)return i.palette.mode==="dark"?c.lighten(i.palette.background.paper,.03):c.darken(i.palette.background.default,.02);if(s)return i.palette.mode==="dark"?c.lighten(i.palette.background.paper,.035):c.darken(i.palette.background.default,.025);if(n||t)return i.palette.mode==="dark"?c.lighten(i.palette.background.paper,.022):c.darken(i.palette.background.default,.008)}const Yc=Ro.styled("div",{})(({theme:e,justifyContent:n,padding:r,border:t,alignItems:i,backgroundColor:s})=>({alignItems:i,backgroundColor:s,padding:r,border:t,justifyContent:n,display:"flex",position:"relative",height:"100%",borderRadius:"4px",overflow:"hidden",contain:"content",transition:"border-color 200ms ease-in-out, background-color 500ms ease"})),Nc=Ro.styled("div",{})(({theme:e,justifyContent:n,scrollable:r,faded:t,fullHeight:i})=>({display:"flex",maxHeight:"100%",width:"100%",flexDirection:"column",height:i?"100%":void 0,justifyContent:n,overflow:r?"auto":void 0,WebkitMaskImage:t?"linear-gradient(to bottom, black 60%, transparent 100%)":void 0,maskImage:t?"linear-gradient(to bottom, black 60%, transparent 100%)":void 0,alignItems:t||r?"start":void 0})),Nr=A.memo(function({children:n,focused:r,size:t,selected:i,disabled:s,disabledTooltip:l,saved:a,selectedRow:d,error:u,align:f,allowScroll:h,openPopup:b,removePadding:p,fullHeight:g,onSelect:v,width:w,showExpandIcon:E=!0}){const[x,m]=Un(),C=c.useTheme(),B=A.createRef(),[S,k]=A.useState(!1),I=A.useMemo(()=>Eo(t),[t]),[F,T]=A.useState(!1),[D,P]=A.useState(a),Q=!s&&u,K=A.createRef();A.useEffect(()=>{K.current&&r&&K.current.focus({preventScroll:!0})},[r]),A.useEffect(()=>{a&&P(!0);const N=setTimeout(()=>{P(!1)},800);return()=>{clearTimeout(N)}},[a]);let L=C.spacing(0);if(!p)switch(t){case"l":case"xl":L=C.spacing(2);break;case"m":L=C.spacing(1);break;case"s":L=C.spacing(.5);break;default:L=C.spacing(.25);break}let z;switch(f){case"right":z="flex-end";break;case"center":z="center";break;case"left":default:z="flex-start"}const H=A.useCallback(()=>{if(b){const N=B&&B?.current?.getBoundingClientRect();b(N)}},[B]),J=A.useCallback(N=>{N.detail===3&&H()},[H]),O=A.useCallback(()=>{if(!v)return;const N=B&&B?.current?.getBoundingClientRect();s?v(void 0):!i&&N&&v(N)},[B,v,i,s]),G=A.useCallback(N=>{O(),N.stopPropagation()},[O]);A.useEffect(()=>{if(m){const N=m.height>I;S!==N&&k(N)}},[m,S,I]);const U=!Q&&i;let V;D?V=`2px solid ${C.palette.success.light}`:U?V="2px solid #5E9ED6":Q?V=`2px solid ${C.palette.error.light} !important`:V="2px solid transparent";const W=!s&&h&&S,j=!s&&!h&&S,_=A.useCallback(()=>T(!0),[]),M=A.useCallback(()=>T(!1),[]);return o.jsxs(Yc,{style:{width:w??"100%"},tabIndex:i||s?void 0:0,ref:B,onFocus:G,onClick:J,onMouseEnter:_,onMouseMove:_,onMouseLeave:M,padding:L,contain:W?"content":"size",border:V,justifyContent:z,alignItems:s||!S?"center":void 0,backgroundColor:zc(F,d,s,D??!1,C,U??!1),children:[o.jsxs(re,{children:[g&&!j&&n,(!g||j)&&o.jsx(Nc,{fullHeight:g??!1,justifyContent:z,scrollable:W??!1,faded:j,children:!g&&o.jsx("div",{ref:x,style:{display:"flex",width:"100%",justifyContent:z,height:g?"100%":void 0},children:n})})]}),s&&F&&l&&o.jsx(c.Box,{sx:{position:"absolute",top:4,right:4,fontSize:"14px"},children:o.jsx(c.Tooltip,{title:l,children:o.jsx(Hl,{color:"disabled",fontSize:"inherit"})})}),(Q||E)&&o.jsxs(c.Box,{sx:{position:"absolute",top:"2px",right:"2px"},children:[i&&!s&&E&&o.jsx(c.IconButton,{ref:K,color:"inherit",size:"small",onClick:H,children:o.jsxs("svg",{className:"MuiSvgIcon-root MuiSvgIcon-fontSizeSmall",fill:"#888",width:"20",height:"20",viewBox:"0 0 24 24",children:[o.jsx("path",{className:"cls-2",d:"M20,5a1,1,0,0,0-1-1L14,4h0a1,1,0,0,0,0,2h2.57L13.29,9.29a1,1,0,0,0,0,1.42,1,1,0,0,0,1.42,0L18,7.42V10a1,1,0,0,0,1,1h0a1,1,0,0,0,1-1Z"}),o.jsx("path",{className:"cls-2",d:"M10.71,13.29a1,1,0,0,0-1.42,0L6,16.57V14a1,1,0,0,0-1-1H5a1,1,0,0,0-1,1l0,5a1,1,0,0,0,1,1h5a1,1,0,0,0,0-2H7.42l3.29-3.29A1,1,0,0,0,10.71,13.29Z"})]})}),Q&&o.jsx(Jt,{arrow:!0,placement:"left",title:Q.message,children:o.jsx(Ul,{fontSize:"inherit",color:"error"})})]})]})},(e,n)=>e.error===n.error&&e.value===n.value&&e.disabled===n.disabled&&e.saved===n.saved&&e.allowScroll===n.allowScroll&&e.align===n.align&&e.size===n.size&&e.disabledTooltip===n.disabledTooltip&&e.width===n.width&&e.focused===n.focused&&e.showExpandIcon===n.showExpandIcon&&e.removePadding===n.removePadding&&e.fullHeight===n.fullHeight&&e.selected===n.selected&&e.selectedRow===n.selectedRow);function Uc(e){return e.dataType==="string"&&e.storage?!0:e.dataType==="array"?Array.isArray(e.of)?!1:e.of?.dataType==="string"&&e.of?.storage:!1}const Hc=A.memo(function({propertyKey:n,columnIndex:r,customFieldValidator:t,value:i,property:s,align:l,width:a,height:d,collection:u,path:f,entity:h,readonly:b}){const p=Fe(),g=oe(),{onValueChange:v,size:w,selectedCell:E,focused:x,setFocused:m,select:C,setPopupCell:B,selectedEntityIds:S}=bd(),k=S?.includes(h.id)??!1,I=E?.columnIndex===r&&E?.entity.path===h.path&&E?.entity.id===h.id,[F,T]=A.useState(i),D=A.useRef(i),[P,Q]=A.useState(),[K,L]=A.useState(!1),z=A.useCallback(()=>{L(!0),setTimeout(()=>{L(!1)},100)},[]),H=!!s.Field,J=!!s.Preview,O=wo(s),G=typeof s.disabled=="object"?s.disabled.disabledMessage:void 0,U=!!s.disabled,V=A.useMemo(()=>Yo({property:s,entityId:h.id,customFieldValidator:t,name:n}),[h.id,s,n]);A.useEffect(()=>{Ae(i,D.current)||(Q(void 0),T(i),D.current=i,z())},[z,i]);const W=A.useCallback(ne=>{L(!1),V.validate(ne).then(()=>{Q(void 0),v&&v({value:ne,propertyKey:n,setError:Q,onValueUpdated:z,entity:h,fullPath:f,collection:u,dataSource:p,context:g})}).catch(R=>{Q(R)})},[h,v,n,V]);A.useEffect(()=>{V.validate(F).then(()=>Q(void 0)).catch(ne=>{Q(ne)})},[F,V]);const j=A.useCallback(ne=>{let R;ne===void 0?R=null:R=ne,D.current=R,T(R),W(R)},[W]);Se({property:s,value:F,setValue:j});const _=A.useCallback(ne=>{C(ne?{columnIndex:r,width:a,height:d,entity:h,cellRect:ne,propertyKey:n,collection:u}:void 0)},[u,r,h,d,n,C,a]),M=A.useCallback(ne=>{B(ne?{columnIndex:r,width:a,height:d,entity:h,cellRect:ne,propertyKey:n,collection:u}:void 0)},[u,r,h,d,n,a]);let N,q=!1,$=!1,le=!1,ce=!1;if(b||O)return o.jsx(Nr,{size:w,width:a,focused:x,saved:K,selectedRow:k,value:F,align:l??"left",fullHeight:!0,disabledTooltip:G??(O?"Read only":void 0),disabled:!0,children:o.jsx(we,{width:a,height:Eo(w),propertyKey:n,property:s,entity:h,value:i,size:oo(w)})},`${n}_${h.path}_${h.id}`);if(!H&&(!J||I)){if(Uc(s))N=o.jsx($c,{error:P,disabled:U,focused:x,property:s,entity:h,path:f,value:F,previewSize:oo(w),updateValue:j,propertyKey:n}),$=!0,ce=!0,le=!0;else if(I&&s.dataType==="number"){const R=s;R.enumValues?(N=o.jsx(Yr,{name:n,multiple:!1,disabled:U,focused:x,valueType:"number",small:oo(w)!=="regular",enumValues:R.enumValues,error:P,internalValue:F,updateValue:j}),ce=!0):(N=o.jsx(Dc,{align:l,error:P,focused:x,setFocused:m,disabled:U,value:F,updateValue:j}),q=!0)}else if(I&&s.dataType==="string"){const R=s;if(R.enumValues)N=o.jsx(Yr,{name:n,multiple:!1,focused:x,disabled:U,valueType:"string",small:oo(w)!=="regular",enumValues:R.enumValues,error:P,internalValue:F,updateValue:j}),ce=!0;else if(!R.storage){const Xe=!!R.multiline||!!R.markdown;N=o.jsx(Tc,{error:P,disabled:U,multiline:Xe,setFocused:m,focused:x,value:F,updateValue:j}),q=!0}}else if(s.dataType==="boolean")N=o.jsx(Pc,{error:P,disabled:U,focused:x&&I,internalValue:F,updateValue:j});else if(s.dataType==="date")N=o.jsx(Mc,{name:n,error:P,disabled:U,mode:s.mode,focused:x,internalValue:F,updateValue:j}),q=!0;else if(s.dataType==="reference")typeof s.path=="string"&&(N=o.jsx(Zi,{name:n,internalValue:F,updateValue:j,disabled:U,size:w,path:s.path,multiselect:!1,previewProperties:s.previewProperties,title:s.name,forceFilter:s.forceFilter})),q=!1;else if(s.dataType==="array"){const R=s;if(!R.of&&!R.oneOf)throw Error(`You need to specify an 'of' or 'oneOf' prop (or specify a custom field) in your array property ${n}`);R.of&&!Array.isArray(R.of)&&(R.of.dataType==="string"||R.of.dataType==="number"?I&&R.of.enumValues&&(N=o.jsx(Yr,{name:n,multiple:!0,disabled:U,focused:x,small:oo(w)!=="regular",valueType:R.of.dataType,enumValues:R.of.enumValues,error:P,internalValue:F,updateValue:j}),q=!0,ce=!0):R.of.dataType==="reference"&&(typeof R.of.path=="string"&&(N=o.jsx(Zi,{name:n,disabled:U,internalValue:F,updateValue:j,size:w,multiselect:!0,path:R.of.path,previewProperties:R.of.previewProperties,title:R.of.name,forceFilter:R.of.forceFilter})),q=!1))}}return N||(q=!1,$=I&&!N&&!U&&!O,N=o.jsx(we,{width:a,height:d,entity:h,propertyKey:n,value:F,property:s,size:oo(w)})),o.jsx(Nr,{size:w,width:a,focused:x,onSelect:_,selected:I,selectedRow:k,disabled:U||O,disabledTooltip:G??"Disabled",removePadding:le,fullHeight:ce,saved:K,error:P,align:l,allowScroll:q,showExpandIcon:$,openPopup:U?void 0:M,value:F,children:N},`cell_${n}_${h.path}_${h.id}`)},_c);function _c(e,n){return e.height===n.height&&e.propertyKey===n.propertyKey&&e.align===n.align&&e.width===n.width&&Ae(e.property,n.property)&&Ae(e.value,n.value)&&Ae(e.entity.values,n.entity.values)}function jc({containerRef:e,innerRef:n,x:r,y:t,onMove:i}){let s=0,l=0;const a=A.useRef(!1),d=g=>{if(g.button!==0||!e.current||g.defaultPrevented||g.innerClicked)return;const{x:v,y:w}=e.current.getBoundingClientRect();s=g.screenX-v,l=g.screenY-w,document.addEventListener("mousemove",b),document.addEventListener("mouseup",h),document.addEventListener("selectstart",f),a.current=!0},u=g=>{g.innerClicked=!0},f=g=>{g.preventDefault(),g.stopPropagation()},h=g=>{document.removeEventListener("mousemove",b),document.removeEventListener("mouseup",h),document.removeEventListener("selectstart",f),g.stopPropagation(),a.current=!1},b=g=>{g.target.localName==="input"||!a.current||(i(g.screenX-s,g.screenY-l),g.stopPropagation())},p=()=>{e.current&&(e.current.style.top=`${t}px`,e.current.style.left=`${r}px`)};A.useEffect(()=>{const g=e.current,v=n.current;if(!(!g||!v))return v&&v.addEventListener("mousedown",u),g&&g.addEventListener("mousedown",d),p(),()=>{g&&g.removeEventListener("mousedown",d),v&&v.removeEventListener("mousedown",u)}})}function qc(){const[e,n]=A.useState({width:0,height:0});return A.useLayoutEffect(()=>{function r(){n({width:window.innerWidth,height:window.innerHeight})}return window.addEventListener("resize",r),r(),()=>window.removeEventListener("resize",r)},[]),e}const Jc=({onResize:e})=>{const n=A.useRef(0),r=A.useRef(null),t=A.useRef(e);t.current=e;const i=A.useCallback(l=>{n.current&&cancelAnimationFrame(n.current),n.current=requestAnimationFrame(()=>{t.current(l)})},[]),s=A.useCallback(()=>{const l=r.current;l&&l.contentDocument&&l.contentDocument.defaultView&&l.contentDocument.defaultView.addEventListener("resize",i)},[i]);return A.useEffect(()=>{const l=r.current;return()=>{l&&l.contentDocument&&l.contentDocument.defaultView&&l.contentDocument.defaultView.removeEventListener("resize",i)}},[i]),o.jsx("object",{onLoad:s,ref:r,tabIndex:-1,type:"text/html",data:"about:blank",title:"",style:{position:"absolute",top:0,left:0,height:"100%",width:"100%",pointerEvents:"none",zIndex:-1,opacity:0}})};function Ze({children:e,position:n="sticky",maxWidth:r,translucent:t=!0}){const i=r?o.jsx(c.Container,{maxWidth:r,children:e}):e;return o.jsx(c.Box,{sx:s=>({background:t?s.palette.mode==="light"?"rgba(255,255,255,0.6)":c.alpha(s.palette.background.paper,.1):void 0,backdropFilter:t?"blur(8px)":void 0,borderTop:`1px solid ${s.palette.divider}`,py:1,px:2,display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"flex-end",position:n,bottom:0,right:0,left:0,textAlign:"right",zIndex:2,"& > *:not(:last-child)":{[s.breakpoints.down("md")]:{mr:s.spacing(1)},mr:s.spacing(2)}}),children:i})}function Zc(e){return e.open?o.jsx(Xc,{...e}):null}function Xc({tableKey:e,entity:n,customFieldValidator:r,propertyKey:t,collection:i,path:s,cellRect:l,open:a,onClose:d,columnIndex:u,onCellValueChange:f}){const h=Fe(),b=oe(),[p,g]=A.useState(),[v,w]=A.useState(),[E,x]=A.useState(n?.values),m=i?ve({collection:i,path:s,values:E,entityId:n?.id,fields:b.fields}):void 0,C=qc(),B=A.useRef(null),S=A.useRef(null),k=A.useRef(!1);jc({containerRef:B,innerRef:S,x:v?.x,y:v?.y,onMove:(H,J)=>Q({x:H,y:J})}),A.useEffect(()=>{k.current=!1},[t,n]);const I=A.useCallback(()=>{if(!l)throw Error("getInitialLocation error");return{x:l.left<C.width-l.right?l.x+l.width/2:l.x-l.width/2,y:l.top<C.height-l.bottom?l.y+l.height/2:l.y-l.height/2}},[l,C.height,C.width]),F=A.useCallback(({x:H,y:J})=>{const O=B.current?.getBoundingClientRect();if(!O)throw Error("normalizePosition called before draggableBoundingRect is set");return{x:Math.max(0,Math.min(H,C.width-O.width)),y:Math.max(0,Math.min(J,C.height-O.height))}},[C]),T=A.useCallback(H=>{const J=B.current?.getBoundingClientRect();if(!l||!J)return;const O=F(H??I());(!v||O.x!==v.x||O.y!==v.y)&&w(O)},[l,I,F,v]);A.useEffect(()=>{k.current=!1},[t]),A.useLayoutEffect(()=>{const H=B.current?.getBoundingClientRect();!l||!H||k.current||(T(),k.current=!0)},[l,T,k.current]),A.useLayoutEffect(()=>{T(v)},[C,l]);const D=A.useMemo(()=>{if(!(!m||!n))return Vi(n.id,t&&m.properties[t]?{[t]:m.properties[t]}:{},r)},[s,t,m,n]),P=A.useCallback(()=>T(v),[v,T]),Q=A.useCallback(H=>T(H),[T]),K=async H=>(g(null),i&&n&&f&&t?f({value:H[t],propertyKey:t,entity:n,setError:g,onValueUpdated:()=>{},fullPath:s,collection:i,dataSource:h,context:b}):Promise.resolve());if(!n)return o.jsx(o.Fragment,{});const L=n&&o.jsxs(c.Box,{sx:H=>({overflow:"auto",borderRadius:`${H.shape.borderRadius}px`,backgroundColor:H.palette.background.paper,visibility:a?void 0:"hidden",cursor:"grab"}),children:[o.jsx(me.Formik,{initialValues:n?.values??{},validationSchema:D,validateOnMount:!0,validate:H=>console.debug("Validating",H),onSubmit:(H,J)=>{K(H).then(()=>d()).finally(()=>J.setSubmitting(!1))},children:({handleChange:H,values:J,errors:O,touched:G,dirty:U,setFieldValue:V,setFieldTouched:W,handleSubmit:j,isSubmitting:_})=>{if(A.useEffect(()=>{Ae(J,E)||x(J)},[J]),!n)return o.jsx(ue,{error:"PopupFormField misconfiguration"});if(!m)return o.jsx(o.Fragment,{});const M=_,N={collection:m,entityId:n.id,values:J,path:s,setFieldValue:V,save:K},q=t&&m.properties[t],$=t&&q?{propertyKey:t,disabled:_||wo(q)||!!q.disabled,property:q,includeDescription:!1,underlyingValueHasChanged:!1,context:N,tableMode:!0,partOfArray:!1,autoFocus:a}:void 0;let le=o.jsx(o.Fragment,{children:o.jsx(c.Box,{sx:{width:520,maxWidth:"100vw",maxHeight:"85vh"},children:o.jsxs(me.Form,{onSubmit:j,noValidate:!0,children:[o.jsx(c.Box,{sx:{mb:1,padding:2,display:"flex",flexDirection:"column",position:"relative"},children:o.jsx(c.Box,{ref:S,sx:{cursor:"auto !important"},children:$&&o.jsx(so,{...$})})}),o.jsx(Ze,{children:o.jsx(c.Button,{variant:"contained",color:"primary",type:"submit",disabled:M,children:"Save"})})]})},`popup_form_${e}_${n.id}_${u}`)});const ce=b.plugins;return ce&&ce.forEach(ne=>{ne.form?.provider&&(le=o.jsx(ne.form.provider.Component,{status:"existing",path:s,collection:m,entity:n,context:b,currentEntityId:n.id,formContext:N,...ne.form.provider.props,children:le}))}),le}}),p&&o.jsx(c.Typography,{color:"error",children:p.message})]}),z=o.jsxs(c.Box,{sx:H=>({display:"inline-block",position:"fixed",zIndex:1300,boxShadow:"0 0 0 2px rgba(128,128,128,0.2)",backgroundColor:H.palette.background.paper,borderRadius:`${H.shape.borderRadius}px`,visibility:a?void 0:"hidden",cursor:"grab"}),ref:B,children:[o.jsx(Jc,{onResize:P}),o.jsxs(c.Box,{sx:{overflow:"hidden"},children:[L,o.jsx(c.Box,{sx:{position:"absolute",top:-14,right:-14,backgroundColor:"#888",borderRadius:"32px"},children:o.jsx(c.IconButton,{size:"small",onClick:H=>{H.stopPropagation(),d()},children:o.jsx(Ge,{sx:{color:"white"},fontSize:"small"})})})]})]},`draggable_${t}_${n.id}_${a}`);return o.jsx(c.Portal,{container:document.body,children:z})}function lo(e){return o.jsx(c.Box,{sx:{display:"flex",width:"100vw",maxHeight:"100%",maxWidth:"100%",height:"100vh","@supports (height: 100dvh)":{height:"100dvh"}},children:o.jsx(c.Box,{m:"auto",children:o.jsx(c.CircularProgress,{...e})})})}const Kc=A.memo(function({resizeHandleRef:n,columnIndex:r,isResizingIndex:t,sort:i,onColumnSort:s,onFilterUpdate:l,filter:a,column:d,onClickResizeColumn:u,createFilterField:f}){const h=A.useRef(null),[b,p]=A.useState(!1),[g,v]=A.useState(!1),w=A.useCallback(B=>{v(!0)},[]);A.useCallback(()=>{v(!1)},[]);const E=A.useCallback((B,S)=>{l(d,B),S!==void 0&&v(S)},[d,l]),x=t===r,C=!(t!==r&&t>0)&&(b||x);return o.jsxs(re,{children:[o.jsxs(c.Grid,{sx:B=>({width:d.width,padding:"0px 12px",color:C?B.palette.text.primary:B.palette.text.secondary,backgroundColor:C?c.darken(B.palette.background.default,.05):B.palette.background.default,transition:"color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms",height:"100%",fontSize:"0.750rem",textTransform:"uppercase",fontWeight:600,position:d.frozen?"sticky":"relative",left:d.frozen?0:void 0,zIndex:d.frozen?1:0,userSelect:"none"}),ref:h,wrap:"nowrap",alignItems:"center",onMouseEnter:()=>p(!0),onMouseMove:()=>p(!0),onMouseLeave:()=>p(!1),container:!0,children:[o.jsx(c.Grid,{item:!0,xs:!0,sx:{overflow:"hidden",flexShrink:1},children:o.jsxs(c.Box,{sx:{display:"flex",justifyContent:d.headerAlign,alignItems:"center",flexDirection:"row"},children:[o.jsx(c.Box,{sx:{paddingTop:"4px"},children:d.icon&&d.icon(b||g)}),o.jsx(c.Box,{sx:{display:"-webkit-box",margin:"0px 4px",overflow:"hidden",justifyContent:d.align,WebkitLineClamp:2,WebkitBoxOrient:"vertical",textOverflow:"ellipsis"},children:d.title})]})}),d.sortable&&(i||C||g)&&o.jsx(c.Grid,{item:!0,children:o.jsx(c.Badge,{color:"secondary",variant:"dot",overlap:"circular",invisible:!i,children:o.jsxs(c.IconButton,{size:"small",sx:B=>({backgroundColor:B.palette.mode==="light"?"#f5f5f5":B.palette.background.default}),onClick:()=>{s(d.key)},children:[!i&&o.jsx(mt,{fontSize:"small"}),i==="asc"&&o.jsx(mt,{fontSize:"small"}),i==="desc"&&o.jsx(Cl,{fontSize:"small"})]})})}),d.filter&&o.jsx(c.Grid,{item:!0,children:o.jsx(c.Badge,{color:"secondary",variant:"dot",overlap:"circular",invisible:!a,children:o.jsx(c.IconButton,{sx:B=>({backgroundColor:B.palette.mode==="light"?"#f5f5f5":B.palette.background.default}),size:"small",onClick:w,children:o.jsx(Bl,{fontSize:"small",color:b||g?void 0:"disabled"})})})}),d.resizable&&o.jsx(c.Box,{ref:n,sx:B=>({position:"absolute",height:"100%",width:"4px",top:0,right:0,cursor:"col-resize",backgroundColor:C?B.palette.mode==="dark"?c.lighten(B.palette.background.default,.1):c.darken(B.palette.background.default,.15):void 0}),onMouseDown:u?()=>u(r,d):void 0})]}),d.filter&&f&&o.jsx(Rc,{column:d,filter:a,onHover:b,onFilterUpdate:E,createFilterField:f,popupOpen:g,setPopupOpen:v,anchorEl:h})]})},Ae);function Rc({column:e,onFilterUpdate:n,filter:r,onHover:t,createFilterField:i,popupOpen:s,setPopupOpen:l,anchorEl:a}){const d=e.key,[u,f]=A.useState(r);if(A.useEffect(()=>{f(r)},[r]),!e.filter)return null;const h=()=>{n(u,!1)},b=v=>{n(void 0,!1)},p=!!r,g=i({id:d,filterValue:u,setFilterValue:f,column:e,popupOpen:s,setPopupOpen:l});return g?o.jsx(c.Popover,{id:`popover_${e.key}`,open:s,elevation:3,anchorEl:a.current,onClose:()=>l(!1),anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:o.jsxs(c.Box,{sx:v=>({}),children:[o.jsx(c.Box,{sx:v=>({p:2,fontSize:"0.750rem",fontWeight:600,textTransform:"uppercase"}),children:e.title??d}),o.jsx(c.Divider,{}),g&&o.jsx(c.Box,{p:2,children:g}),o.jsxs(c.Box,{display:"flex",justifyContent:"flex-end",m:2,children:[o.jsx(c.Box,{mr:1,children:o.jsx(c.Button,{disabled:!p,color:"primary",type:"reset","aria-label":"filter clear",onClick:b,children:"Clear"})}),o.jsx(c.Button,{variant:"outlined",color:"primary",onClick:h,children:"Filter"})]})]})}):null}const ed=({columns:e,currentSort:n,onColumnSort:r,onFilterUpdate:t,sortByProperty:i,filter:s,onColumnResize:l,onColumnResizeEnd:a,createFilterField:d})=>{const u=e.map(()=>A.createRef()),[f,h]=A.useState(-1),b=A.useCallback((C,B,S)=>{const k=e[C],I=100,F=800,T=B>F?F:B<I?I:B,D={width:T,key:k.key,column:{...k,width:T}};S?a(D):l(D)},[e,l,a]),p=A.useCallback(C=>{if(f>=0){const B=u[f].current?.parentElement?.getBoundingClientRect().left;return B?C.clientX-B:void 0}},[u,f]),g=A.useCallback(C=>{document.body.style.cursor=C?"col-resize":"auto"},[]),v=A.useCallback(C=>{C.stopPropagation(),C.preventDefault();const B=p(C);B&&b(f,B,!1)},[b,p,f]),w=A.useCallback(C=>{C.stopPropagation(),C.preventDefault();const B=p(C);B&&b(f,B,!0),h(-1),g(!1)},[b,p,f,g]),E=A.useCallback(()=>{document.removeEventListener("mousemove",v),document.removeEventListener("mouseup",w)},[v,w]),x=A.useCallback(()=>{document.addEventListener("mousemove",v),document.addEventListener("mouseup",w)},[v,w]);A.useEffect(()=>(f>=0?x():E(),()=>{E()}),[x,f,E]);const m=A.useCallback(C=>{h(C),g(!0)},[g]);return o.jsx(c.Box,{sx:C=>({position:"sticky",minWidth:"100%",backgroundColor:C.palette.background.default,display:"flex",width:"fit-content",flexDirection:"row",top:0,left:0,zIndex:2,height:50,borderBottom:`1px solid ${C.palette.divider}`}),children:e.map((C,B)=>{const S=e[B],k=S&&s&&s[S.key]?s[S.key]:void 0;return o.jsx(re,{children:o.jsx(Kc,{resizeHandleRef:u[B],columnIndex:B,isResizingIndex:f,onFilterUpdate:t,filter:k,sort:i===S.key?n:void 0,onColumnSort:r,onClickResizeColumn:m,column:S,createFilterField:d})},"header_"+S.key)})})},od=c.styled("div",{})(({theme:e,size:n,cursor:r,hovered:t})=>({display:"flex",minWidth:"100%",height:Eo(n),cursor:r,flexDirection:"row",fontSize:"0.875rem",borderBottom:`1px solid ${e.palette.divider}`,backgroundColor:t?e.palette.mode==="dark"?c.lighten(e.palette.background.paper,.01):"rgb(252, 252, 253)":void 0})),nd=A.memo(function({rowData:n,rowIndex:r,children:t,onRowClick:i,size:s,style:l,hoverRow:a}){const[d,u]=A.useState(!1),f=A.useCallback(p=>i?i({rowData:n,rowIndex:r,event:p}):void 0,[i,n,r]),h=A.useCallback(()=>u(!0),[]),b=A.useCallback(()=>u(!1),[]);return o.jsx(od,{onClick:f,size:s,cursor:i?"pointer":void 0,hovered:a&&d,style:{...l,width:"fit-content"},onMouseEnter:h,onMouseMove:h,onMouseLeave:b,children:t})},Ae),rd=A.memo(function(n){return n.rowData&&n.cellRenderer({cellData:n.cellData,rowData:n.rowData,rowIndex:n.rowIndex,isScrolling:!1,column:n.column,columns:n.columns,columnIndex:n.columnIndex,width:n.column.width})},(e,n)=>Ae(e,n)),Tn=A.createContext({});Tn.displayName="VirtualListContext";const td=A.forwardRef(({children:e,...n},r)=>o.jsx(Tn.Consumer,{children:t=>{const i=t.customView;return o.jsxs(o.Fragment,{children:[o.jsx("div",{id:"virtual-table",style:{position:"relative",height:"100%"},children:o.jsxs("div",{ref:r,...n,style:{...n?.style,minHeight:"100%",position:"relative"},children:[o.jsx(ed,{...t}),!i&&e]})}),i&&o.jsx("div",{style:{position:"sticky",top:"56px",flexGrow:1,height:"calc(100% - 56px)",marginTop:"calc(56px - 100vh)",left:0},children:i})]})}})),Xi=A.memo(function({data:n,onResetPagination:r,onEndReached:t,size:i="m",columns:s,onRowClick:l,onColumnResize:a,filter:d,checkFilterCombination:u,onFilterUpdate:f,sortBy:h,error:b,emptyMessage:p,onSortByUpdate:g,loading:v,cellRenderer:w,hoverRow:E,createFilterField:x}){const m=h?h[0]:void 0,C=h?h[1]:void 0,[B,S]=A.useState(s),k=A.useRef(null),I=A.useRef(0);A.useEffect(()=>{S(s)},[s]);const[F,T]=Un(),D=A.useCallback(_=>{S(B.map(M=>M.key===_.column.key?_.column:M))},[B]),P=A.useCallback(_=>{S(B.map(M=>M.key===_.column.key?_.column:M)),a&&a(_)},[B,a]),Q=A.useRef();A.useEffect(()=>{Q.current=d},[d]);const K=A.useCallback(()=>{I.current=0,k.current&&k.current.scrollTo(k.current?.scrollLeft,0)},[]),L=A.useCallback(_=>{const M=m===_&&C==="desc",q=m===_&&C==="asc"?"desc":M?void 0:"asc",$=M?void 0:_,le=Q.current,ce=q&&$?[$,q]:void 0;le&&u&&!u(le,ce)&&f&&f(void 0),r&&r(),g&&g(ce),K()},[u,C,f,r,g,K,m]),z=A.useCallback(()=>{I.current=0,g&&g(void 0)},[g]),H=Math.max((n?.length??0)*Eo(i)-T.height,0),J=A.useCallback(_=>{t&&(n?.length??0)>0&&_>I.current+500&&(I.current=_,t())},[n,t]),O=A.useCallback(({scrollOffset:_,scrollUpdateWasRequested:M})=>{!M&&_>=H-500&&J(_)},[H,J]),G=A.useCallback((_,M)=>{I.current=0;const N=Q.current;let q=N?{...N}:{};M?q[_.key]=M:delete q[_.key],!u||u(q,m&&C?[m,C]:void 0)||(q=M?{[_.key]:M}:{}),f&&f(q),_.key!==m&&z()},[u,C,f,z,m]),U=A.useCallback(()=>o.jsxs(c.Box,{sx:{height:"calc(100% - 64px)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",position:"sticky",left:0},children:[o.jsx(c.Typography,{variant:"h6",children:"Error fetching data from the data source"}),b?.message&&o.jsx(c.Typography,{children:b?.message})]}),[b?.message]),V=A.useCallback(()=>v?o.jsx(lo,{}):o.jsxs(c.Box,{sx:{display:"flex",overflow:"auto",alignItems:"center",justifyContent:"center",p:2,gap:2,height:"100%"},children:[o.jsx(wl,{}),o.jsx(c.Typography,{children:p})]}),[p,v]),W=!v&&(n?.length??0)===0,j=b?U():W?V():void 0;return o.jsx(c.Box,{ref:F,sx:{height:"100%",width:"100%"},children:o.jsx(Tn.Provider,{value:{data:n,size:i,cellRenderer:w,columns:B,currentSort:C,onRowClick:l,customView:j,onColumnResize:D,onColumnResizeEnd:P,filter:Q.current,onColumnSort:L,onFilterUpdate:G,sortByProperty:m,hoverRow:E??!1,createFilterField:x},children:o.jsx(id,{outerRef:k,width:T.width,height:T.height,itemCount:n?.length??0,onScroll:O,itemSize:Eo(i)},i)})})},Ae);function id({outerRef:e,width:n,height:r,itemCount:t,onScroll:i,itemSize:s}){const l=A.useCallback(({index:a,style:d})=>o.jsx(Tn.Consumer,{children:({onRowClick:u,data:f,columns:h,size:b="m",cellRenderer:p,hoverRow:g})=>{const v=f&&f[a];return o.jsx(nd,{rowData:v,rowIndex:a,onRowClick:u,columns:h,hoverRow:g,style:{...d,top:`calc(${d.top}px + 50px)`},size:b,children:h.map((w,E)=>{const x=v&&v[w.key];return o.jsx(rd,{dataKey:w.key,cellRenderer:p,column:w,columns:h,rowData:v,cellData:x,rowIndex:a,columnIndex:E},`cell_${w.key}`)})},`row_${a}`)}}),[]);return o.jsx(xl.FixedSizeList,{outerRef:e,innerElementType:td,width:n,height:r,overscanCount:4,itemCount:t,onScroll:i,itemSize:s,children:l})}function Ur({entity:e,width:n,frozen:r,isSelected:t,selectionEnabled:i,size:s,toggleEntitySelection:l,onCopyClicked:a,onEditClicked:d,onDeleteClicked:u,hideId:f}){const h=c.useTheme(),b=c.useMediaQuery(h.breakpoints.up("md")),p=!!d,g=!!a,v=!!u,[w,E]=A.useState(null),x=A.useCallback(I=>{E(I.currentTarget),I.stopPropagation()},[E]),m=A.useCallback(()=>{E(null)},[E]),C=A.useCallback(I=>{l&&l(e),I.preventDefault(),I.stopPropagation()},[e,l]),B=A.useCallback(I=>{I.stopPropagation(),u&&u(e),E(null)},[e,u,E]),S=A.useCallback(I=>{I.stopPropagation(),a&&a(e),E(null)},[e,a,E]),k=A.useCallback(I=>{I.stopPropagation(),l&&l(e)},[e,l]);return o.jsxs(c.Box,{style:{width:n},onClick:k,sx:I=>({height:"100%",display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",position:r?"sticky":"initial",left:r?0:"initial",background:(I.palette.mode==="dark",c.alpha(I.palette.background.default,.96)),contain:"strict",zIndex:1}),children:[(p||v||i)&&o.jsxs(c.Box,{sx:{minWidth:138,display:"flex",justifyContent:"center"},children:[p&&o.jsx(c.Tooltip,{title:`Edit ${e.id}`,children:o.jsx(c.IconButton,{onClick:I=>{I.stopPropagation(),d&&d(e)},size:b?"medium":"small",children:o.jsx(Be.KeyboardTab,{})})}),i&&o.jsx(c.Tooltip,{title:`Select ${e.id}`,children:o.jsx(c.Checkbox,{size:b?"medium":"small",checked:t,onChange:C})}),(g||v)&&o.jsx(c.IconButton,{onClick:x,size:b?"medium":"small",children:o.jsx(Be.MoreVert,{})}),(g||v)&&o.jsxs(c.Menu,{anchorEl:w,open:!!w,onClose:m,elevation:3,children:[v&&o.jsxs(c.MenuItem,{onClick:B,children:[o.jsx(c.ListItemIcon,{children:o.jsx(Be.Delete,{})}),o.jsx(c.ListItemText,{primary:"Delete"})]}),g&&o.jsxs(c.MenuItem,{onClick:S,children:[o.jsx(c.ListItemIcon,{children:o.jsx(Be.FileCopy,{})}),o.jsx(c.ListItemText,{primary:"Copy"})]})]})]}),!f&&s!=="xs"&&o.jsx(c.Box,{sx:{width:138,textAlign:"center",textOverflow:"ellipsis",overflow:"hidden"},children:e?o.jsxs(c.Typography,{className:"mono",variant:"caption",color:"textSecondary",children:[" ",e.id," "]}):o.jsx(c.Skeleton,{variant:"text"})})]})}function Ki({onTextSearch:e,placeholder:n="Search",expandable:r=!1,large:t=!1}){const[i,s]=A.useState(""),[l,a]=A.useState(!1),d=A.useDeferredValue(i);A.useEffect(()=>{e(d||void 0)},[d]);const u=A.useCallback(()=>{s(""),e(void 0)},[]);return o.jsxs(c.Box,{sx:f=>({position:"relative",display:"flex",alignItems:"center",height:t?56:40,width:r?void 0:"100%",minWidth:"200px",borderRadius:`${f.shape.borderRadius}px`,backgroundColor:f.palette.mode==="light"?be.darken(f.palette.background.default,.05):be.darken(f.palette.background.default,.2),"&:hover":{backgroundColor:f.palette.mode==="light"?be.darken(f.palette.background.default,.08):be.darken(f.palette.background.default,.3)},[f.breakpoints.up("sm")]:{width:"auto"}}),children:[o.jsx(c.Box,{sx:f=>({padding:f.spacing(0,2),height:"100%",position:"absolute",pointerEvents:"none",display:"flex",alignItems:"center",justifyContent:"center"}),children:o.jsx(Gl,{htmlColor:"#888"})}),o.jsx(It,{placeholder:n,value:i,onChange:f=>{s(f.target.value)},onFocus:()=>a(!0),onBlur:()=>a(!1),sx:{width:r?void 0:"100%",color:"inherit",minHeight:"inherit"},inputProps:{sx:f=>({padding:f.spacing(1,1,1,0),paddingLeft:`calc(1em + ${f.spacing(4)})`,transition:f.transitions.create("width"),width:"100%",[f.breakpoints.up("sm")]:{width:r?l?"20ch":"12ch":"100%"}}),"aria-label":n},endAdornment:i?o.jsx(c.IconButton,{sx:{mr:t?2:1},size:"small",onClick:u,children:o.jsx(Ge,{fontSize:"small"})}):o.jsx("div",{style:{width:26}})})]})}const sd=be.styled(It)(({theme:e})=>({"label + &":{},"& .MuiInputBase-input":{borderRadius:4,position:"relative",backgroundColor:e.palette.mode==="light"?be.alpha(e.palette.common.black,.05):be.darken(e.palette.background.default,.2),fontSize:14,fontWeight:e.typography.fontWeightMedium,padding:"8px 26px 8px 12px",transition:e.transitions.create(["border-color","box-shadow"]),"&:focus":{borderRadius:4}}}));function Ri(e){return o.jsx(Il,{input:o.jsx(sd,{}),renderValue:n=>n.toUpperCase(),...e,MenuProps:{MenuListProps:{disablePadding:!0,style:{borderRadius:4}},elevation:1},children:e.children})}function es(e){return o.jsx(De,{...e,sx:n=>({backgroundColor:n.palette.background.default,fontSize:14,fontWeight:n.typography.fontWeightMedium,paddingTop:n.spacing(1),paddingBottom:n.spacing(1),"&:hover":{backgroundColor:be.darken(n.palette.background.default,.1)},"&:focus":{backgroundColor:be.darken(n.palette.background.default,.2),"& .MuiListItemIcon-root, & .MuiListItemText-primary":{color:n.palette.text.primary}}}),children:e.children})}function ld(e){const n=c.useTheme(),r=c.useMediaQuery(n.breakpoints.up("md")),t=!e.forceFilter&&e.filterIsSet&&o.jsx(c.Tooltip,{title:"Clear filter",children:o.jsx(c.IconButton,{sx:{height:"fit-content"},"aria-label":"filter clear",onClick:e.clearFilter,size:"medium",children:o.jsx(_l,{})})}),i=o.jsx(Ri,{variant:"standard",value:e.size,sx:{width:56,height:40},onChange:s=>e.onSizeChanged(s.target.value),renderValue:s=>s.toUpperCase(),children:["xs","s","m","l","xl"].map(s=>o.jsx(es,{value:s,children:s.toUpperCase()},`size-select-${s}`))});return o.jsxs(c.Box,{sx:{minHeight:56,overflowX:"auto",[n.breakpoints.down("sm")]:{px:n.spacing(1)},px:n.spacing(2),backgroundColor:n.palette.background.default,borderBottom:`1px solid ${n.palette.divider}`,display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",width:"100%"},children:[o.jsxs(c.Box,{display:"flex",alignItems:"center",sx:{"& > *":{[n.breakpoints.down("md")]:{marginRight:`${n.spacing(1)} !important`},marginRight:`${n.spacing(2)} !important`}},children:[e.title&&o.jsx(c.Hidden,{lgDown:!0,children:e.title}),i,e.actionsStart,t]}),o.jsxs(c.Box,{sx:{display:"flex",alignItems:"center","& > *":{[n.breakpoints.down("md")]:{marginRight:`${n.spacing(.5)} !important`},marginRight:`${n.spacing(1)} !important`}},children:[r&&o.jsx(c.Box,{width:22,children:e.loading&&o.jsx(c.CircularProgress,{size:16,thickness:8})}),e.onTextSearch&&o.jsx(Ki,{onTextSearch:e.onTextSearch,expandable:!0},"search-bar"),e.actions]})]})}const ad={"==":"==","!=":"!=",">":">","<":"<",">=":">=","<=":"<=",in:"In","not-in":"Not in","array-contains":"Contains","array-contains-any":"Contains Any"},Hr=["array-contains-any","in","not-in"];function cd({name:e,value:n,setValue:r,isArray:t,path:i,title:s,previewProperties:l,setPopupOpen:a}){const d=t?["array-contains"]:["==","!=",">","<",">=","<="],[u,f]=A.useState(!1);t?d.push("array-contains-any"):d.push("in","not-in");const[h,b]=n||[d[0],void 0],[p,g]=A.useState(h),[v,w]=A.useState(b),E=v?Array.isArray(v)?v.map(D=>D.id):[v.id]:[];function x(D,P){const Q=Hr.includes(p),K=Hr.includes(D);let L=P;Q!==K&&(L=K?L instanceof Pe?[L]:[]:void 0),g(D),w(L);const z=L!==null&&Array.isArray(L)?L.length>0:L!==void 0;r(D&&z?[D,L]:void 0)}const m=pe(),C=A.useMemo(()=>i?m.getCollection(i):void 0,[i]),B=D=>{x(p,io(D))},S=D=>{x(p,D.map(P=>io(P)))},k=Hr.includes(p),I=Qo({multiselect:k,path:i,collection:C,onSingleEntitySelected:B,onMultipleEntitiesSelected:S,selectedEntityIds:E,onClose:()=>{a(!0)}}),F=()=>{a(!1),I.open()},T=D=>o.jsx(c.Box,{sx:{mb:.5},onMouseEnter:()=>f(!0),onMouseMove:()=>f(!0),onMouseLeave:()=>f(!1),children:o.jsx(je,{disabled:!i,previewProperties:l,size:"regular",onClick:F,reference:D,onHover:u,allowEntityNavigation:!1})});return o.jsxs(c.Box,{display:"flex",width:440,flexDirection:"row",children:[o.jsx(c.Box,{width:120,children:o.jsx(c.FormControl,{fullWidth:!0,children:o.jsx(c.Select,{value:p,fullWidth:!0,onChange:D=>{x(D.target.value,v)},children:d.map(D=>o.jsx(c.MenuItem,{value:D,children:ad[D]},`filter_op_${e}_${D}`))})})}),o.jsx(c.Box,{flexGrow:1,ml:1,children:o.jsxs(c.FormControl,{fullWidth:!0,sx:{height:"100%"},children:[v&&Array.isArray(v)&&o.jsx(c.Box,{children:v.map((D,P)=>T(D))}),v&&!Array.isArray(v)&&o.jsx(c.Box,{children:T(v)}),(!v||Array.isArray(v)&&v.length===0)&&o.jsx(c.Button,{onClick:F,sx:{height:"100%"},children:k?"Select references":"Select reference"})]})})]})}const dd={"==":"==","!=":"!=",">":">","<":"<",">=":">=","<=":"<=",in:"In","not-in":"Not in","array-contains":"Contains","array-contains-any":"Any"},_r=["array-contains-any","in","not-in"];function Ad({name:e,value:n,setValue:r,dataType:t,isArray:i,enumValues:s,title:l}){const a=i?["array-contains"]:["==","!=",">","<",">=","<="];s&&(i?a.push("array-contains-any"):a.push("in","not-in"));const[d,u]=n||[a[0],void 0],[f,h]=A.useState(d),[b,p]=A.useState(u);function g(w,E){let x=E;const m=_r.includes(f),C=_r.includes(w);m!==C&&(x=C?typeof E=="string"||typeof E=="number"?[E]:[]:""),typeof x=="number"&&isNaN(x)&&(x=void 0),h(w),p(x);const B=x!==null&&Array.isArray(x)?x.length>0:x!==void 0;r(w&&B?[w,x]:void 0)}const v=_r.includes(f);return o.jsxs(c.Box,{display:"flex",width:440,alignItems:"center",children:[o.jsx(c.Box,{width:80,children:o.jsx(c.FormControl,{fullWidth:!0,children:o.jsx(c.Select,{value:f,fullWidth:!0,onChange:w=>{g(w.target.value,b)},children:a.map(w=>o.jsx(c.MenuItem,{value:w,children:dd[w]},`filter_op_${e}_${w}`))})})}),o.jsx(c.Box,{flexGrow:1,ml:1,children:o.jsxs(c.FormControl,{fullWidth:!0,children:[!s&&o.jsx(c.OutlinedInput,{fullWidth:!0,type:t==="number"?"number":void 0,value:b!==void 0?b:"",onChange:w=>{const E=t==="number"?parseFloat(w.target.value):w.target.value;g(f,E)},endAdornment:b&&o.jsx(c.IconButton,{sx:{position:"absolute",right:"12px",top:"8px"},onClick:w=>g(f,void 0),children:o.jsx(Ge,{})})},`filter_${e}`),s&&o.jsx(c.Select,{fullWidth:!0,multiple:v,value:b!==void 0?b:i?[]:"",onChange:w=>g(f,t==="number"?parseInt(w.target.value):w.target.value),endAdornment:b&&o.jsx(c.IconButton,{sx:{position:"absolute",right:"12px",top:"8px"},onClick:w=>g(f,void 0),children:o.jsx(Ge,{})}),renderValue:v?w=>o.jsx("div",{children:w.map(E=>o.jsx(Ie,{enumKey:E,enumValues:s,small:!0},`select_value_${e}_${E}`))}):void 0,children:s.map(w=>o.jsx(c.MenuItem,{value:w.id,children:o.jsx(Ie,{enumKey:w.id,enumValues:s,small:!0})},`select_${e}_${w.id}`))},`filter-select-${v}-${e}`)]})})]})}const os="BooleanFilterField",jr={formControl:`${os}-formControl`,label:`${os}-label`},ud=be.styled("div")(({theme:e})=>({[`& .${jr.formControl}`]:{width:"200px"},[`& .${jr.label}`]:{width:"100%",height:"100%"}}));function fd({name:e,title:n,value:r,setValue:t}){function i(a){t(a!==void 0?["==",a]:void 0)}const s=r&&r[1],l=!!r;return o.jsx(ud,{children:o.jsx(c.FormControlLabel,{className:jr.formControl,labelPlacement:"end",checked:l&&s,control:o.jsx(c.Checkbox,{indeterminate:!l,onChange:a=>{i(s?!1:l?void 0:!0)}},`filter-${e}`),label:l?s?`${n} is true`:`${n} is false`:"No filter"})})}function Dn({mode:e,value:n,onChange:r,disabled:t,clearable:i,small:s}){const l=e===void 0||e==="date_time"?_n.DateTimePicker:Hn.DatePicker;return o.jsx(l,{value:n??null,disabled:t,renderInput:a=>o.jsx(c.TextField,{...a,fullWidth:!0,disabled:t,sx:d=>({height:s?"48px":"56px",borderRadius:`${d.shape.borderRadius}px`}),InputProps:{...a.InputProps,sx:d=>({height:s?"48px":"56px",borderRadius:`${d.shape.borderRadius}px`,padding:s?"0 0px":void 0}),disableUnderline:!0,endAdornment:i?o.jsxs(c.Box,{sx:{pr:2,gap:2},children:[o.jsx(c.IconButton,{sx:{position:"absolute",right:"56px",top:"8px"},onClick:d=>r?.(null),children:o.jsx(Ge,{})}),a.InputProps?.endAdornment]}):null},variant:"filled"}),onChange:r})}const hd={"==":"==","!=":"!=",">":">","<":"<",">=":">=","<=":"<=",in:"in","array-contains":"Contains","array-contains-any":"Any"},ns=["array-contains-any","in"];function gd({name:e,isArray:n,mode:r,value:t,setValue:i,title:s}){const l=n?["array-contains"]:["==","!=",">","<",">=","<="],[a,d]=t||[l[0],void 0],[u,f]=A.useState(a),[h,b]=A.useState(d);function p(g,v){let w=v;const E=ns.includes(u),x=ns.includes(g);E!==x&&(w=x?v?[v]:[]:""),f(g),b(w===null?void 0:w);const m=w!==null&&Array.isArray(w)?w.length>0:w!==void 0;i(g&&m?[g,w]:void 0)}return o.jsxs(c.Box,{display:"flex",width:440,alignItems:"center",children:[o.jsx(c.Box,{width:80,children:o.jsx(c.FormControl,{fullWidth:!0,children:o.jsx(c.Select,{value:u,fullWidth:!0,onChange:g=>{p(g.target.value,h)},children:l.map(g=>o.jsx(c.MenuItem,{value:g,children:hd[g]},`filter_op_${e}_${g}`))})})}),o.jsx(c.Box,{flexGrow:1,ml:1,children:o.jsx(Dn,{mode:r,value:h,onChange:g=>{p(u,g===null?void 0:g)},clearable:!0})})]})}const pd={},rs=A.createContext(pd),bd=()=>A.useContext(rs),qr="collectionGroupParent",Jr=A.memo(function({fullPath:n,initialFilter:r,initialSort:t,filterCombinations:i,forceFilter:s,actionsStart:l,actions:a,title:d,tableRowActionsBuilder:u,selectionController:f,highlightedEntities:h,onEntityClick:b,onColumnResize:p,onSizeChanged:g,textSearchEnabled:v=!1,hoverRow:w=!0,inlineEditing:E=!1,tableController:{data:x,dataLoading:m,noMoreToLoad:C,dataLoadingError:B,filterValues:S,setFilterValues:k,sortBy:I,setSortBy:F,searchString:T,setSearchString:D,clearFilter:P,itemCount:Q,setItemCount:K,pageSize:L,paginationEnabled:z,checkFilterCombination:H},...J}){const O=pe(),G=c.useTheme(),U=c.useMediaQuery(G.breakpoints.up("md")),V=!!s,W=f?.selectedEntities?.length>0?f?.selectedEntities:h,j=A.useRef(Math.random().toString(36)),_=oe(),M=Fe(),N=He(),q=A.useMemo(()=>ve({collection:J,path:n,fields:_.fields}),[J,n]),[$,le]=A.useState(q.defaultSize??"m"),[ce,ne]=A.useState(void 0),[R,Xe]=A.useState(void 0),[jo,co]=A.useState(!1),So=W?.map(Z=>Z.id),Fo=!!S&&Object.keys(S).length>0,Ke=A.useMemo(()=>{const Z=J.subcollections?.map(te=>({id:Ji(te),name:te.name,width:200,dependencies:[],Builder:({entity:se})=>o.jsx(c.Button,{color:"primary",variant:"outlined",startIcon:o.jsx(Nn,{fontSize:"small"}),onClick:ae=>{ae.stopPropagation(),N.open({path:n,entityId:se.id,selectedSubPath:te.alias??te.path,collection:J,updateUrl:!0})},children:te.name})}))??[],he=J.collectionGroup?[{id:qr,name:"Parent entities",width:260,dependencies:[],Builder:({entity:te})=>{const se=O.getParentReferencesFromPath(te.path);return o.jsx(o.Fragment,{children:se.map(ae=>o.jsx(je,{reference:ae,size:"tiny"},ae.path+"/"+ae.id))})}}]:[];return[...J.additionalFields??J.additionalColumns??[],...Z,...he]},[J,n]),lt=A.useCallback(({name:Z,value:he,property:te,entityId:se})=>M.checkUniqueField(n,Z,he,te,se),[n]),Ln=()=>{!z||m||C||Q!==void 0&&K(Q+L)},$n=A.useCallback(()=>{K(L)},[L]),Vn=A.useCallback(({rowData:Z})=>{if(!E)return b&&b(Z)},[b,E]),at=A.useCallback(Z=>{g&&g(Z),le(Z)},[]),ct=A.useCallback(Z=>D(Z),[]),Ao=A.useMemo(()=>Ke?Ke.map(Z=>({[Z.id]:Z})).reduce((Z,he)=>({...Z,...he}),{}):{},[Ke]);A.useEffect(()=>{const Z=he=>{he.keyCode===27&&At()};return document.addEventListener("keydown",Z,!1),()=>{document.removeEventListener("keydown",Z,!1)}});const dt=A.useCallback(Z=>{ne(Z),co(!0)},[]),At=A.useCallback(()=>{ne(void 0),co(!1)},[]),ut=A.useCallback(()=>{Xe(void 0),co(!0)},[]),Wn=yd(q,!0),qo=lt,Y=A.useCallback(({column:Z,columnIndex:he,rowData:te,rowIndex:se})=>{const ae=te,ze=Z.key,Ko=Or(J.properties,ze);if(!Ko)return null;const Io=Te({propertyKey:ze,propertyOrBuilder:Ko,path:n,propertyValue:ae.values?Ye(ae.values,ze):void 0,values:ae.values,entityId:ae.id,fields:_.fields});return Io?o.jsx(re,{children:ae?o.jsx(Hc,{readonly:!E,align:Z.align??"left",propertyKey:ze,property:Io,setFocused:co,value:ae?.values?Ye(ae.values,ze):void 0,collection:J,customFieldValidator:qo,columnIndex:he,width:Z.width,height:Eo($),entity:ae,path:ae.path},`property_table_cell_${ae.id}_${ze}`):Le()}):null},[J,qo,n,E,$,So]),ie=A.useCallback(({column:Z,rowData:he,width:te})=>{const se=he,ae=Ao[Z.key],ze=ae.dependencies?Object.entries(se.values).filter(([Io,_s])=>ae.dependencies.includes(Io)).reduce((Io,_s)=>({...Io,..._s}),{}):se;ae.builder&&console.warn("`additionalField.builder` is deprecated. Use `additionalField.Builder` instead.");const Ko=ae.builder??ae.Builder;if(!Ko)throw new Error("No builder provided for additional field");return o.jsx(Nr,{width:te,size:$,focused:jo,value:ze,selected:!1,selectedRow:So?.includes(se.id)??!1,disabled:!0,align:"left",allowScroll:!1,showExpandIcon:!1,disabledTooltip:"This column can't be edited directly",children:o.jsx(re,{children:o.jsx(Ko,{entity:se,context:_})})},`additional_table_cell_${se.id}_${Z.key}`)},[Ao,$,So]),de=A.useMemo(()=>{const Z=Object.entries(q.properties).flatMap(([te,se])=>se.dataType==="map"&&se.spreadChildren&&se.properties?Object.keys(se.properties).map(ae=>`${te}.${ae}`):[te]).map(te=>{const se=Gr(q.properties,te);if(!se)throw Error("Internal error: no property found in path "+te);const ae=ss(se);return{key:te,align:Ic(se),icon:ze=>ye(se,ze?void 0:"disabled","small"),title:se.name??te,sortable:s?Object.keys(s).includes(te):!0,filter:!V&&ae,width:qi(se),resizable:!0,custom:se}}),he=Ke?Ke.map(te=>({key:te.id,type:"additional",align:"left",sortable:!1,title:te.name,width:te.width??200})):[];return[...Z,...he]},[Ke,V,s,q.properties]),uo=A.useMemo(()=>({key:"id_ewcfedcswdf3",width:U?160:130,title:"ID",resizable:!1,frozen:U,headerAlign:"center"}),[U]),Jo=A.useMemo(()=>[uo,...Wn.map(Z=>de.find(he=>he.key===Z)).filter(Z=>!!Z)],[de,Wn,uo]),Zo=A.useCallback(Z=>{const he=Z.column,te=Z.columns,se=he.key;if(Z.columnIndex===0)return u?u({entity:Z.rowData,size:$,width:he.width,frozen:he.frozen}):o.jsx(Ur,{entity:Z.rowData,width:he.width,frozen:he.frozen,size:$});if(Ao[se])return ie(Z);if(Z.columnIndex<te.length+1)return Y(Z);throw Error("Internal: columns not mapped properly")},[Ao,u,$,ie,Y]),Xo=A.useCallback(Z=>{k({...Z,...s})},[s]);return o.jsx(rs.Provider,{value:{setPopupCell:Xe,select:dt,onValueChange:ts,size:$,selectedCell:ce,selectedEntityIds:So,focused:jo,setFocused:co},children:o.jsxs(c.Box,{sx:Z=>({height:"100%",width:"100%",display:"flex",flexDirection:"column",backgroundColor:Z.palette.background.paper}),children:[o.jsx(ld,{forceFilter:V,filterIsSet:Fo,onTextSearch:v?ct:void 0,clearFilter:P,size:$,onSizeChanged:at,title:d,actionsStart:l,actions:a,loading:m}),o.jsx(c.Box,{sx:{flexGrow:1},children:o.jsx(Xi,{data:x,columns:Jo,cellRenderer:Zo,onRowClick:E?void 0:Vn,onEndReached:Ln,onResetPagination:$n,error:B,paginationEnabled:z,onColumnResize:p,size:$,loading:m,filter:S,onFilterUpdate:Xo,sortBy:I,onSortByUpdate:F,hoverRow:w,checkFilterCombination:H,createFilterField:wd})}),o.jsx(Zc,{open:!!R,onClose:ut,cellRect:R?.cellRect,columnIndex:R?.columnIndex,propertyKey:R?.propertyKey,collection:R?.collection,entity:R?.entity,tableKey:j.current,customFieldValidator:qo,path:n,onCellValueChange:ts},`popup_form_${R?.columnIndex}_${R?.entity?.id}`)]})})},Ae),ts=({fullPath:e,collection:n,dataSource:r,context:t,value:i,propertyKey:s,onValueUpdated:l,setError:a,entity:d})=>{const u=me.setIn({...d.values},s,i),f={path:e,entityId:d.id,values:u,previousValues:d.values,collection:n,status:"existing"};return er({...f,callbacks:n.callbacks,dataSource:r,context:t,onSaveSuccess:()=>l(),onSaveFailure:h=>{console.error("Save failure"),console.error(h),a(h)}})};function vd(e,n){const r=Object.keys(e.properties);e.additionalColumns&&console.warn("`additionalColumns` is deprecated and will be removed in previous versions. Use `additionalFields` instead, with the same structure.");const t=e.additionalFields??e.additionalColumns??[],i=e.subcollections??[],s=[...r,...t.map(l=>l.id)];if(n){const l=i.map(a=>Ji(a));s.push(...l.filter(a=>!s.includes(a)))}return e.collectionGroup&&s.push(qr),is(e,s)}function yd(e,n){return A.useMemo(()=>e.propertiesOrder?is(e,e.propertiesOrder):vd(e,n),[e,n])}function is(e,n){return n.flatMap(r=>{const t=e.properties[r];return t?t.hideFromCollection?[null]:t.disabled&&typeof t.disabled=="object"&&t.disabled.hidden?[null]:t.dataType==="map"&&t.spreadChildren&&t.properties?Object.keys(t.properties).map(s=>`${r}.${s}`):[r]:e.additionalFields?.find(s=>s.id===r)?[r]:e.collectionGroup&&r===qr?[r]:[null]}).filter(r=>r!==null)}function wd({id:e,filterValue:n,setFilterValue:r,column:t,popupOpen:i,setPopupOpen:s}){const l=t.custom;if(!l)return null;const a=l?.dataType==="array",d=a?l.of:l;if(!d)return null;if(d.dataType==="reference")return o.jsx(cd,{value:n,setValue:r,name:e,isArray:a,path:d.path,title:l?.name,previewProperties:d?.previewProperties,popupOpen:i,setPopupOpen:s});if(d.dataType==="number"||d.dataType==="string"){const u=d.name,f=d.enumValues?No(d.enumValues):void 0;return o.jsx(Ad,{value:n,setValue:r,name:e,dataType:d.dataType,isArray:a,enumValues:f,title:u})}else if(d.dataType==="boolean"){const u=d.name;return o.jsx(fd,{value:n,setValue:r,name:e,title:u})}else if(d.dataType==="date"){const u=d.name;return o.jsx(gd,{value:n,setValue:r,name:e,mode:d.mode,isArray:a,title:u})}return o.jsx("div",{children:`Currently the field ${l.dataType} is not supported`})}function ss(e,n=!1){return n?["string","number","date","reference"].includes(e.dataType):e.dataType==="array"?e.of?ss(e.of,!0):!1:["string","number","boolean","date","reference","array"].includes(e.dataType)}const ls={enter:225,exit:175},xd=A.forwardRef(function(n,r){const{children:t,onClose:i,open:s,offsetPosition:l}=n,a=c.useTheme();return o.jsx(c.Modal,{BackdropProps:{transitionDuration:ls,sx:{backgroundColor:a.palette.mode==="dark"?"rgba(0, 0, 0, 0.85)":"rgba(0, 0, 0, 0.6)"}},BackdropComponent:c.Backdrop,open:s,onClose:i?()=>i(!1):void 0,ref:r,keepMounted:!0,disableEnforceFocus:!0,disableEscapeKeyDown:!0,sx:{transition:`transform 300ms ${a.transitions.easing.easeOut}`,transform:`translateX(-${l*200}px)`},children:o.jsx(c.Slide,{in:s,timeout:ls,direction:"left",children:o.jsx(c.Paper,{variant:"outlined",square:!0,sx:{height:"100%",WebkitOverflowScrolling:"touch",position:"fixed",outline:0,left:"auto",right:0,overflow:"hidden",borderRadius:"16px 0 0 16px"},children:t})})})});function Cd(e,n){const[r,t]=A.useState(),{navigator:i}=A.useContext(fe.UNSAFE_NavigationContext),s=fe.useNavigate(),l=()=>{t(void 0)},a=()=>{n(),t(void 0),s(-1)},d=A.useCallback(({action:u,location:f,retry:h})=>{switch(u){case"REPLACE":{h();return}case"POP":t(f)}},[]);return A.useEffect(()=>{if(!e||r||!("block"in i))return;const u=i.block(f=>{const h={...f,retry(){u(),f.retry()}};d(h)});return u},[i,d,e,r]),{navigationWasBlocked:!!r,handleCancel:l,handleOk:a}}function Bd({open:e,handleOk:n,handleCancel:r,body:t,title:i}){return o.jsxs(Wl,{keepMounted:!1,open:e,onClose:r,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[o.jsx(Yl,{children:i??"Unsaved changes"}),o.jsxs(zl,{children:[t&&o.jsx(Dt,{children:t}),o.jsx(Dt,{children:"Are you sure you want to leave this page?"})]}),o.jsxs(Ze,{children:[o.jsx(Po,{onClick:r,autoFocus:!0,children:" Cancel "}),o.jsx(Po,{onClick:n,children:" Ok "})]})]})}const as=A.createContext({width:"",blocked:!1,setBlocked:e=>{},setBlockedNavigationMessage:e=>{},close:()=>{}}),Pn=()=>A.useContext(as);function cs(){const n=Mo().sidePanels,r=[...n];return r.push(void 0),o.jsx(o.Fragment,{children:r.map((t,i)=>o.jsx(Ed,{panel:t,offsetPosition:n.length-i-1},`side_dialog_${i}`))})}function Ed({offsetPosition:e,panel:n}){const[r,t]=A.useState(!1),[i,s]=A.useState(!1),[l,a]=A.useState(),d=A.useRef(n?.width),u=d.current,f=Mo(),{navigationWasBlocked:h,handleOk:b,handleCancel:p}=Cd(i&&!r,()=>s(!1));A.useEffect(()=>{n&&(d.current=n.width)},[n]);const g=()=>{s(!1),t(!1),f.close(),n?.onClose?.()},v=()=>{t(!1)},w=E=>{i&&!E?t(!0):(f.close(),n?.onClose?.())};return o.jsxs(as.Provider,{value:{blocked:i,setBlocked:s,setBlockedNavigationMessage:a,width:u,close:w},children:[o.jsxs(xd,{open:!!n,onClose:w,offsetPosition:e,children:[n&&o.jsx(c.Box,{sx:E=>({display:"flex",flexDirection:"column",height:"100%",transition:"width 250ms ease-in-out",width:n.width,maxWidth:go,[E.breakpoints.up("lg")]:{maxWidth:"95vw"}}),children:o.jsx(re,{children:n.component})}),!n&&o.jsx("div",{style:{width:u}})]}),o.jsx(Bd,{open:h||r,handleOk:r?g:b,handleCancel:r?v:p,body:l})]})}function md({entityOrEntitiesToDelete:e,collection:n,onClose:r,open:t,callbacks:i,onEntityDelete:s,onMultipleEntitiesDelete:l,path:a,...d}){const u=Fe(),f=_e(),[h,b]=A.useState(!1),[p,g]=A.useState(),[v,w]=A.useState(),E=oe();A.useEffect(()=>{if(e){const P=Array.isArray(e)&&e.length===1?e[0]:e;g(P),w(Array.isArray(P))}},[e]);const x=A.useMemo(()=>ve({collection:n,path:a,fields:E.fields}),[n,a]),m=A.useCallback(()=>{r()},[r]),C=A.useCallback(P=>{console.debug("Deleted",P)},[]),B=A.useCallback((P,Q)=>{f.open({type:"error",message:"Error deleting: "+Q?.message}),console.error("Error deleting entity"),console.error(Q)},[x.name]),S=A.useCallback((P,Q)=>{f.open({type:"error",message:"Error before deleting: "+Q?.message}),console.error(Q)},[x.name]),k=A.useCallback((P,Q)=>{f.open({type:"error",message:"Error after deleting: "+Q?.message}),console.error(Q)},[x.name]),I=A.useCallback(P=>Ht({dataSource:u,entity:P,collection:x,callbacks:i,onDeleteSuccess:C,onDeleteFailure:B,onPreDeleteHookError:S,onDeleteSuccessHookError:k,context:E}),[u,x,i,C,B,S,k,E]),F=A.useCallback(async()=>{p&&(b(!0),v?Promise.all(p.map(I)).then(P=>{b(!1),l&&p&&l(a,p),P.every(Boolean)?f.open({type:"success",message:`${x.name}: multiple deleted`}):P.some(Boolean)?f.open({type:"warning",message:`${x.name}: Some of the entities have been deleted, but not all`}):f.open({type:"error",message:`${x.name}: Error deleting entities`}),r()}):I(p).then(P=>{b(!1),P&&(s&&p&&s(a,p),f.open({type:"success",message:`${x.singularName??x.name} deleted`}),r())}))},[p,v,I,l,a,r,f,x.name,s]);let T;if(p&&v)T=o.jsx("div",{children:"Multiple entities"});else{const P=p;T=P?o.jsx(zr,{entity:P,collection:n,path:a}):o.jsx(o.Fragment,{})}const D=v?`${x.name}: Confirm multiple delete?`:`Would you like to delete this ${x.singularName??x.name}?`;return o.jsxs(c.Dialog,{maxWidth:"md","aria-labelledby":"delete-dialog",open:t,onBackdropClick:r,...d,children:[o.jsx(c.DialogTitle,{id:"delete-dialog-title",children:D}),!v&&o.jsx(c.DialogContent,{dividers:!0,children:T}),o.jsxs(Ze,{children:[h&&o.jsx(c.CircularProgress,{size:16,thickness:8}),o.jsx(c.Button,{onClick:m,disabled:h,color:"primary",children:"Cancel"}),o.jsx(c.Button,{autoFocus:!0,disabled:h,onClick:F,variant:"contained",color:"primary",children:"Ok"})]})]})}function kd(e,n,r,t,i){const s=r.properties,l=Fd(s,t,i),a=Sd(e,n,s,l),d=us(l.map(f=>f.label)),u=a.map(f=>us(f));Id([d,...u],`${r.name}.csv`,"text/csv")}function Sd(e,n,r,t){const i=e.map(s=>({id:s.id,...As(s.values,r)}));return n&&n.forEach((s,l)=>{i[l]={...i[l],...s}}),i&&i.map(s=>t.map(l=>Ye(s,l.key)))}function Fd(e,n,r){const t=[{label:"id",key:"id"},...Object.entries(e).map(([i,s])=>ds(s,i,"")).flat()];return r?.additionalFields&&t.push(...r.additionalFields.map(i=>({label:i.key,key:i.key}))),t}function ds(e,n,r=""){const t=r?`${r}.${n}`:n;return e.dataType==="map"&&e.properties?Object.entries(e.properties).map(([i,s])=>ds(s,i,t)).flat():[{label:t,key:t}]}function Zr(e,n){let r;if(n.dataType==="map"&&n.properties)r=As(e,n.properties);else if(n.dataType==="array")n.of&&Array.isArray(e)?Array.isArray(n.of)?r=n.of.map((t,i)=>Zr(e[i],t)):n.of.dataType==="map"?r=e.map(t=>JSON.stringify(t)):r=e.map(t=>Zr(t,n.of)):r=e;else if(n.dataType==="reference"){const t=e||void 0;r=t?t.pathWithId:null}else n.dataType==="date"?r=e?e.getTime():null:r=e;return r}function As(e,n){const r=Object.entries(n).map(([t,i])=>{const s=e&&e[t],l=Zr(s,i);return l===void 0?{}:{[t]:l}}).reduce((t,i)=>({...t,...i}),{});return{...e,...r}}function us(e){return e.map(n=>n==null?"":'"'+String(n).replaceAll('"','""')+'"').join(",")+`\r
`}function Id(e,n,r){const t=new Blob(e,{type:r}),i=URL.createObjectURL(t),s=document.createElement("a");s.href=i,s.setAttribute("download",n),s.click()}const Xr=200;function Td({collection:e,path:n,exportConfig:r}){const t=oe(),i=Fe(),l=pe().resolveAliasesFrom(n),a=A.useMemo(()=>ve({collection:e,path:l,fields:t.fields}),[e,l]),d=A.useRef(),u=A.useRef(),[f,h]=A.useState(!1),[b,p]=A.useState(),[g,v]=A.useState(!1),[w,E]=A.useState(!1),[x,m]=A.useState(!1),C=A.useCallback(()=>{m(!0)},[m]),B=A.useCallback(()=>{m(!1)},[m]),S=A.useCallback((D,P,Q,K,L)=>{if(!D)throw Error("Trying to perform export without loading data first");kd(D,P,Q,K,L)},[]),k=A.useCallback(async D=>{if(!r?.additionalFields)return;const P=r.additionalFields;return await Promise.all(D.map(async K=>(await Promise.all(P.map(async L=>({[L.key]:await L.builder({entity:K,context:t})})))).reduce((L,z)=>({...L,...z}),{})))},[r?.additionalFields]),I=A.useCallback(async D=>{D.length>=Xr&&v(!0);const P=d.current&&D.length>d.current.length&&w;d.current=D;const Q=await k(D);u.current=Q,p(void 0),P&&(S(D,Q,a,l,r),B())},[a,S,r,k,w,B,l]);A.useEffect(()=>{x&&(h(!0),i.fetchCollection({path:l,collection:a,limit:w?void 0:Xr}).then(I).catch(p).finally(()=>h(!1)))},[a,i,w,x,l,I]);const F=g&&!w,T=A.useCallback(()=>{F?E(!0):(S(d.current,u.current,a,l,r),B())},[F,S,a,l,r,B]);return o.jsxs(o.Fragment,{children:[o.jsx(c.Tooltip,{title:"Export",children:o.jsx(c.IconButton,{color:"primary",onClick:C,children:o.jsx(Vl,{})})}),o.jsxs(c.Dialog,{keepMounted:!1,open:x,onClose:B,children:[o.jsx(c.DialogTitle,{children:"Export data"}),o.jsx(c.DialogContent,{children:o.jsxs(c.DialogContentText,{children:[o.jsx("div",{children:"Download the the content of this table as a CSV"}),o.jsx("br",{}),F&&o.jsxs(c.Alert,{elevation:3,variant:"filled",severity:"warning",children:[o.jsxs("div",{children:["This collections has a large number of documents (more than ",Xr,")."]}),o.jsx("div",{children:"Would you like to proceed?"})]})]})}),o.jsxs(Ze,{children:[f&&o.jsx(c.CircularProgress,{size:16,thickness:8}),o.jsx(c.Button,{color:"primary",onClick:B,children:"Cancel"}),o.jsx(c.Button,{color:"primary",variant:"contained",disabled:f,onClick:T,children:"Download"})]})]})]})}function Dd({collection:e,onNewClick:n,exportable:r,onMultipleDeleteClick:t,selectionEnabled:i,path:s,selectionController:l,loadedEntities:a}){const d=oe(),u=eo(),f=c.useTheme(),h=c.useMediaQuery(f.breakpoints.up("md")),b=l.selectedEntities,p=Sn(e,u,Ne(s),null)&&n&&(h?o.jsxs(c.Button,{id:`add_entity_${s}`,onClick:n,startIcon:o.jsx(Be.Add,{}),size:"large",variant:"contained",color:"primary",children:["Add ",e.singularName??e.name]}):o.jsx(c.Button,{id:`add_entity_${s}`,onClick:n,size:"medium",variant:"contained",color:"primary",children:o.jsx(Be.Add,{})})),g=$r(e,u,Ne(s),null);let v;if(i){const m=h?o.jsxs(c.Button,{disabled:!b?.length||!g,startIcon:o.jsx(Be.Delete,{}),onClick:t,color:"primary",sx:{minWidth:68},children:["(",b?.length,")"]}):o.jsx(c.IconButton,{color:"primary",disabled:!b?.length||!g,onClick:t,children:o.jsx(Be.Delete,{})});v=o.jsx(c.Tooltip,{title:g?"Delete":"You have selected at least one entity you cannot delete",children:o.jsx("span",{children:m})})}const w={path:s,collection:e,selectionController:l,context:d,loadedEntities:a},E=e.Actions?Array.isArray(e.Actions)?o.jsx(o.Fragment,{children:e.Actions.map((m,C)=>o.jsx(m,{...w},`actions_${C}`))}):o.jsx(e.Actions,{...w}):void 0,x=r&&o.jsx(Td,{collection:e,exportConfig:typeof e.exportable=="object"?e.exportable:void 0,path:s});return o.jsxs(o.Fragment,{children:[E,v,x,p]})}function Pd({data:e,entitiesDisplayedFirst:n}){if(!n)return e;const r=new Set(n.map(t=>t.id));return[...n,...e.filter(t=>!r.has(t.id))]}function Md(e,n,r=5e3){const[t,i]=A.useState(e),s=A.useRef(t.length??0),l=A.useRef(!1),a=A.useRef(n),d=!Ae(a.current,n),u=e.length>=s.current||d;return A.useEffect(()=>{const f=()=>{Ae(t,e)||(a.current=n,s.current=e.length,i(e)),l.current=!1};l.current=!0;let h;return u?f():h=setTimeout(f,r),()=>{clearTimeout(h),l.current&&u&&f()}},[e,r,n,u]),u?e:t}const Qd=50;function fs({fullPath:e,collection:n,entitiesDisplayedFirst:r,isFilterCombinationValid:t,lastDeleteTimestamp:i,forceFilter:s}){const{filterCombinations:l,initialFilter:a,initialSort:d,forceFilter:u}=n,f=s??u,h=n.pagination===void 0||!!n.pagination,b=typeof n.pagination=="number"?n.pagination:Qd,[p,g]=A.useState(),[v,w]=A.useState(h?b:void 0),E=A.useCallback((K,L)=>t(K,L,l),[l]),x=A.useMemo(()=>{if(d&&f&&!E(f,d)){console.warn("Initial sort is not compatible with the force filter. Ignoring initial sort");return}return d},[d,f]),[m,C]=A.useState(f??a??void 0),[B,S]=A.useState(x),k=A.useCallback(()=>C(f??void 0),[f]),{data:I,dataLoading:F,noMoreToLoad:T,dataLoadingError:D}=Ut({path:e,collection:n,filterValues:m,sortBy:B,searchString:p,itemCount:v}),P=Pd({data:I,entitiesDisplayedFirst:r});return{data:Md(P,{filterValues:m,sortBy:B,searchString:p,lastDeleteTimestamp:i}),dataLoading:F,noMoreToLoad:T,dataLoadingError:D,filterValues:m,setFilterValues:C,sortBy:B,setSortBy:S,searchString:p,setSearchString:g,clearFilter:k,itemCount:v,setItemCount:w,paginationEnabled:h,pageSize:b,checkFilterCombination:E}}function hs(e,n,r){const t=n?n[0]:void 0,i=n?n[1]:void 0,s=Object.values(e);if(t&&s.map(d=>d[0]).includes("=="))return!1;const l=Object.keys(e),a=l.length;return a===1&&(!t||t===l[0])?!0:!r&&a>1?!1:!!r&&r.filter(d=>!t||t in d).find(d=>Object.entries(e).every(([u,f])=>d[u]!==void 0&&(!i||d[u]===i)))!==void 0}const Kr=A.memo(function({fullPath:n,isSubCollection:r,...t}){const i=He(),s=eo(),l=bo(),a=oe(),d=A.useMemo(()=>{const $=l?.getCollectionConfig(n);return $?$e(t,$):t},[t,n,l?.getCollectionConfig]),u=c.useTheme(),[f,h]=A.useState(void 0),[b,p]=A.useState(void 0),[g,v]=A.useState(0),w=A.useCallback(()=>{const $=f;setTimeout(()=>{$===f&&h(void 0)},2400)},[f]),E=A.useCallback($=>Lr(d,s,Ne(n),$??null)?d.inlineEditing===void 0||d.inlineEditing:!1,[d,s,n]),x=d.exportable===void 0||d.exportable,m=d.selectionEnabled===void 0||d.selectionEnabled,C=!E(),[B,S]=A.useState(null),k=Rr(),I=d.selectionController??k,{selectedEntities:F,toggleEntitySelection:T,isEntitySelected:D,setSelectedEntities:P}=I;A.useEffect(()=>{p(void 0)},[F]);const Q=fs({fullPath:n,collection:d,entitiesDisplayedFirst:[],isFilterCombinationValid:hs,lastDeleteTimestamp:g}),K=A.useCallback($=>(h($),a.onAnalyticsEvent?.("edit_entity_clicked",{path:$.path,entityId:$.id}),i.open({entityId:$.id,path:n,collection:d,updateUrl:!0,onClose:w})),[n,d,i]),L=A.useCallback(()=>{a.onAnalyticsEvent?.("new_entity_click",{path:n}),i.open({path:n,collection:d,updateUrl:!0,onClose:w})},[n,d,i]),z=A.useCallback($=>{a.onAnalyticsEvent?.("single_delete_dialog_open",{path:n}),p($)},[a,n]),H=A.useCallback(()=>{a.onAnalyticsEvent?.("multiple_delete_dialog_open",{path:n}),p(F)},[a,n,F]),J=A.useCallback(($,le)=>{a.onAnalyticsEvent?.("single_entity_deleted",{path:n}),P(ce=>ce.filter(ne=>ne.id!==le.id)),v(Date.now())},[a,n,P]),O=A.useCallback(($,le)=>{a.onAnalyticsEvent?.("multiple_entities_deleted",{path:n}),P([]),p(void 0),v(Date.now())},[P]),G=A.useCallback(($,le)=>{if(l){const ce=l.getCollectionConfig($),ne=$e(ce,le);l.onCollectionModified($,ne)}},[l]),U=A.useCallback(({width:$,key:le})=>{if(!d.properties[le])return;const ce={columnWidth:$},ne={properties:{[le]:ce}};G(n,ne)},[d,G,n]),V=A.useCallback($=>{l&&G(n,{defaultSize:$})},[G,n,l]),W=B!=null,j=A.useMemo(()=>o.jsx(c.Box,{sx:{display:"flex",flexDirection:"row",contain:"content","& > *:not(:last-child)":{[u.breakpoints.down("md")]:{mr:u.spacing(1)},mr:u.spacing(2)}},children:o.jsxs(c.Box,{children:[o.jsx(c.Typography,{variant:"h6",sx:{lineHeight:"1.15",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden",maxWidth:"164px",cursor:d.description?"pointer":"inherit"},onClick:d.description?$=>{S($.currentTarget),$.stopPropagation()}:void 0,children:`${d.name}`}),o.jsx(Od,{fullPath:n,collection:d}),d.description&&o.jsx(c.Popover,{id:"info-dialog",open:W,anchorEl:B,elevation:3,onClose:()=>{S(null)},anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},children:o.jsx(c.Box,{m:2,children:o.jsx(An,{source:d.description})})})]})}),[u,d.description,d.name,n,W,B]),_=Sn(d,s,Ne(n),null),M=A.useCallback($=>{h($),a.onAnalyticsEvent?.("copy_entity_click",{path:$.path,entityId:$.id}),i.open({entityId:$.id,path:n,copy:!0,collection:d,updateUrl:!0,onClose:w})},[i,d,n,w]),N=A.useCallback($=>{h($),a.onAnalyticsEvent?.("entity_click",{path:$.path,entityId:$.id}),i.open({entityId:$.id,path:$.path,collection:d,updateUrl:!0,onClose:w})},[i,d,n,w]),q=A.useCallback(({entity:$,size:le,width:ce,frozen:ne})=>{const R=D($),Xe=$r(d,s,Ne(n),$);return o.jsx(Ur,{entity:$,width:ce,frozen:ne,isSelected:R,selectionEnabled:m,size:le,toggleEntitySelection:T,onEditClicked:N,onCopyClicked:_?M:void 0,onDeleteClicked:Xe?z:void 0,hideId:d?.hideIdFromCollection})},[D,d,s,n,m,T,N,_,M]);return o.jsxs(c.Box,{sx:{overflow:"hidden",height:"100%",width:"100%"},children:[o.jsx(Jr,{fullPath:n,tableController:Q,onSizeChanged:V,onEntityClick:K,onColumnResize:U,tableRowActionsBuilder:q,title:j,selectionController:I,highlightedEntities:f?[f]:[],...d,actions:o.jsx(Dd,{collection:d,exportable:x,onMultipleDeleteClick:H,onNewClick:L,path:n,loadedEntities:Q.data,selectionController:I,selectionEnabled:m}),hoverRow:C,inlineEditing:E()},`collection_table_${n}`),b&&o.jsx(md,{entityOrEntitiesToDelete:b,path:n,collection:d,callbacks:d.callbacks,open:!!b,onEntityDelete:J,onMultipleEntitiesDelete:O,onClose:()=>p(void 0)})]})},Ae);function Rr(){const[e,n]=A.useState([]),r=A.useCallback(i=>{let s;e.map(l=>l.id).includes(i.id)?s=e.filter(l=>l.id!==i.id):s=[...e,i],n(s)},[e]),t=A.useCallback(i=>e.map(s=>s.id).includes(i.id),[e]);return{selectedEntities:e,setSelectedEntities:n,isEntitySelected:t,toggleEntitySelection:r}}function Od({fullPath:e,collection:n}){const r=Fe(),t=pe(),[i,s]=A.useState(void 0),[l,a]=A.useState(void 0);return A.useEffect(()=>{r.countEntities({path:t.resolveAliasesFrom(e),collection:n}).then(s).catch(a)},[e,r,t]),l?null:o.jsx(c.Typography,{sx:{display:"block",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden",maxWidth:"160px",textAlign:"left"},variant:"caption",color:"textSecondary",children:i!==void 0?`${i} entities`:Le()})}function gs({onSingleEntitySelected:e,onMultipleEntitiesSelected:n,multiselect:r,collection:t,path:i,selectedEntityIds:s,description:l,forceFilter:a,maxSelection:d}){const u=Pn(),f=He(),h=pe(),b=oe(),p=h.resolveAliasesFrom(i),g=Fe(),[v,w]=A.useState([]),E=Rr();A.useEffect(()=>{let F=!1;return s&&t?Promise.all(s.map(T=>g.fetchEntity({path:p,entityId:T,collection:t}))).then(T=>{if(!F){const D=T.filter(P=>P!==void 0);E.setSelectedEntities(D),w(D)}}):(E.setSelectedEntities([]),w([])),()=>{F=!0}},[g,p,s,t,E.setSelectedEntities]);const x=A.useCallback(()=>{b.onAnalyticsEvent?.("reference_selection_clear",{path:p}),E.setSelectedEntities([]),!r&&e?e(null):n&&n([])},[r,n,e]),m=A.useCallback(F=>{let T;const D=E.selectedEntities;if(b.onAnalyticsEvent?.("reference_selection_toggle",{path:p,entityId:F.id}),D){if(D.map(P=>P.id).indexOf(F.id)>-1)T=D.filter(P=>P.id!==F.id);else{if(d&&D.length>=d)return;T=[...D,F]}E.setSelectedEntities(T),n&&n(T)}},[n,E.selectedEntities]),C=A.useCallback(F=>{!r&&e?(b.onAnalyticsEvent?.("reference_selected_single",{path:p,entityId:F.id}),e(F),u.close(!1)):m(F)},[u,r,e,m]),B=A.useCallback(()=>{b.onAnalyticsEvent?.("reference_selection_new_entity",{path:p}),f.open({path:p,collection:t,updateUrl:!0,onUpdate:({entity:F})=>{w([F,...v]),C(F)},closeOnSave:!0})},[f,p,t,v,C]),S=A.useCallback(({entity:F,size:T,width:D,frozen:P})=>{const Q=E.selectedEntities,K=Q&&Q.map(L=>L.id).indexOf(F.id)>-1;return o.jsx(Ur,{width:D,frozen:P,entity:F,size:T,isSelected:K,selectionEnabled:r,toggleEntitySelection:m,hideId:t?.hideIdFromCollection})},[r,E.selectedEntities,m,t?.hideIdFromCollection]),k=A.useCallback(F=>{F.stopPropagation(),u.close(!1)},[u]);if(!t)return o.jsx(ue,{error:"Could not find collection with id "+t});const I=fs({fullPath:p,collection:t,entitiesDisplayedFirst:v,isFilterCombinationValid:hs,forceFilter:a});return o.jsxs(c.Box,{sx:{display:"flex",flexDirection:"column",height:"100%"},children:[o.jsx(c.Box,{sx:{flexGrow:1},children:v&&o.jsx(Jr,{fullPath:p,onEntityClick:C,tableController:I,tableRowActionsBuilder:S,title:o.jsx(c.Typography,{variant:"h6",children:t.singularName?`Select ${t.singularName}`:`Select from ${t.name}`}),...t,forceFilter:a,inlineEditing:!1,selectionController:E,actions:o.jsx(Gd,{collection:t,path:p,onNewClick:B,onClear:x})})}),o.jsxs(Ze,{translucent:!1,children:[l&&o.jsx(c.Typography,{variant:"body2",sx:{flexGrow:1,textAlign:"left"},children:l}),o.jsx(c.Button,{onClick:k,color:"primary",variant:"contained",children:"Done"})]})]})}function Gd({collection:e,path:n,onClear:r,onNewClick:t}){const i=eo(),s=c.useTheme(),l=c.useMediaQuery(s.breakpoints.up("md")),a=Sn(e,i,Ne(n),null)&&t&&(l?o.jsxs(c.Button,{onClick:t,startIcon:o.jsx(Be.Add,{}),size:"large",variant:"outlined",color:"primary",children:["Add ",e.singularName??e.name]}):o.jsx(c.Button,{onClick:t,size:"medium",variant:"outlined",color:"primary",children:o.jsx(Be.Add,{})}));return o.jsxs(o.Fragment,{children:[o.jsx(c.Button,{onClick:r,color:"primary",children:"Clear"}),a]})}function et(e){return Array.isArray(e)?e:e?[e]:[]}function Mn({children:e,group:n}){const r=bo();return o.jsx(qe,{invisible:!0,initiallyExpanded:!(r?.collapsedGroups??[]).includes(n??"ungrouped"),onExpandedChange:t=>{if(r)if(t)r.setCollapsedGroups((r.collapsedGroups??[]).filter(i=>i!==(n??"ungrouped")));else{const i=(r.collapsedGroups??[]).concat(n??"ungrouped");r.setCollapsedGroups(i)}},title:o.jsx(c.Typography,{color:"textSecondary",className:"weight-500",sx:{ml:1},children:n?.toUpperCase()??"Ungrouped views".toUpperCase()}),children:o.jsx(c.Box,{mb:2,children:e})})}function ot({view:e,path:n,collection:r,url:t,name:i,description:s,onClick:l}){const a=bo(),d=Fn(r??e),u=fe.useNavigate(),f=oe(),h=(a?.favouritePaths??[]).includes(n);let b;if(f.plugins&&r){const p={path:n,collection:r,context:f};b=o.jsx(o.Fragment,{children:f.plugins.map((g,v)=>g.homePage?.CollectionActions?o.jsx(g.homePage.CollectionActions,{...p,extraProps:g.homePage.extraProps},`actions_${v}`):null)})}return o.jsx(c.Paper,{elevation:0,sx:{height:"100%"},children:o.jsxs(c.CardActionArea,{component:"div",sx:{display:"flex",flexDirection:"column",alignItems:"flex-start",minHeight:248,height:"100%"},onClick:()=>{l?.(),u(t),a&&a.setRecentlyVisitedPaths([n,...(a.recentlyVisitedPaths??[]).filter(p=>p!==n)])},children:[o.jsxs(c.CardContent,{sx:{flexGrow:1,width:"100%"},children:[o.jsxs(c.Box,{sx:{height:40,display:"flex",alignItems:"center",width:"100%",justifyContent:"space-between"},children:[o.jsx(d,{color:"disabled"}),o.jsxs(c.Box,{sx:{display:"flex",alignItems:"center",gap:1},onClick:p=>{p.preventDefault(),p.stopPropagation()},children:[b,a&&o.jsx(c.IconButton,{size:"small",onClick:p=>{p.preventDefault(),p.stopPropagation(),h?a.setFavouritePaths(a.favouritePaths.filter(g=>g!==n)):a.setFavouritePaths([...a.favouritePaths,n])},children:h?o.jsx(Et,{color:"secondary"}):o.jsx(Bt,{color:"disabled"})})]})]}),o.jsx(c.Typography,{gutterBottom:!0,variant:"h5",component:"h2",children:i}),s&&o.jsx(c.Typography,{variant:"body2",color:"textSecondary",component:"div",children:o.jsx(An,{source:s})})]}),o.jsx(c.CardActions,{style:{alignSelf:"flex-end"},children:o.jsx(c.Box,{p:1,children:o.jsx(vl,{color:"primary"})})})]})})}function Ld({entry:e}){const n=fe.useNavigate(),r=bo();if(!r)return null;const t=r.favouritePaths.includes(e.path);return o.jsx(c.Chip,{label:e.name,onClick:()=>n(e.url),onDelete:i=>{i.preventDefault(),i.stopPropagation(),t?r.setFavouritePaths(r.favouritePaths.filter(s=>s!==e.path)):r.setFavouritePaths([...r.favouritePaths,e.path])},deleteIcon:t?o.jsx(Et,{color:"secondary"}):o.jsx(Bt,{color:"disabled"})},e.path)}function $d({hidden:e}){const n=oe(),r=pe(),t=bo();if(!t)return null;const i=(t?.favouritePaths??[]).map(a=>r.topLevelNavigation?.navigationEntries.find(d=>d.path===a)).filter(Boolean),s=(t?.recentlyVisitedPaths??[]).map(a=>r.topLevelNavigation?.navigationEntries.find(d=>d.path===a)).filter(Boolean).slice(0,5),l=o.jsx(c.Collapse,{in:!e&&i.length>0,children:o.jsx(Mn,{group:"Favourites",children:o.jsx(c.Grid,{container:!0,spacing:2,children:i.map(a=>o.jsx(c.Grid,{item:!0,xs:12,sm:6,lg:4,children:o.jsx(ot,{...a,onClick:()=>{const d=a.type==="collection"?"home_favorite_navigate_to_collection":a.type==="view"?"home_favorite_navigate_to_view":"unmapped_event";n.onAnalyticsEvent?.(d,{path:a.path})}})},`nav_${a.group}_${a.name}`))})})});return o.jsxs(c.Box,{children:[o.jsx(c.Box,{sx:{display:"flex",flexDirection:"row",flexWrap:"wrap",gap:1,pb:2},children:s.map(a=>o.jsx(Ld,{entry:a},a.path))}),l]})}function ps(){const e=A.useRef({}),n=fe.useLocation(),r=A.createRef(),[t,i]=A.useState(0),[s,l]=A.useState("down"),a=A.useCallback(()=>{!r.current||!n.key||(e.current[n.key]=r.current.scrollTop,i(r.current.scrollTop),l(r.current.scrollTop>t?"down":"up"))},[r,n.key,t]);return A.useEffect(()=>{const d=r.current;if(d)return d.addEventListener("scroll",a,{passive:!0}),()=>{d&&d.removeEventListener("scroll",a)}},[r,a,n]),A.useEffect(()=>{!r.current||!e.current||!e.current[n.key]||r.current.scrollTo({top:e.current[n.key],behavior:"auto"})},[n]),{containerRef:r,scroll:t,direction:s}}const mo=new Zl.Search("home");mo.addIndex("name"),mo.addIndex("description"),mo.addIndex("group"),mo.addIndex("path");function bs({additionalChildrenStart:e,additionalChildrenEnd:n}){const r=oe(),t=pe();if(!t.topLevelNavigation)throw Error("Navigation not ready in FireCMSHomePage");const{containerRef:i,scroll:s,direction:l}=ps(),{navigationEntries:a,groups:d}=t.topLevelNavigation,[u,f]=A.useState(null),h=u?a.filter(v=>u.includes(v.url)):a;A.useEffect(()=>{mo.addDocuments(h)},[a]);const b=A.useCallback(v=>{f(!v||v===""?null:mo.search(v).map(w=>w.url))},[]),p=[...d];(h.filter(v=>!v.group).length>0||h.length===0)&&p.push(void 0);let g;if(r.plugins){const v={context:r};g=o.jsx(o.Fragment,{children:r.plugins.filter(w=>w.homePage?.includeSection).map((w,E)=>{const x=w.homePage.includeSection(v);return o.jsx(Mn,{group:x.title,children:x.children},`plugin_section_${w.name}`)})})}return o.jsx(c.Box,{ref:i,sx:{py:2,overflow:"auto",height:"100%",width:"100%"},children:o.jsxs(c.Container,{children:[o.jsx(c.Box,{sx:{position:"sticky",py:2,transition:"top 0.4s ease-in-out",top:0,zIndex:10},children:o.jsx(Ki,{onTextSearch:b,placeholder:"Search collections",large:!1})}),o.jsx($d,{hidden:!!u}),e,p.map((v,w)=>{const E=[],x={group:v,context:r};r.plugins&&r.plugins.forEach(C=>{C.homePage?.AdditionalCards&&E.push(...et(C.homePage?.AdditionalCards))});const m=h.filter(C=>C.group===v||!C.group&&v===void 0);return m.length===0&&E.length===0?null:o.jsx(Mn,{group:v,children:o.jsxs(c.Grid,{container:!0,spacing:2,children:[m.map(C=>o.jsx(c.Grid,{item:!0,xs:12,sm:6,lg:4,children:o.jsx(ot,{...C,onClick:()=>{const B=C.type==="collection"?"home_navigate_to_collection":C.type==="view"?"home_navigate_to_view":"unmapped_event";r.onAnalyticsEvent?.(B,{path:C.path})}})},`nav_${C.group}_${C.name}`)),E&&E.map((C,B)=>o.jsx(c.Grid,{item:!0,xs:12,sm:6,lg:4,children:o.jsx(C,{...x})},`nav_${v}_"add_${B}`))]})},`plugin_section_${v}`)}),g,n]})})}function Vd({children:e,title:n,path:r}){const t=dn();return A.useEffect(()=>{t.set({breadcrumbs:[{title:n,url:r}]})},[r,n]),o.jsx(o.Fragment,{children:e})}function vs(){return o.jsx(c.Box,{display:"flex",width:"100%",height:"100%",children:o.jsxs(c.Box,{m:"auto",display:"flex",alignItems:"center",flexDirection:"column",children:[o.jsx(c.Typography,{variant:"h4",align:"center",gutterBottom:!0,children:"Page not found"}),o.jsx(c.Typography,{align:"center",gutterBottom:!0,children:"This page does not exist or you may not have access to it"}),o.jsx(c.Button,{component:fe.Link,to:"/",children:"Back to home"})]})})}function Wd({open:e,onAccept:n,onCancel:r,title:t,loading:i,body:s}){return o.jsxs(c.Dialog,{open:e,onClose:r,children:[o.jsx(c.DialogTitle,{children:t}),s&&o.jsx(c.DialogContent,{children:o.jsx(c.DialogContentText,{children:s})}),o.jsxs(Ze,{children:[o.jsx(c.Button,{onClick:r,autoFocus:!0,children:"Cancel"}),o.jsx(El.LoadingButton,{variant:"contained",color:"primary",type:"submit",loading:i,onClick:n,children:"Ok"})]})]})}function nt({width:e,height:n,style:r}){return o.jsxs("svg",{width:e??"100%",height:n??"100%",viewBox:"0 0 599 599",version:"1.1",style:r,xmlns:"http://www.w3.org/2000/svg",children:[o.jsxs("defs",{children:[o.jsxs("radialGradient",{cx:"28.6213569%",cy:"43.1133328%",fx:"28.6213569%",fy:"43.1133328%",r:"71.5003456%",gradientTransform:"translate(0.286214,0.431133),rotate(3.343450),scale(1.000000,0.996175),translate(-0.286214,-0.431133)",id:"radialGradient-1",children:[o.jsx("stop",{stopColor:"#FF5B79",offset:"0%"}),o.jsx("stop",{stopColor:"#FA5574",offset:"28.0930803%"}),o.jsx("stop",{stopColor:"#EC4C51",offset:"44.7242531%"}),o.jsx("stop",{stopColor:"#9543C1",offset:"71.4578165%"}),o.jsx("stop",{stopColor:"#3857B3",offset:"100%"})]}),o.jsxs("radialGradient",{cx:"53.6205516%",cy:"47.2473036%",fx:"53.6205516%",fy:"47.2473036%",r:"50.8229649%",gradientTransform:"translate(0.536206,0.472473),rotate(90.000000),scale(1.000000,1.206631),translate(-0.536206,-0.472473)",id:"radialGradient-2",children:[o.jsx("stop",{stopColor:"#68294F",stopOpacity:"0",offset:"0%"}),o.jsx("stop",{stopColor:"#5E2548",stopOpacity:"0.04641108",offset:"75.3503173%"}),o.jsx("stop",{stopColor:"#0D060B",stopOpacity:"0.437431709",offset:"100%"})]}),o.jsxs("radialGradient",{cx:"53.8605015%",cy:"48.1990423%",fx:"53.8605015%",fy:"48.1990423%",r:"59.9151549%",gradientTransform:"translate(0.538605,0.481990),rotate(180.000000),scale(1.000000,0.925027),translate(-0.538605,-0.481990)",id:"radialGradient-3",children:[o.jsx("stop",{stopColor:"#68294F",stopOpacity:"0",offset:"0%"}),o.jsx("stop",{stopColor:"#5E2548",stopOpacity:"0.04641108",offset:"84.0867343%"}),o.jsx("stop",{stopColor:"#FF0000",stopOpacity:"0.567324765",offset:"100%"})]})]}),o.jsx("g",{id:"Page-1",stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd",children:o.jsxs("g",{id:"firecms_logo",children:[o.jsx("circle",{fill:"url(#radialGradient-1)",cx:"299.5",cy:"299.5",r:"299.5"}),o.jsx("circle",{fill:"url(#radialGradient-2)",cx:"299.5",cy:"299.5",r:"299.5"}),o.jsx("circle",{fill:"url(#radialGradient-3)",cx:"299.5",cy:"299.5",r:"299.5"})]})})]})}function Qn({children:e,maxWidth:n,fullScreen:r=!1,fadeTimeout:t=800}){return o.jsx(c.Fade,{in:!0,appear:!0,timeout:t,mountOnEnter:!0,unmountOnExit:!0,children:o.jsxs(c.Box,{sx:{display:"flex",flexDirection:"column",alignItems:"center",height:r?"100vh":"100%","@supports (height: 100dvh)":{height:r?"100dvh":"100%"},justifyContent:n?void 0:"center",maxHeight:"100%",gap:2,p:2},children:[n&&o.jsx(c.Box,{sx:{width:"100%",margin:"auto",maxWidth:n},children:e}),!n&&e]})})}function zd({children:e,mode:n="info"}){const r=c.useTheme(),t=n==="info"?r.palette.mode==="dark"?"#193c47":"#b9f4fe":r.palette.mode==="dark"?"#4d3800":"#f9e3b9";return o.jsx(c.Box,{sx:i=>({my:3,py:1,px:2,borderRadius:1,background:t}),children:e})}function ys({hovered:e,drawerOpen:n,closeDrawer:r}){const t=oe(),i=pe(),s=e&&!n;if(!i.topLevelNavigation)throw Error("Navigation not ready in Drawer");const{navigationEntries:l,groups:a}=i.topLevelNavigation,d=Object.values(l).filter(h=>!h.group),u=A.useCallback(h=>n?o.jsx(c.Box,{pt:2,pl:2,pr:2,pb:.5,sx:{display:"flex",flexDirection:"row",alignItems:"center"},children:o.jsx(c.Typography,{variant:"caption",color:"textSecondary",className:"weight-500",sx:{flexGrow:1},children:h?h.toUpperCase():"Ungrouped views".toUpperCase()})}):o.jsx(c.Box,{sx:{height:16}}),[n]),f=h=>{const b=h.type==="collection"?"drawer_navigate_to_collection":h.type==="view"?"drawer_navigate_to_view":"unmapped_event";t.onAnalyticsEvent?.(b,{url:h.url})};return o.jsxs(c.List,{children:[a.map(h=>o.jsxs(A.Fragment,{children:[u(h),Object.values(l).filter(b=>b.group===h).map((b,p)=>o.jsx(rt,{Icon:Fn(b.collection??b.view),tooltipsOpen:s,drawerOpen:n,onClick:()=>f(b),url:b.url,name:b.name},`navigation_${p}`))]},`drawer_group_${h}`)),d.length>0&&u(),d.map((h,b)=>o.jsx(rt,{Icon:Fn(h.collection??h.view),tooltipsOpen:s,onClick:()=>f(h),drawerOpen:n,url:h.url,name:h.name},`navigation_${b}`))]})}function rt({name:e,Icon:n,drawerOpen:r,tooltipsOpen:t,url:i,onClick:s}){const l=c.useTheme(),a=o.jsx(n,{fontSize:"medium",sx:u=>({color:u.palette.mode==="dark"?on.grey[500]:on.grey[700]})}),d=o.jsxs(c.ListItem,{button:!0,component:fe.NavLink,onClick:s,style:({isActive:u})=>({fontWeight:u?"600":"500",background:u?l.palette.mode==="light"?c.darken(l.palette.background.default,.1):c.lighten(l.palette.background.default,.08):"inherit",minHeight:"48px",borderRadius:"0 16px 16px 0"}),sx:u=>({pl:3,alignItems:"center"}),to:i,children:[a,o.jsx(c.Typography,{variant:"subtitle2",sx:{opacity:r?1:0,fontWeight:"inherit",ml:3,p:.5},children:e.toUpperCase()})]});return r?d:o.jsx(c.Tooltip,{open:t,placement:"right",title:e,children:d})}const Ho=280,ws=A.memo(function(n){const{children:r,name:t,logo:i,toolbarExtraWidget:s,Drawer:l,autoOpenDrawer:a,FireCMSAppBarComponent:d=Bs}=n,u=c.useTheme(),f=c.useMediaQuery(u.breakpoints.up("md")),h=pe(),{containerRef:b}=ps(),[p,g]=A.useState(!1),[v,w]=A.useState(!1),E=A.useCallback(()=>w(!0),[]),x=A.useCallback(()=>w(!1),[]),m=l||ys,C=A.useCallback(()=>{g(!1)},[]),B=p||!!(f&&a&&v);return o.jsxs(c.Box,{sx:{display:"flex",height:"100vh","@supports (height: 100dvh)":{height:"100dvh"},width:"100vw",pt:"env(safe-area-inset-top)",pl:"env(safe-area-inset-left)",pr:"env(safe-area-inset-right)",pb:"env(safe-area-inset-bottom)"},children:[o.jsx(d,{title:t,drawerOpen:B,toolbarExtraWidget:s}),o.jsx(Nd,{onMouseEnter:E,onMouseMove:E,onMouseLeave:x,open:B,logo:i,hovered:a?v:!1,setDrawerOpen:g,children:o.jsx("nav",{children:h.loading?o.jsx(lo,{}):o.jsx(m,{hovered:v,drawerOpen:B,closeDrawer:C})})}),o.jsxs(c.Box,{component:"main",sx:{display:"flex",flexDirection:"column",flexGrow:1,width:"100%",height:"100%",overflow:"auto"},children:[o.jsx(Yd,{}),o.jsx(c.Box,{ref:b,sx:{flexGrow:1,m:f?2:0,mt:f?0:1,borderRadius:f?"12px":void 0,border:f?`1px solid ${u.palette.divider}`:void 0,height:"100%",overflow:"auto"},children:o.jsx(re,{children:r})})]})]})},Ae),Yd=be.styled("div")(({theme:e})=>({display:"flex",flexDirection:"column",...e.mixins.toolbar}));function Nd(e){const n=oe(),r=c.useTheme(),t=c.useMediaQuery(r.breakpoints.up("md")),{open:i,logo:s,setDrawerOpen:l,hovered:a,...d}=e;let u;s?u=o.jsx("img",{style:{maxWidth:"100%",maxHeight:"100%"},src:s,alt:"Logo"}):u=o.jsx(nt,{});const f=o.jsx(Tt,{color:"inherit","aria-label":"Open drawer",edge:"start",onClick:()=>l(!0),size:"large",sx:{position:"absolute",top:8,left:24},children:o.jsx(Pl,{})});return o.jsxs(o.Fragment,{children:[!t&&f,o.jsxs(c.Drawer,{...d,variant:t?"permanent":"temporary",open:i,onClose:t?void 0:()=>{l(!1)},sx:{width:Ho,flexShrink:0,height:"100%",whiteSpace:"nowrap",boxSizing:"border-box",border:"none",...i&&{...xs(r),"& .MuiDrawer-paper":xs(r)},...!i&&{...Cs(r,t),"& .MuiDrawer-paper":Cs(r,t)}},children:[o.jsx(Tt,{onClick:()=>l(!1),sx:{position:"absolute",right:16,top:16,opacity:i?1:0,transition:r.transitions.create("opacity",{easing:r.transitions.easing.sharp,duration:r.transitions.duration.enteringScreen})},children:r.direction==="rtl"?o.jsx(Ql,{}):o.jsx(Ml,{})}),o.jsx(c.Toolbar,{sx:{position:"absolute",left:i?"-100%":0,right:i?void 0:0,opacity:i?0:1,backgroundColor:r.palette.background.default,transition:r.transitions.create(["left","opacity"],{easing:r.transitions.easing.sharp,duration:r.transitions.duration.enteringScreen})},children:i?f:o.jsx(c.Tooltip,{title:"Open menu",placement:"right",children:f})}),o.jsxs(c.Box,{sx:{height:"100%",width:"100%",overflow:"auto"},children:[o.jsx(c.Link,{color:"inherit",component:fe.NavLink,to:".",sx:h=>({display:"block",transition:h.transitions.create(["padding"],{easing:h.transitions.easing.sharp,duration:h.transitions.duration.enteringScreen}),p:h.spacing(i?4:9,i?12:2,0,i?3:2)}),children:o.jsx(c.Tooltip,{title:"Home",placement:"right",children:o.jsx("div",{onClick:()=>{n.onAnalyticsEvent?.("drawer_navigate_to_home")},children:u})})},"breadcrumb-home"),e.children]}),o.jsxs(c.Link,{sx:h=>({width:Ho,position:"fixed",bottom:0,left:i?0:"-100%",opacity:i?1:0,transition:h.transitions.create(["left","opacity"],{easing:h.transitions.easing.sharp,duration:h.transitions.duration.enteringScreen}),px:"24px",py:1,display:"flex",alignItems:"center",fontWeight:h.typography.fontWeightMedium,background:h.palette.mode==="light"?"rgba(255,255,255,0.6)":c.alpha(h.palette.background.paper,.1),backdropFilter:"blur(8px)"}),href:"https://firecms.co?utm_source=drawer",onMouseDown:h=>{h.preventDefault()},target:"_blank",children:[o.jsx(To,{style:{marginRight:"24px"},fontSize:"small"}),"firecms.co"]})]})]})}const xs=e=>({willChange:"width",pb:"32px",width:Ho,border:"none",transition:e.transitions.create("width",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.enteringScreen}),backgroundColor:e.palette.background.default,overflowX:"hidden"}),Cs=(e,n)=>({willChange:"width",transition:e.transitions.create("width",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen}),border:"none",overflowX:"hidden",backgroundColor:e.palette.background.default,width:n?`calc(${e.spacing(9)})`:"0px"}),Bs=function({title:n,toolbarExtraWidget:r,drawerOpen:t}){const i=dn(),{breadcrumbs:s}=i,l=eo(),{mode:a,toggleMode:d}=cn(),u=c.useTheme(),f=c.useMediaQuery(u.breakpoints.up("md")),h=l.user?.displayName?l.user.displayName[0].toUpperCase():l.user?.email?l.user.email[0].toUpperCase():"A";return o.jsx(c.Box,{sx:{position:"fixed",marginLeft:u.spacing(8),width:`calc(100% - ${u.spacing(8)})`,zIndex:f?u.zIndex.drawer+1:void 0,transition:u.transitions.create(["width","margin"],{easing:u.transitions.easing.sharp,duration:u.transitions.duration.leavingScreen}),...t&&f&&{marginLeft:`calc(${Ho}px - 8px)`,width:`calc(100% - ${Ho}px)`,transition:u.transitions.create(["width","margin"],{easing:u.transitions.easing.sharp,duration:u.transitions.duration.enteringScreen})}},children:o.jsx(c.Slide,{direction:"down",in:!0,mountOnEnter:!0,unmountOnExit:!0,children:o.jsxs(c.Toolbar,{sx:{gap:1},children:[o.jsx(c.Hidden,{lgDown:!0,children:o.jsx(c.Box,{mr:2,children:o.jsx(c.Link,{underline:"none",color:"inherit",component:fe.Link,to:".",children:o.jsx(c.Typography,{variant:"h6",noWrap:!0,className:"weight-500",children:n})},"breadcrumb-home")})}),f&&o.jsx(c.Box,{children:o.jsx(c.Breadcrumbs,{separator:o.jsx(Sl,{htmlColor:"rgb(0,0,0,0.87)",fontSize:"small"}),"aria-label":"breadcrumb",children:s.map((b,p)=>o.jsx(c.Link,{underline:"none",color:"inherit",component:fe.Link,to:b.url,children:o.jsx(c.Chip,{sx:g=>({backgroundColor:g.palette.grey[200],height:g.spacing(3),color:g.palette.grey[800],fontWeight:g.typography.fontWeightMedium,"&:hover, &:focus":{cursor:"pointer",backgroundColor:g.palette.grey[300]},"&:active":{boxShadow:g.shadows[1],backgroundColor:g.palette.grey[400]}}),label:b.title})},`breadcrumb-${p}`))})}),o.jsx(c.Box,{flexGrow:1}),r&&o.jsx(re,{children:r}),o.jsx(c.Box,{p:1,children:o.jsx(c.IconButton,{color:"inherit","aria-label":"Open drawer",edge:"start",onClick:()=>d(),size:"large",children:a==="dark"?o.jsx(kl,{}):o.jsx(ml,{})})}),o.jsx(c.Box,{p:1,children:l.user&&l.user.photoURL?o.jsx(c.Avatar,{src:l.user.photoURL}):o.jsx(c.Avatar,{children:h})}),o.jsx(c.Button,{variant:"text",color:"inherit",onClick:l.signOut,children:"Log Out"})]})})})},Ud=e=>e&&Array.isArray(e)&&e.length>0?e.map((n,r)=>n?{[ur(n)+r]:_o()}:{}).reduce((n,r)=>({...n,...r}),{}):{};function tt({droppableId:e,addLabel:n,value:r,disabled:t=!1,buildEntry:i,small:s,onInternalIdAdded:l,includeAddButton:a,newDefaultEntry:d,onValueChange:u}){const f=r&&Array.isArray(r)&&r.length>0,h=A.useRef(Ud(r)),[b,p]=A.useState(f?Object.values(h.current):[]);A.useEffect(()=>{if(f&&r&&r.length!==b.length){const x=r.map((m,C)=>{const B=ur(m)+C;if(B in h.current)return h.current[B];{const S=_o();return h.current[B]=S,S}});p(x)}},[f,b.length,r]);const g=()=>{if(t)return;const x=_o(),m=[...b,x];l&&l(x),p(m),u([...r??[],d])},v=x=>{const m=[...b];m.splice(x,1),p(m),u(r.filter((C,B)=>B!==x))},w=x=>{const m=_o(),C=r[x],B=[...b.splice(0,x+1),m,...b.splice(x+1,b.length-x-1)];l&&l(m),p(B),u([...r.slice(0,x+1),C,...r.slice(x+1)])},E=x=>{if(!x.destination)return;const m=x.source.index,C=x.destination.index,B=[...b],S=B[m];B[m]=B[C],B[C]=S,p(B),u(Hd(r,m,C))};return o.jsx(fo.DragDropContext,{onDragEnd:E,children:o.jsx(fo.Droppable,{droppableId:e,renderClone:(x,m,C)=>{const B=C.source.index,S=b[B];return o.jsx(it,{provided:x,internalId:S,index:B,small:s,disabled:t,buildEntry:i,remove:v,copy:w,isDragging:m.isDragging})},children:(x,m)=>o.jsxs("div",{...x.droppableProps,ref:x.innerRef,children:[f&&b.map((C,B)=>o.jsx(fo.Draggable,{draggableId:`array_field_${C}`,isDragDisabled:t,index:B,children:(S,k)=>o.jsx(it,{provided:S,internalId:C,index:B,small:s,disabled:t,buildEntry:i,remove:v,copy:w,isDragging:k.isDragging})},`array_field_${C}`)),x.placeholder,a&&o.jsx(c.Box,{p:1,justifyContent:"center",textAlign:"left",children:o.jsx(c.Button,{variant:s?"text":"outlined",size:s?"small":"large",color:"primary",disabled:t,startIcon:o.jsx(Ft,{}),onClick:g,children:n??"Add"})})]})})})}function it({provided:e,index:n,internalId:r,small:t,disabled:i,buildEntry:s,remove:l,copy:a,isDragging:d}){const[u,f]=Un(),h=!t&&f.height>0&&f.height<100,[b,p]=A.useState(!1),g=A.useCallback(()=>p(!0),[]),v=A.useCallback(()=>p(!1),[]);return o.jsx(c.Box,{onMouseEnter:g,onMouseMove:g,onMouseLeave:v,ref:e.innerRef,...e.draggableProps,style:e.draggableProps.style,sx:w=>({backgroundColor:d||b?ri(w):void 0,marginBottom:1,borderRadius:`${w.shape.borderRadius}px`,opacity:1}),children:o.jsxs(c.Box,{display:"flex",alignItems:"start",children:[o.jsx(c.Box,{ref:u,flexGrow:1,width:"calc(100% - 48px)",children:s(n,r)}),o.jsx(Es,{direction:t?"row":"column",disabled:i,remove:l,index:n,provided:e,contentOverflow:h,copy:a})]})})}function Es({direction:e,disabled:n,remove:r,index:t,provided:i,copy:s,contentOverflow:l}){const[a,d]=A.useState(null),u=h=>{d(h.currentTarget),h.stopPropagation()},f=()=>{d(null)};return o.jsxs(c.Box,{display:"flex",flexDirection:e==="row"?"row-reverse":"column",sx:{pl:1,pt:1},alignItems:"center",children:[o.jsx("div",{...i.dragHandleProps,children:o.jsx(c.Tooltip,{placement:e==="column"?"left":void 0,title:"Move",children:o.jsx(c.IconButton,{size:"small",disabled:n,sx:{cursor:n?"inherit":"move"},children:o.jsx(Fl,{fontSize:"small",color:n?"disabled":"inherit"})})})}),!l&&o.jsxs(o.Fragment,{children:[o.jsx(c.Tooltip,{title:"Remove",placement:e==="column"?"left":void 0,children:o.jsx(c.IconButton,{size:"small","aria-label":"remove",disabled:n,onClick:()=>r(t),children:o.jsx(en,{fontSize:"small"})})}),o.jsx(c.Tooltip,{placement:e==="column"?"left":void 0,title:"Copy in this position",children:o.jsx(c.IconButton,{size:"small","aria-label":"copy",disabled:n,onClick:()=>s(t),children:o.jsx(Yn,{fontSize:"small"})})})]}),l&&o.jsxs(o.Fragment,{children:[o.jsx(c.IconButton,{onClick:u,size:"small",children:o.jsx(Be.MoreVert,{})}),o.jsxs(c.Menu,{anchorEl:a,open:!!a,onClose:f,elevation:3,children:[o.jsxs(c.MenuItem,{dense:!0,onClick:()=>r(t),children:[o.jsx(c.ListItemIcon,{children:o.jsx(en,{})}),o.jsx(c.ListItemText,{primary:"Remove"})]}),o.jsxs(c.MenuItem,{dense:!0,onClick:()=>s(t),children:[o.jsx(c.ListItemIcon,{children:o.jsx(Yn,{})}),o.jsx(c.ListItemText,{primary:"Copy"})]})]})]})]})}function Hd(e,n,r){const t=Array.from(e),[i]=t.splice(n,1);return t.splice(r,0,i),t}function _o(){return Math.floor(Math.random()*Math.floor(Number.MAX_SAFE_INTEGER))}function _d(){const e=c.useTheme();return c.useMediaQuery(e.breakpoints.up("xl"))}function jd({path:e,entityId:n,selectedSubPath:r,copy:t,collection:i,onValuesAreModified:s,formWidth:l,onUpdate:a,onClose:d}){i.customId&&i.formAutoSave&&console.warn(`The collection ${i.path} has customId and formAutoSave enabled. This is not supported and formAutoSave will be ignored`);const[u,f]=A.useState(!1),[h,b]=A.useState(void 0);wn(h,()=>{h&&jo({entityId:M?.id,collection:i,path:e,values:h,closeAfterSave:!1})},!1,2e3);const p=c.useTheme(),g=_d(),v=A.useRef(!g),w=typeof l=="number"?`${l}px`:l??ln,E=Fe(),x=Pn(),m=He(),C=_e(),B=oe(),S=eo(),[k,I]=A.useState(void 0),[F,T]=A.useState(t?"copy":n?"existing":"new"),D=A.useRef(void 0),P=D.current,Q=(i.subcollections??[]).filter(Y=>!Y.hideFromNavigation),K=Q?.length??0,L=i.views,z=L?.length??0,H=i.formAutoSave&&!i.customId,J=Y=>{if(L){const ie=L.map(de=>de.path).findIndex(de=>de===Y);if(ie!==-1)return ie}if(Q){const ie=Q.map(de=>de.path).findIndex(de=>de===Y);if(ie!==-1)return ie+z}return-1},O=z>0||K>0,G=r??yr(i?i.defaultSelectedView:void 0,{status:F,entityId:n}),U=A.useRef(G?J(G):-1),V=U.current===-1||g,{entity:W,dataLoading:j,dataLoadingError:_}=an({path:e,entityId:n,collection:i,useCache:!1}),[M,N]=A.useState(W),[q,$]=A.useState(void 0);A.useEffect(()=>{W&&N(W)},[W]),A.useEffect(()=>{if(F==="new")$(!1);else{const Y=M?Lr(i,S,Ne(e),M??null):!1;M&&$(!Y)}},[S,M,F]),A.useEffect(()=>{v.current!==g&&(r!==G&&m.replace({path:e,entityId:n,selectedSubPath:G,updateUrl:!0,collection:i}),v.current=g)},[G,g,r]);const le=A.useCallback(Y=>{f(!1),C.open({type:"error",message:"Error before saving: "+Y?.message}),console.error(Y)},[C]),ce=A.useCallback(Y=>{f(!1),C.open({type:"error",message:"Error after saving (entity is saved): "+Y?.message}),console.error(Y)},[C]),ne=Y=>{if(Y!==-1){if(L&&Y<z)return L[Y].path;if(Q)return Q[Y-z].path;throw Error("Something is wrong in getSelectedSubPath")}},R=(Y,ie)=>{f(!1),H||C.open({type:"success",message:`${i.singularName??i.name}: Saved correctly`}),N(Y),T("existing"),s(!1),a&&a({entity:Y}),ie?(x.setBlocked(!1),x.close(!0),d?.()):F!=="existing"&&m.replace({path:e,entityId:Y.id,selectedSubPath:ne(U.current),updateUrl:!0,collection:i})},Xe=A.useCallback(Y=>{f(!1),C.open({type:"error",message:"Error saving: "+Y?.message}),console.error("Error saving entity",e,n),console.error(Y)},[n,e,C]),jo=({values:Y,previousValues:ie,closeAfterSave:de,entityId:uo,collection:Jo,path:Zo})=>{f(!0),er({path:Zo,entityId:uo,values:Y,previousValues:ie,collection:Jo,status:F,dataSource:E,context:B,onSaveSuccess:Xo=>R(Xo,de),onSaveFailure:Xe,onPreSaveHookError:le,onSaveSuccessHookError:ce}).then()},co=async({collection:Y,path:ie,entityId:de,values:uo,previousValues:Jo,closeAfterSave:Zo,autoSave:Xo})=>{F&&(Xo?b(uo):jo({collection:Y,path:ie,entityId:de,values:uo,previousValues:Jo,closeAfterSave:Zo}))},So=L&&L.map((Y,ie)=>{if(U.current!==ie)return null;Y.builder&&console.warn("customView.builder is deprecated, use customView.Builder instead",Y);const de=Y.Builder??Y.builder;return de?o.jsx(c.Box,{sx:{width:sn,height:"100%",overflow:"auto",borderLeft:`1px solid ${p.palette.divider}`,[p.breakpoints.down("lg")]:{borderLeft:"inherit",width:go}},role:"tabpanel",flexGrow:1,children:o.jsx(re,{children:k&&o.jsx(de,{collection:i,entity:M,modifiedValues:P??M?.values,formContext:k})})},`custom_view_${Y.path}`):(console.error("customView.Builder is not defined"),null)}).filter(Boolean),Fo=j&&!M||(!M||q===void 0)&&(F==="existing"||F==="copy"),Ke=Fo||u,lt=Q&&Q.map((Y,ie)=>{const de=M?`${e}/${M?.id}/${ge(Y.alias??Y.path)}`:void 0;return U.current!==ie+z?null:o.jsxs(c.Box,{sx:{width:sn,height:"100%",overflow:"auto",borderLeft:`1px solid ${p.palette.divider}`,[p.breakpoints.down("lg")]:{borderLeft:"inherit",width:go}},role:"tabpanel",flexGrow:1,children:[Ke&&o.jsx(lo,{}),!Fo&&(M&&de?o.jsx(Kr,{fullPath:de,isSubCollection:!0,...Y}):o.jsx(c.Box,{sx:{width:"100%",height:"100%",p:3},display:"flex",alignItems:"center",justifyContent:"center",children:o.jsx(c.Typography,{variant:"label",children:"You need to save your entity before adding additional collections"})}))]},`subcol_${Y.alias??Y.path}`)}).filter(Boolean),Ln=A.useCallback(()=>{s(!1)},[]),$n=Y=>{U.current=Y,m.replace({path:e,entityId:n,selectedSubPath:ne(Y),updateUrl:!0,collection:i})},Vn=A.useCallback(Y=>{D.current=Y},[]),at=A.useCallback(Y=>{C.open({type:"error",message:"Error updating id, check the console"})},[]),ct=A.useCallback(Y=>{N(ie=>ie?{...ie,id:Y}:void 0)},[]),Ao=Y=>{H||s(Y)};function dt(){const Y=B.plugins;let ie=o.jsx(Yi,{status:F,path:e,collection:i,onEntitySaveRequested:co,onDiscard:Ln,onValuesChanged:Vn,onModified:Ao,entity:M,onIdChange:ct,onFormContextChange:I,hideId:i.hideIdFromForm,autoSave:H,onIdUpdateError:at});return Y&&Y.forEach(de=>{de.form?.provider&&(ie=o.jsx(de.form.provider.Component,{status:F,path:e,collection:i,onDiscard:Ln,onValuesChanged:Vn,onModified:Ao,entity:M,context:B,formContext:k,...de.form.provider.props,children:ie}))}),o.jsx(re,{children:ie})}const At=q===void 0?o.jsx(o.Fragment,{}):q?o.jsx(zr,{entity:M,path:e,collection:i}):dt(),ut=Q&&Q.map(Y=>o.jsx(c.Tab,{sx:{fontSize:"0.875rem",minWidth:"140px"},wrapped:!0,label:Y.name},`entity_detail_collection_tab_${Y.name}`)),Wn=L&&L.map(Y=>o.jsx(c.Tab,{sx:{fontSize:"0.875rem",minWidth:"140px"},wrapped:!0,label:Y.name},`entity_detail_custom_tab_${Y.name}`)),qo=o.jsxs(c.Box,{sx:{paddingLeft:2,paddingRight:2,paddingTop:1,display:"flex",alignItems:"end",backgroundColor:p.palette.mode==="light"?p.palette.background.default:p.palette.background.paper},children:[o.jsx(c.Box,{sx:{pb:1,alignSelf:"center"},children:o.jsx(c.IconButton,{onClick:()=>(d?.(),x.close(!1)),size:"large",children:o.jsx(Xs,{})})}),o.jsx(c.Box,{flexGrow:1}),Fo&&o.jsx(c.Box,{sx:{alignSelf:"center"},children:o.jsx(c.CircularProgress,{size:16,thickness:8})}),o.jsxs(c.Tabs,{value:U.current+1,indicatorColor:"secondary",textColor:"inherit",onChange:(Y,ie)=>{$n(ie-1)},sx:{paddingLeft:p.spacing(1),paddingRight:p.spacing(1),paddingTop:p.spacing(0)},variant:"scrollable",scrollButtons:"auto",children:[o.jsx(c.Tab,{label:i.singularName??i.name,disabled:!O,onClick:()=>{$n(-1)},sx:{display:O?void 0:"none",fontSize:"0.875rem",minWidth:"140px"},wrapped:!0}),Wn,ut]})]});return o.jsx(c.Box,{sx:{display:"flex",flexDirection:"column",height:"100%",width:"100%",transition:"width 250ms ease-in-out"},children:o.jsxs(o.Fragment,{children:[qo,o.jsx(c.Divider,{}),o.jsxs(c.Box,{sx:{flexGrow:1,height:"100%",width:`calc(${sn} + ${w})`,maxWidth:"100%",[`@media (max-width: ${w})`]:{width:w},display:"flex",overflow:"auto",flexDirection:"row"},children:[o.jsx(c.Box,{sx:{position:"relative",maxWidth:"100%"},children:o.jsx(c.Box,{role:"tabpanel",hidden:!V,id:`form_${e}`,sx:{width:w,maxWidth:"100%",height:"100%",overflow:"auto",[p.breakpoints.down("sm")]:{maxWidth:go,width:go}},children:Fo?o.jsx(lo,{}):At})}),So,lt]})]})})}function qd(e){const{blocked:n,setBlocked:r,setBlockedNavigationMessage:t}=Pn(),i=pe(),s=A.useMemo(()=>{if(!e)return;let a=e.collection;if(!a&&(a=i.getCollection(e.path,e.entityId),!a))throw console.error("ERROR: No collection found in path `",e.path,"`. Entity id: ",e.entityId),Error("ERROR: No collection found in path `"+e.path+"`. Make sure you have defined a collection for this path in the root navigation.");return a},[i,e]);A.useEffect(()=>{function a(d){n&&s&&(d.preventDefault(),d.returnValue=`You have unsaved changes in this ${s.name}. Are you sure you want to leave this page?`)}return typeof window<"u"&&window.addEventListener("beforeunload",a),()=>{typeof window<"u"&&window.removeEventListener("beforeunload",a)}},[n,s]);const l=A.useCallback(a=>{r(a),t(a?o.jsxs(o.Fragment,{children:[" You have unsaved changes in this ",o.jsx("b",{children:s?.name}),"."]}):void 0)},[s?.name,r,t]);return!e||!s?o.jsx("div",{style:{width:ln}}):o.jsx(o.Fragment,{children:o.jsx(re,{children:o.jsx(jd,{...e,formWidth:e.width,collection:s,onValuesAreModified:l})})})}const ms="new";function Jd(e,n){if(n)return go;const r=!e.selectedSubPath,t=typeof e.width=="number"?`${e.width}px`:e.width;return r?t??ln:`calc(${sn} + ${t??ln})`}const Zd=(e,n)=>{const r=fe.useLocation(),t=A.useRef(!1),i=c.useTheme(),s=c.useMediaQuery(i.breakpoints.down("sm"));A.useEffect(()=>{if(!e.loading&&!t.current){if(e.isUrlCollectionPath(r.pathname)){const u=r.hash===`#${ms}`,f=e.urlPathToDataPath(r.pathname),h=Xd(f,e.collections,u);n.replace(h.map(b=>st(b,e,s)))}t.current=!0}},[r,e,n,s]);const l=A.useCallback(()=>{n.close()},[n]),a=A.useCallback(u=>{if(u.copy&&!u.entityId)throw Error("If you want to copy an entity you need to provide an entityId");const f=yr(u.collection?u.collection.defaultSelectedView:void 0,{status:u.copy?"copy":u.entityId?"existing":"new",entityId:u.entityId});n.open(st({selectedSubPath:f,...u},e,s))},[n,e,s]),d=A.useCallback(u=>{if(u.copy&&!u.entityId)throw Error("If you want to copy an entity you need to provide an entityId");n.replace(st(u,e,s))},[e,n,s]);return{close:l,open:a,replace:d}};function Xd(e,n,r){const t=Xn({path:e,collections:n}),i=[];let s="";for(let l=0;l<t.length;l++){const a=t[l];if(a.type==="collection"&&(s=a.path),l>0){const d=t[l-1];if(a.type==="entity")i.push({path:a.path,entityId:a.entityId,copy:!1});else if(a.type==="custom_view"){if(d.type==="entity"){const u=i[i.length-1];u&&(u.selectedSubPath=a.view.path)}}else if(a.type==="collection"&&d.type==="entity"){const u=i[i.length-1];u&&(u.selectedSubPath=a.collection.alias??a.collection.path)}}}return r&&i.push({path:s,copy:!1}),i}const st=(e,n,r)=>{const t=ge(e.path),i=e.entityId?n.buildUrlCollectionPath(`${t}/${e.entityId}/${e.selectedSubPath||""}`):n.buildUrlCollectionPath(`${t}#${ms}`);return{key:`${e.path}/${e.entityId}`,component:o.jsx(qd,{...e}),urlPath:i,parentUrlPath:n.buildUrlCollectionPath(t),width:Jd(e,r),onClose:e.onClose}};function ks(e){const{path:n,collections:r=[],currentFullPath:t}=e,i=ge(n).split("/"),s=tn(i),l=[];for(let a=0;a<s.length;a++){const d=s[a],u=r&&r.find(f=>f.alias===d||f.path===d);if(u){const f=u.alias??u.path,h=t&&t.length>0?t+"/"+f:f,b=ge(ge(n).replace(d,"")),p=b.length>0?b.split("/"):[];if(p.length>0){const g=p[0],v=h+"/"+g;if(l.push(new Pe(g,h)),p.length>1){const w=p.slice(1).join("/");if(!u)throw Error("collection not found resolving path: "+u);u.subcollections&&l.push(...ks({path:w,collections:u.subcollections,currentFullPath:v}))}}break}}return l}function Kd({basePath:e,baseCollectionPath:n,authController:r,collections:t,views:i,collectionOverrideHandler:s,userConfigPersistence:l,plugins:a,dataSource:d}){const u=fe.useLocation(),[f,h]=A.useState(),[b,p]=A.useState(),[g,v]=A.useState(!1),[w,E]=A.useState(void 0),[x,m]=A.useState(!0),[C,B]=A.useState(void 0),S=ge(e),k=ge(n),I=S?`/${S}`:"/",F=S?`/${S}/${k}`:`/${k}`,T=A.useCallback(V=>S?`/${S}/${On(V)}`:`/${On(V)}`,[S]),D=A.useCallback(V=>`${ge(n)}/${On(V)}`,[n]),P=A.useCallback((V,W)=>{const j=[...(V??[]).map(M=>M.hideFromNavigation?void 0:{url:D(M.alias??M.path),type:"collection",name:M.name.trim(),path:M.alias??M.path,collection:M,description:M.description?.trim(),group:M.group?.trim()}).filter(Boolean),...(W??[]).map(M=>M.hideFromNavigation?void 0:{url:T(Array.isArray(M.path)?M.path[0]:M.path),name:M.name.trim(),type:"view",view:M,description:M.description?.trim(),group:M.group?.trim()}).filter(Boolean)],_=Object.values(j).map(M=>M.group).filter(Boolean).filter((M,N,q)=>q.indexOf(M)===N);return{navigationEntries:j,groups:_}},[T,D]),Q=A.useCallback(async()=>{if(!r.initialLoading){try{const[V=[],W=[]]=await Promise.all([Rd(t,r,d,a),eA(i,r,d)]);h(V),p(W),E(P(V??[],W))}catch(V){console.error(V),B(V)}m(!1),v(!0)}},[t,r.user,r.initialLoading,d,a,i,P]);A.useEffect(()=>{Q()},[Q]);const K=A.useCallback((V,W,j=!1)=>{if(!f)return;const _=rn(ge(V),f),M=j?l?.getCollectionConfig(V):void 0,N=_?$e(_,M):void 0;let q=N;const $=s&&s({entityId:W,path:ge(V)});if($&&(q=$),N){const le=N.subcollections,ce=N.callbacks,ne=N.permissions;q={...q,subcollections:q?.subcollections??le,callbacks:q?.callbacks??ce,permissions:q?.permissions??ne}}if(q)return{...N,...q}},[e,n,f,s]),L=A.useCallback(V=>ge(V+"/").startsWith(ge(F)+"/"),[F]),z=A.useCallback(V=>{if(V.startsWith(F))return V.replace(F,"");throw Error("Expected path starting with "+F)},[F]),H=A.useCallback(({path:V})=>`s/edit/${On(V)}`,[]),J=A.useCallback(V=>{if(!f)throw Error("Collections have not been initialised yet");return Zn(V,f)},[f]),O=u.state,G=O&&O.base_location?O.base_location:u,U=A.useCallback(V=>ks({path:V,collections:f}),[f]);return{collections:f??[],views:b??[],loading:!g||x,navigationLoadingError:C,homeUrl:I,basePath:e,baseCollectionPath:n,initialised:g,getCollection:K,isUrlCollectionPath:L,urlPathToDataPath:z,buildUrlCollectionPath:D,buildUrlEditCollectionPath:H,buildCMSUrlPath:T,resolveAliasesFrom:J,topLevelNavigation:w,baseLocation:G,refreshNavigation:Q,getParentReferencesFromPath:U}}function On(e){return encodeURIComponent(ge(e)).replaceAll("%2F","/").replaceAll("%23","#")}function Ss(e,n){return e.filter(r=>r.permissions?Uo(r,n,[r.path],null).read!==!1:!0).map(r=>r.subcollections?{...r,subcollections:Ss(r.subcollections,n)}:r)}async function Rd(e,n,r,t){let i=[];return typeof e=="function"?i=await e({user:n.user,authController:n,dataSource:r}):Array.isArray(e)&&(i=e),i=Ss(i,n),t&&t.forEach(s=>{s.collections?.injectCollections&&(i=s.collections?.injectCollections(i??[]))}),i}async function eA(e,n,r){let t=[];return typeof e=="function"?t=await e({user:n.user,authController:n,dataSource:r}):Array.isArray(e)&&(t=e),t}function oA(){const e=fe.useLocation(),n=fe.useNavigate(),[r,t]=A.useState([]),i=A.useRef(r),s=A.useRef({}),l=A.useRef(0),a=h=>{i.current=h,t(h)};A.useEffect(()=>{const p=(e.state?.panels??[]).map(g=>s.current[g]).filter(g=>!!g);Ae(i.current.map(g=>g.key),p.map(g=>g.key))||a(p)},[e]);const d=A.useCallback(()=>{if(r.length===0)return;const h=r[r.length-1],b=[...r.slice(0,-1)];if(a(b),l.current>0)h.urlPath&&n(-1),l.current--;else if(h.parentUrlPath){const p=e.state?.base_location??e;n(h.parentUrlPath,{replace:!0,state:{base_location:p,panels:b.map(g=>g.key)}})}},[r,n,e]),u=A.useCallback(h=>{const b=Array.isArray(h)?h:[h];b.forEach(v=>{s.current[v.key]=v}),l.current=l.current+b.length;const p=e.state?.base_location??e,g=[...r,...b];a(g),b.forEach(v=>{v.urlPath&&n(v.urlPath,{state:{base_location:p,panels:g.map(w=>w.key)}})})},[e,n,r]),f=A.useCallback(h=>{const b=Array.isArray(h)?h:[h];b.forEach(v=>{s.current[v.key]=v});const p=e.state?.base_location??e,g=[...r.slice(0,-b.length),...b];a(g),b.forEach(v=>{v.urlPath&&n(v.urlPath,{replace:!0,state:{base_location:p,panels:g.map(w=>w.key)}})})},[e,n,r]);return{sidePanels:r,close:d,open:u,replace:f}}const nA="/c";function Fs(e){const n=cn(),{children:r,collections:t,views:i,entityLinkBuilder:s,userConfigPersistence:l,dateTimeFormat:a,locale:d,authController:u,collectionOverrideHandler:f,storageSource:h,dataSource:b,basePath:p,baseCollectionPath:g,plugins:v,onAnalyticsEvent:w,fields:E}=e,x=p??"/",m=g??nA,C=d?Pt[d]:void 0,B=Kd({basePath:x,baseCollectionPath:m,authController:u,collections:t,views:i,collectionOverrideHandler:f,userConfigPersistence:l,dataSource:b,plugins:v}),S=oA(),k=Zd(B,S),I=u.initialLoading||B.loading||(v?.some(T=>T.loading)??!1);if(B.navigationLoadingError)return o.jsx(Qn,{maxWidth:300,fullScreen:!0,children:o.jsx(ue,{title:"Error loading navigation",error:B.navigationLoadingError})});if(u.authError)return o.jsx(Qn,{maxWidth:300,fullScreen:!0,children:o.jsx(ue,{title:"Error loading auth",error:u.authError})});const F={entityLinkBuilder:s,dateTimeFormat:a,locale:d,plugins:v,onAnalyticsEvent:w,fields:E??{}};return o.jsx(Jn.Provider,{value:n,children:o.jsx(Kn.Provider,{value:F,children:o.jsx(Nt.Provider,{value:l,children:o.jsx(Yt.Provider,{value:h,children:o.jsx(Lt.Provider,{value:b,children:o.jsx(Vt.Provider,{value:u,children:o.jsx(Wt.Provider,{value:S,children:o.jsx(zt.Provider,{value:k,children:o.jsx($t.Provider,{value:B,children:o.jsx(Kl,{children:o.jsx(qs.LocalizationProvider,{dateAdapter:js.AdapterDateFns,utils:Js,locale:C,children:o.jsx(rA,{loading:I,children:r})})})})})})})})})})})})}function rA({loading:e,children:n}){const r=oe();let t=n({context:r,loading:e});const i=r.plugins;return!e&&i&&i.forEach(s=>{s.provider&&(t=o.jsx(s.provider.Component,{...s.provider.props,context:r,children:t}))}),o.jsx(o.Fragment,{children:t})}const Is=({mode:e,primaryColor:n,secondaryColor:r,fontFamily:t,headersFontFamily:i})=>{c.createTheme();const l=c.createTheme({palette:{mode:e,background:{default:e==="dark"?"#202024":"#f8f8fa",paper:e==="dark"?"#121215":"#ffffff"},primary:{main:n||"#0070f4"},secondary:{main:r||on.pink[400]},error:{main:on.red.A400}},shape:{borderRadius:6},typography:{fontFamily:t||"'Rubik', 'Roboto', 'Helvetica', 'Arial', sans-serif",fontWeightMedium:500,h6:{fontFamily:t||"'Rubik', 'Roboto', 'Helvetica', 'Arial', sans-serif",fontSize:"1.15rem",fontWeight:500},h5:{fontFamily:t||"'Rubik', 'Roboto', 'Helvetica', 'Arial', sans-serif",fontSize:"1.55rem"},h4:{fontFamily:t||"'Rubik', 'Roboto', 'Helvetica', 'Arial', sans-serif",fontSize:"2rem",fontWeight:500},h3:{fontFamily:t||"'Rubik', 'Roboto', 'Helvetica', 'Arial', sans-serif",fontWeight:600},h2:{fontFamily:i||"'IBM Plex Mono', 'Space Mono', 'Rubik', 'Roboto', 'Helvetica', 'Arial', sans-serif",fontWeight:600},h1:{fontFamily:i||"'IBM Plex Mono', 'Space Mono', 'Rubik', 'Roboto', 'Helvetica', 'Arial', sans-serif",fontWeight:600},label:{display:"block",color:"#838383",fontWeight:500,fontSize:"0.875rem",lineHeight:1.43}},components:{MuiSkeleton:{styleOverrides:{root:{borderRadius:6}}},MuiButton:{styleOverrides:{root:{borderRadius:6}}},MuiLoadingButton:{styleOverrides:{root:{borderRadius:6}}},MuiTableRow:{styleOverrides:{root:{"&:last-child td":{borderBottom:0}}}},MuiTypography:{styleOverrides:{root:{"&.mono":{fontFamily:"'IBM Plex Mono', 'Space Mono', monospace, 'Lucida Console'"},"&.weight-500":{fontWeight:500}}}},MuiInputBase:{styleOverrides:{root:{"&.mono":{fontFamily:"'IBM Plex Mono', 'Space Mono', 'Lucida Console', monospace"},"& input::-webkit-outer-spin-button, & input::-webkit-inner-spin-button":{display:"none"},"& input[type=number]":{MozAppearance:"textfield"}}}},MuiDialog:{styleOverrides:{paper:{backgroundImage:"inherit"}}},MuiCardActionArea:{styleOverrides:{root:{borderRadius:6}}}}});return{...l,shadows:l.shadows.map((a,d)=>d===3?"0px 0px 0px 0px rgba(0,0,0,0.18), 0px 0px 10px 0px rgba(0,0,0,0.12), 0px 0px 14px 2px rgba(0,0,0,0.10)":a)}},Ts=A.memo(function({HomePage:n=bs,customRoutes:r}){const t=fe.useLocation(),i=pe(),l=oe().plugins??[];if(!i)return o.jsx(o.Fragment,{});const a=t.state,d=a&&a.base_location?a.base_location:t,u=[];i.views&&i.views.forEach(g=>{Array.isArray(g.path)?u.push(...g.path.map(v=>Ds(v,g))):u.push(Ds(g.path,g))});const h=[...i.collections??[]].sort((g,v)=>v.path.length-g.path.length).map(g=>{const v=i.buildUrlCollectionPath(g.alias??g.path),w=[];return l&&l.forEach(E=>{E.collections?.CollectionActions&&w.push(...et(E.collections?.CollectionActions))}),w.push(...et(g.Actions)),o.jsx(fe.Route,{path:v+"/*",element:o.jsx(Gn,{path:v,title:g.name,type:"collection",children:o.jsx(Kr,{isSubCollection:!1,fullPath:g.alias??g.path,...g,Actions:w},`collection_view_${g.alias??g.path}`)})},`navigation_${g.alias??g.path}`)}),b=o.jsx(fe.Route,{path:"/",element:o.jsx(Gn,{path:i.homeUrl,title:"Home",type:"home",children:o.jsx(n,{})},"navigation_home")}),p=o.jsx(fe.Route,{path:"*",element:o.jsx(vs,{})});return o.jsxs(fe.Routes,{location:d,children:[h,u,b,p,r]})}),Ds=(e,n)=>o.jsx(fe.Route,{path:e,element:o.jsx(Gn,{path:e,title:n.name,type:"view",children:n.view},`navigation_${e}`)},"navigation_view_"+e),Gn=A.memo(function({children:n,title:r,path:t,type:i}){const s=dn();return A.useEffect(()=>{s.set({breadcrumbs:[{title:r,url:t}]})},[t,r]),o.jsx(o.Fragment,{children:n})},Ae);function tA(e){return e}function iA(e){return e}function sA(e){return e}function lA(e){return e}function aA(e){return e}function cA(e){return e}function dA(e){return e}function AA(e){return e}function uA(e){return e}function Ps(){const e=c.useMediaQuery("(prefers-color-scheme: dark)"),r=(localStorage.getItem("prefers-dark-mode")!=null?localStorage.getItem("prefers-dark-mode")==="true":null)??e,[t,i]=A.useState(r?"dark":"light");A.useEffect(()=>{i(r?"dark":"light"),a(r?"dark":"light")},[r]);const s=A.useCallback(()=>{i("dark"),a("dark")},[e]),l=A.useCallback(()=>{i("light"),a("light")},[]),a=A.useCallback(u=>{document.body.style.setProperty("color-scheme",u)},[document]),d=A.useCallback(()=>{t==="light"?(e?localStorage.removeItem("prefers-dark-mode"):localStorage.setItem("prefers-dark-mode","true"),s()):(e?localStorage.setItem("prefers-dark-mode","false"):localStorage.removeItem("prefers-dark-mode"),l())},[t,e]);return{mode:t,setMode:i,toggleMode:d}}function Ms(){const[e,n]=A.useState({}),r=A.useCallback(g=>{const v=localStorage.getItem(g);return v?JSON.parse(v):{}},[]),t=A.useCallback(g=>{const v=`collection_config::${wr(g)}`;return e[v]?e[v]:r(v)},[e,r]),i=A.useCallback((g,v)=>{const w=`collection_config::${wr(g)}`;localStorage.setItem(w,JSON.stringify(v)),n(E=>{const x=E[w],m=$e(x??r(g),v);return $e(E,m)})},[r]),[s,l]=A.useState([]),[a,d]=A.useState([]),[u,f]=A.useState([]);A.useEffect(()=>{l(localStorage.getItem("recently_visited_paths")?JSON.parse(localStorage.getItem("recently_visited_paths")):[]),d(localStorage.getItem("favourite_paths")?JSON.parse(localStorage.getItem("favourite_paths")):[]),f(localStorage.getItem("collapsed_groups")?JSON.parse(localStorage.getItem("collapsed_groups")):[])},[]);const h=A.useCallback(g=>{localStorage.setItem("recently_visited_paths",JSON.stringify(g)),l(g)},[]),b=A.useCallback(g=>{localStorage.setItem("favourite_paths",JSON.stringify(g)),d(g)},[]),p=A.useCallback(g=>{localStorage.setItem("collapsed_groups",JSON.stringify(g)),f(g)},[]);return{onCollectionModified:i,getCollectionConfig:t,recentlyVisitedPaths:s,setRecentlyVisitedPaths:h,favouritePaths:a,setFavouritePaths:b,collapsedGroups:u,setCollapsedGroups:p}}const Qs=({children:e})=>o.jsx(ft.SnackbarProvider,{maxSnack:3,autoHideDuration:3500,children:e}),Os=({firebaseApp:e,signInOptions:n})=>{const[r,t]=A.useState(void 0),[i,s]=A.useState(),[l,a]=A.useState(),[d,u]=A.useState(!0),[f,h]=A.useState(!0),[b,p]=A.useState(!1),[g,v]=A.useState(),[w,E]=A.useState();A.useEffect(()=>{if(e)try{const O=ee.getAuth(e);return s(void 0),t(O.currentUser),ee.onAuthStateChanged(O,m,G=>a(G))}catch(O){return s(O),()=>{}}},[e]);const x=A.useCallback(()=>{p(!0),t(null)},[]),m=A.useCallback(async O=>{t(O),u(!1),h(!1)},[]),C=A.useCallback(()=>{const O=ee.getAuth(e);ee.signOut(O).then(G=>{t(null),a(null)}),p(!1)},[e]),B=A.useCallback(O=>n.find(G=>{if(G===null)throw Error("useFirebaseAuthController");if(typeof G=="object"&&G.provider===O)return G}),[n]),S=A.useCallback(()=>{const O=new ee.GoogleAuthProvider,G=B("google.com");G?.scopes&&G.scopes.forEach(V=>O.addScope(V)),G?.customParameters&&O.setCustomParameters(G.customParameters);const U=ee.getAuth();ee.signInWithPopup(U,O).catch(a)},[B]),k=A.useCallback((O,G)=>{h(!0),ee.signInWithPopup(O,G).catch(a).then(()=>h(!1))},[]),I=A.useCallback(()=>{const O=ee.getAuth();h(!0),ee.signInAnonymously(O).catch(a).then(()=>h(!1))},[]),F=A.useCallback((O,G)=>{const U=ee.getAuth();return h(!0),ee.signInWithPhoneNumber(U,O,G).catch(a).then(V=>{h(!1),v(V??void 0)})},[]),T=A.useCallback(()=>{const O=new ee.OAuthProvider("apple.com"),G=B("apple.com");G?.scopes&&G.scopes.forEach(V=>O.addScope(V)),G?.customParameters&&O.setCustomParameters(G.customParameters);const U=ee.getAuth();k(U,O)},[k,B]),D=A.useCallback(()=>{const O=new ee.FacebookAuthProvider,G=B("facebook.com");G?.scopes&&G.scopes.forEach(V=>O.addScope(V)),G?.customParameters&&O.setCustomParameters(G.customParameters);const U=ee.getAuth();k(U,O)},[k,B]),P=A.useCallback(()=>{const O=new ee.GithubAuthProvider,G=B("github.com");G?.scopes&&G.scopes.forEach(V=>O.addScope(V)),G?.customParameters&&O.setCustomParameters(G.customParameters);const U=ee.getAuth();k(U,O)},[k,B]),Q=A.useCallback(()=>{const O=new ee.OAuthProvider("microsoft.com"),G=B("microsoft.com");G?.scopes&&G.scopes.forEach(V=>O.addScope(V)),G?.customParameters&&O.setCustomParameters(G.customParameters);const U=ee.getAuth();k(U,O)},[k,B]),K=A.useCallback(()=>{const O=new ee.TwitterAuthProvider,G=B("twitter.com");G?.customParameters&&O.setCustomParameters(G.customParameters);const U=ee.getAuth();k(U,O)},[k,B]),L=A.useCallback((O,G)=>{const U=ee.getAuth();h(!0),ee.signInWithEmailAndPassword(U,O,G).catch(a).then(()=>h(!1))},[]),z=A.useCallback((O,G)=>{const U=ee.getAuth();h(!0),ee.createUserWithEmailAndPassword(U,O,G).catch(a).then(()=>h(!1))},[]),H=A.useCallback(O=>{const G=ee.getAuth();return h(!0),ee.fetchSignInMethodsForEmail(G,O).then(U=>(h(!1),U))},[]),J=A.useCallback(async()=>{if(!r)throw Error("User is not logged in");return r.getIdToken()},[r]);return{user:r??null,authError:i,authProviderError:l,authLoading:f,initialLoading:d,getAuthToken:J,confirmationResult:g,signOut:C,loginSkipped:b,skipLogin:x,googleLogin:S,anonymousLogin:I,appleLogin:T,facebookLogin:D,githubLogin:P,microsoftLogin:Q,twitterLogin:K,emailPasswordLogin:L,phoneLogin:F,fetchSignInMethodsForEmail:H,createUserWithEmailAndPassword:z,extra:w,setExtra:E}};function fA(e){if(!e)return e;const n=e.toDate();return n.setHours(0,0,0,0),X.Timestamp.fromDate(n)}function Gs({firebaseApp:e,textSearchController:n,fields:r={}}){const t=A.useCallback((a,d,u)=>{const f=ao(a.data()),h=a.data()?u.properties?bi(f,u.properties):a.data():void 0;return{id:a.id,path:Ls(a.ref.path),values:h}},[]),i=A.useCallback((a,d,u,f,h,b,p=!1)=>{if(!e)throw Error("useFirestoreDataSource Firebase not initialised");const g=X.getFirestore(e),v=p?X.collectionGroup(g,a):X.collection(g,a),w=[];return d&&Object.entries(d).filter(([E,x])=>!!x).forEach(([E,x])=>{const[m,C]=x;w.push(X.where(E,m,ko(C,g)))}),u&&f&&w.push(X.orderBy(u,f)),h&&w.push(X.startAfter(h)),b&&w.push(X.limit(b)),X.query(v,...w)},[e]),s=A.useCallback((a,d,u)=>{if(!e)throw Error("useFirestoreDataSource Firebase not initialised");const f=X.getFirestore(e);return X.getDoc(X.doc(f,a,d)).then(h=>{if(!h.exists())return;const b=ve({collection:u,path:a,entityId:h.id,values:ao(h.data()),fields:r});return t(h,a,b)})},[e]),l=A.useCallback(async(a,d,u)=>{if(!n)throw Error("Trying to make text search without specifying a FirestoreTextSearchController");const f=await n({path:a,searchString:d});if(f===void 0)throw Error("The current path is not supported by the specified FirestoreTextSearchController");const h=f.map(async b=>{try{return await s(a,b,u)}catch(p){console.error(p);return}});return Promise.all(h).then(b=>b.filter(p=>p!==void 0&&p.values))},[s,n]);return{fetchCollection:A.useCallback(({path:a,collection:d,filter:u,limit:f,startAfter:h,searchString:b,orderBy:p,order:g})=>{if(b)return l(a,b,d);const v=d.collectionGroup??!1;console.debug("Fetching collection",{path:a,limit:f,filter:u,startAfter:h,orderBy:p,order:g,collectionGroup:v});const w=i(a,u,p,g,h,f,v);return X.getDocs(w).then(E=>E.docs.map(x=>{const m=ve({collection:d,path:a,values:ao(x.data()),fields:r});return t(x,a,m)}))},[i,l]),listenCollection:A.useCallback(({path:a,collection:d,filter:u,limit:f,startAfter:h,searchString:b,orderBy:p,order:g,onUpdate:v,onError:w})=>{const E=d.collectionGroup??!1;console.debug("Listening collection",{path:a,collectionGroup:E,limit:f,filter:u,startAfter:h,orderBy:p,order:g});const x=i(a,u,p,g,h,f,E);if(b)return l(a,b,d).then(v).catch(C=>{w&&w(C)}),()=>{};const m=ve({collection:d,path:a,fields:r});return X.onSnapshot(x,{next:C=>{v(C.docs.map(B=>t(B,a,m)))},error:w})},[i,l]),fetchEntity:A.useCallback(({path:a,entityId:d,collection:u})=>s(a,d,u),[s]),listenEntity:A.useCallback(({path:a,entityId:d,collection:u,onUpdate:f,onError:h})=>{if(!e)throw Error("useFirestoreDataSource Firebase not initialised");const b=X.getFirestore(e);return X.onSnapshot(X.doc(b,a,d),{next:p=>{const g=ve({collection:u,path:a,entityId:p.id,fields:r});f(t(p,a,g))},error:h})},[e]),saveEntity:A.useCallback(({path:a,entityId:d,values:u,collection:f,status:h})=>{if(!e)throw Error("useFirestoreDataSource Firebase not initialised");const b=X.getFirestore(e),g=ve({collection:f,path:a,entityId:d,fields:r}).properties,v=X.collection(b,a),w=ko(u,b),E=pi({inputValues:w,properties:g,status:h,timestampNowValue:X.serverTimestamp(),setDateToMidnight:fA});console.debug("Saving entity",a,d,E);let x;return d?x=X.doc(v,d):x=X.doc(v),X.setDoc(x,E,{merge:!0}).then(()=>({id:x.id,path:a,values:ao(E)}))},[e]),deleteEntity:A.useCallback(({entity:a})=>{if(!e)throw Error("useFirestoreDataSource Firebase not initialised");const d=X.getFirestore(e);return X.deleteDoc(X.doc(d,a.path,a.id))},[e]),checkUniqueField:A.useCallback((a,d,u,f,h)=>{if(!e)throw Error("useFirestoreDataSource Firebase not initialised");const b=X.getFirestore(e);if(console.debug("Check unique field entity",a,d,u,h),f.dataType==="array"&&console.error("checkUniqueField received an array"),u==null)return Promise.resolve(!0);const p=X.query(X.collection(b,a),X.where(d,"==",ko(u,b)));return X.getDocs(p).then(g=>g.docs.filter(v=>v.id!==h).length===0)},[e]),generateEntityId:A.useCallback(a=>{if(!e)throw Error("useFirestoreDataSource Firebase not initialised");const d=X.getFirestore(e);return X.doc(X.collection(d,a)).id},[e]),countEntities:A.useCallback(async a=>{if(!e)throw Error("useFirestoreDataSource Firebase not initialised");const d=X.getFirestore(e),u=a.collection.collectionGroup?X.collectionGroup(d,a.path):X.collection(d,a.path);return(await X.getCountFromServer(u)).data().count},[e])}}function ao(e){if(e==null)return null;if(!X.deleteField().isEqual(e)){if(X.serverTimestamp().isEqual(e))return null;if(e instanceof X.Timestamp||typeof e.toDate=="function"&&e.toDate()instanceof Date)return e.toDate();if(e instanceof Date)return e;if(e instanceof X.GeoPoint)return new Oo(e.latitude,e.longitude);if(e instanceof X.DocumentReference)return new Pe(e.id,Ls(e.path));if(Array.isArray(e))return e.map(ao).filter(n=>n!==void 0);if(typeof e=="object"){const n={};for(const r of Object.keys(e)){const t=ao(e[r]);t!==void 0&&(n[r]=t)}return n}return e}}function ko(e,n){return e===void 0?X.deleteField():Array.isArray(e)?e.map(r=>ko(r,n)):e instanceof Pe?X.doc(n,e.path,e.id):e instanceof Oo?new X.GeoPoint(e.latitude,e.longitude):e instanceof Date?X.Timestamp.fromDate(e):e&&typeof e=="object"?Object.entries(e).map(([r,t])=>({[r]:ko(t,n)})).reduce((r,t)=>({...r,...t}),{}):e}function Ls(e){let n=e.lastIndexOf("/");return n=n===-1?e.length:n,e.substring(0,n)}function $s({firebaseApp:e}){const[n,r]=A.useState();A.useEffect(()=>{e&&r(Ue.getStorage(e))},[e]);const t={};return{uploadFile({file:i,fileName:s,path:l,metadata:a}){if(!n)throw Error("useFirebaseStorageSource Firebase not initialised");const d=s??i.name;return console.debug("Uploading file",d,i,l,a),Ue.uploadBytes(Ue.ref(n,`${l}/${d}`),i,a).then(u=>({path:u.ref.fullPath}))},async getFile(i){try{if(!n)throw Error("useFirebaseStorageSource Firebase not initialised");const s=Ue.ref(n,i),l=await Ue.getDownloadURL(s),d=await(await fetch(l)).blob();return new File([d],i)}catch(s){if(s?.code==="storage/object-not-found")return null;throw s}},async getDownloadURL(i){if(!n)throw Error("useFirebaseStorageSource Firebase not initialised");if(t[i])return t[i];const s=Ue.ref(n,i),[l,a]=await Promise.all([Ue.getDownloadURL(s),Ue.getMetadata(s)]),d={url:l,metadata:a};return t[i]=d,d}}}function Vs({authController:e,authentication:n,getAppCheckToken:r,appCheckForceRefresh:t=!1,storageSource:i,dataSource:s}){const l=!!n,[a,d]=A.useState(l),[u,f]=A.useState(!1),[h,b]=A.useState(!l||!!e.loginSkipped),p=h&&(!l||!!e.user||!!e.loginSkipped)&&!u;A.useEffect(()=>{e.loginSkipped&&b(!0)},[e.loginSkipped]);const g=A.useRef(),v=A.useCallback(async()=>{if(e.initialLoading)return;if(!e.user&&!e.loginSkipped){g.current=void 0,d(!1),b(!1);return}const w=e.user;if(r)try{await r(t)?console.debug("App Check success."):(f("App Check failed."),e.signOut())}catch(E){f(E.message),e.signOut()}if(n instanceof Function&&w&&!Ae(g.current,w)){d(!0);try{await n({user:w,authController:e,dataSource:s,storageSource:i})||(e.signOut(),f(!0))}catch(E){f(E),e.signOut()}d(!1),b(!0),g.current=w}else d(!1);!e.initialLoading&&!w&&b(!0)},[e,n,r,t,s,i]);return A.useEffect(()=>{v()},[v]),{canAccessMainView:p,authLoading:l&&a,notAllowedError:u,authVerified:h}}const hA=`It seems like the provided Firebase config is not correct. If you 
are using the credentials provided automatically by Firebase 
Hosting, make sure you link your Firebase app to Firebase Hosting. 
`;function Ws({firebaseConfig:e,onFirebaseInit:n,name:r,authDomain:t}){const[i,s]=A.useState(),[l,a]=A.useState(!1),[d,u]=A.useState(),f=A.useCallback(h=>{try{const b=jl.initializeApp(h,r??"[DEFAULT]");u(void 0),a(!1),s(b)}catch(b){console.error("Error initialising Firebase",b),u(hA+`
`+(b.message??JSON.stringify(b)))}},[r]);return A.useEffect(()=>{n&&e&&i&&n(e,i)},[i]),A.useEffect(()=>{a(!0),e?f(e):process.env.NODE_ENV==="production"?fetch("/__/firebase/init.json").then(async h=>{if(console.debug("Firebase init response",h.status),h&&h.status<300){const b=await h.json();t&&(b.authDomain=t),f(b)}}).catch(h=>{a(!1),u("Could not load Firebase configuration from Firebase hosting. If the app is not deployed in Firebase hosting, you need to specify the configuration manually"+h.toString())}):(a(!1),u("You need to deploy the app to Firebase hosting or specify a Firebase configuration object"))},[e,f]),{firebaseApp:i,firebaseConfigLoading:l,configError:d}}function zs({firebaseApp:e,options:n}){n?.debugToken&&Object.assign(window,{FIREBASE_APPCHECK_DEBUG_TOKEN:n?.debugToken});const[r,t]=A.useState(!1),[i,s]=A.useState(),l=A.useCallback(a=>{if(!(!i||!n))return nn.getToken(i,a)},[i,n]);return A.useEffect(()=>{if(!n||!e)return;t(!0);const{providerKey:a,useEnterpriseRecaptcha:d,isTokenAutoRefreshEnabled:u}=n,f=nn.initializeAppCheck(e,{provider:d?new nn.ReCaptchaEnterpriseProvider(a):new nn.ReCaptchaV3Provider(a),isTokenAutoRefreshEnabled:u});s(f),t(!1)},[e,n]),{appCheckLoading:r,getAppCheckToken:n?l:void 0}}const gA=e=>o.jsx(o.Fragment,{children:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64",width:32,height:32,children:[o.jsxs("linearGradient",{id:"95yY7w43Oj6n2vH63j6HJb",x1:"29.401",x2:"29.401",y1:"4.064",y2:"106.734",gradientTransform:"matrix(1 0 0 -1 0 66)",gradientUnits:"userSpaceOnUse",children:[o.jsx("stop",{offset:"0",stopColor:"#ff5840"}),o.jsx("stop",{offset:".007",stopColor:"#ff5840"}),o.jsx("stop",{offset:".989",stopColor:"#fa528c"}),o.jsx("stop",{offset:"1",stopColor:"#fa528c"})]}),o.jsx("path",{fill:"url(#95yY7w43Oj6n2vH63j6HJb)",d:"M47.46,15.5l-1.37,1.48c-1.34,1.44-3.5,1.67-5.15,0.6c-2.71-1.75-6.43-3.13-11-2.37 c-4.94,0.83-9.17,3.85-11.64, 7.97l-8.03-6.08C14.99,9.82,23.2,5,32.5,5c5,0,9.94,1.56,14.27,4.46 C48.81,10.83,49.13,13.71,47.46,15.5z"}),o.jsxs("linearGradient",{id:"95yY7w43Oj6n2vH63j6HJc",x1:"12.148",x2:"12.148",y1:".872",y2:"47.812",gradientTransform:"matrix(1 0 0 -1 0 66)",gradientUnits:"userSpaceOnUse",children:[o.jsx("stop",{offset:"0",stopColor:"#feaa53"}),o.jsx("stop",{offset:".612",stopColor:"#ffcd49"}),o.jsx("stop",{offset:"1",stopColor:"#ffde44"})]}),o.jsx("path",{fill:"url(#95yY7w43Oj6n2vH63j6HJc)",d:"M16.01,30.91c-0.09,2.47,0.37,4.83,1.27,6.96l-8.21,6.05c-1.35-2.51-2.3-5.28-2.75-8.22 c-1.06-6.88,0.54-13.38, 3.95-18.6l8.03,6.08C16.93,25.47,16.1,28.11,16.01,30.91z"}),o.jsxs("linearGradient",{id:"95yY7w43Oj6n2vH63j6HJd",x1:"29.76",x2:"29.76",y1:"32.149",y2:"-6.939",gradientTransform:"matrix(1 0 0 -1 0 66)",gradientUnits:"userSpaceOnUse",children:[o.jsx("stop",{offset:"0",stopColor:"#42d778"}),o.jsx("stop",{offset:".428",stopColor:"#3dca76"}),o.jsx("stop",{offset:"1",stopColor:"#34b171"})]}),o.jsx("path",{fill:"url(#95yY7w43Oj6n2vH63j6HJd)",d:"M50.45,51.28c-4.55,4.07-10.61,6.57-17.36,6.71C22.91,58.2,13.66,52.53,9.07,43.92l8.21-6.05 C19.78,43.81, 25.67,48,32.5,48c3.94,0,7.52-1.28,10.33-3.44L50.45,51.28z"}),o.jsxs("linearGradient",{id:"95yY7w43Oj6n2vH63j6HJe",x1:"46",x2:"46",y1:"3.638",y2:"35.593",gradientTransform:"matrix(1 0 0 -1 0 66)",gradientUnits:"userSpaceOnUse",children:[o.jsx("stop",{offset:"0",stopColor:"#155cde"}),o.jsx("stop",{offset:".278",stopColor:"#1f7fe5"}),o.jsx("stop",{offset:".569",stopColor:"#279ceb"}),o.jsx("stop",{offset:".82",stopColor:"#2cafef"}),o.jsx("stop",{offset:"1",stopColor:"#2eb5f0"})]}),o.jsx("path",{fill:"url(#95yY7w43Oj6n2vH63j6HJe)",d:`M59,31.97c0.01,7.73-3.26,14.58-8.55,19.31l-7.62-6.72c2.1-1.61,3.77-3.71,4.84-6.15
        c0.29-0.66-0.2-1.41-0.92-1.41H37c-2.21,0-4-1.79-4-4v-2c0-2.21,1.79-4,4-4h17C56.75,27,59,29.22,59,31.97z`})]})}),pA=e=>o.jsx("svg",{width:32,height:32,viewBox:"0 0 56 56",style:{transform:"scale(2.8)"},version:"1.1",xmlns:"http://www.w3.org/2000/svg",children:o.jsx("g",{stroke:e==="light"?"#424245":"white",strokeWidth:"0.5",fillRule:"evenodd",children:o.jsx("path",{d:"M28.2226562,20.3846154 C29.0546875,20.3846154 30.0976562,19.8048315 30.71875,19.0317864 C31.28125,18.3312142 31.6914062,17.352829 31.6914062,16.3744437 C31.6914062,16.2415766 31.6796875,16.1087095 31.65625,16 C30.7304687,16.0362365 29.6171875,16.640178 28.9492187,17.4494596 C28.421875,18.06548 27.9414062,19.0317864 27.9414062,20.0222505 C27.9414062,20.1671964 27.9648438,20.3121424 27.9765625,20.3604577 C28.0351562,20.3725366 28.1289062,20.3846154 28.2226562,20.3846154 Z M25.2929688,35 C26.4296875,35 26.9335938,34.214876 28.3515625,34.214876 C29.7929688,34.214876 30.109375,34.9758423 31.375,34.9758423 C32.6171875,34.9758423 33.4492188,33.792117 34.234375,32.6325493 C35.1132812,31.3038779 35.4765625,29.9993643 35.5,29.9389701 C35.4179688,29.9148125 33.0390625,28.9122695 33.0390625,26.0979021 C33.0390625,23.6579784 34.9140625,22.5588048 35.0195312,22.474253 C33.7773438,20.6382708 31.890625,20.5899555 31.375,20.5899555 C29.9804688,20.5899555 28.84375,21.4596313 28.1289062,21.4596313 C27.3554688,21.4596313 26.3359375,20.6382708 25.1289062,20.6382708 C22.8320312,20.6382708 20.5,22.5950413 20.5,26.2911634 C20.5,28.5861411 21.3671875,31.013986 22.4335938,32.5842339 C23.3476562,33.9129053 24.1445312,35 25.2929688,35 Z",fill:e==="light"?"#424245":"white",fillRule:"nonzero"})})}),bA=e=>o.jsx("svg",{fill:e==="light"?"#1c1e21":"white",role:"img",viewBox:"0 0 24 24",width:28,height:28,xmlns:"http://www.w3.org/2000/svg",children:o.jsx("path",{d:"M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"})}),vA=e=>o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:28,height:28,viewBox:"0 0 90 90",children:o.jsx("g",{children:o.jsx("path",{d:"M90,15.001C90,7.119,82.884,0,75,0H15C7.116,0,0,7.119,0,15.001v59.998   C0,82.881,7.116,90,15.001,90H45V56H34V41h11v-5.844C45,25.077,52.568,16,61.875,16H74v15H61.875C60.548,31,59,32.611,59,35.024V41   h15v15H59v34h16c7.884,0,15-7.119,15-15.001V15.001z",fill:e==="light"?"#39569c":"white"})})}),yA=e=>o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:28,height:28,viewBox:"0 0 480 480",children:o.jsx("g",{children:o.jsx("path",{d:"M0.176,224L0.001,67.963l192-26.072V224H0.176z M224.001,37.241L479.937,0v224H224.001V37.241z M479.999,256l-0.062,224   l-255.936-36.008V256H479.999z M192.001,439.918L0.157,413.621L0.147,256h191.854V439.918z",fill:e==="light"?"#00a2ed":"white"})})}),wA=e=>o.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:28,height:28,viewBox:"0 0 24 24",children:o.jsx("path",{fill:e==="light"?"#00acee":"white",d:"M24 4.557c-.883.392-1.832.656-2.828.775 1.017-.609 1.798-1.574 2.165-2.724-.951.564-2.005.974-3.127 1.195-.897-.957-2.178-1.555-3.594-1.555-3.179 0-5.515 2.966-4.797 6.045-4.091-.205-7.719-2.165-10.148-5.144-1.29 2.213-.669 5.108 1.523 6.574-.806-.026-1.566-.247-2.229-.616-.054 2.281 1.581 4.415 3.949 4.89-.693.188-1.452.232-2.224.084.626 1.956 2.444 3.379 4.6 3.419-2.07 1.623-4.678 2.348-7.29 2.04 2.179 1.397 4.768 2.212 7.548 2.212 9.142 0 14.307-7.721 13.995-14.646.962-.695 1.797-1.562 2.457-2.549z"})}),Ys="recaptcha-container";function xA(){return A.useEffect(()=>{if(!window||window?.recaptchaVerifier)return;const e=ee.getAuth();window.recaptchaVerifier=new ee.RecaptchaVerifier(Ys,{size:"invisible"},e)},[]),null}function Ns({allowSkipLogin:e,logo:n,signInOptions:r,firebaseApp:t,authController:i,noUserComponent:s,disableSignupScreen:l=!1,disabled:a=!1,additionalComponent:d,notAllowedError:u}){const f=cn(),[h,b]=A.useState(!1),[p,g]=A.useState(!1),v=r.map(C=>typeof C=="object"?C.provider:C),w=A.useCallback(()=>{const C=ee.getAuth(),B=new ee.RecaptchaVerifier("recaptcha",{size:"invisible"},C),S=ee.getMultiFactorResolver(C,i.authProviderError);if(S.hints[0].factorId===ee.PhoneMultiFactorGenerator.FACTOR_ID){const k={multiFactorHint:S.hints[0],session:S.session};new ee.PhoneAuthProvider(C).verifyPhoneNumber(k,B).then(function(F){const T=String(window.prompt("Please enter the verification code that was sent to your mobile device.")),D=ee.PhoneAuthProvider.credential(F,T),P=ee.PhoneMultiFactorGenerator.assertion(D);return S.resolveSignIn(P)})}else console.warn("Unsupported second factor.")},[i.authProviderError]);function E(){let C;if(i.user!=null)return C;const B=["auth/popup-closed-by-user","auth/cancelled-popup-request"];return i.authProviderError&&(i.authProviderError.code==="auth/operation-not-allowed"||i.authProviderError.code==="auth/configuration-not-found"?C=o.jsxs("div",{children:[o.jsx(c.Box,{p:1,children:o.jsx(ue,{error:"You need to enable Firebase auth and the corresponding login provider in your Firebase project"})}),t&&o.jsx(c.Box,{p:1,children:o.jsx("a",{href:`https://console.firebase.google.com/project/${t.options.projectId}/authentication/providers`,rel:"noopener noreferrer",target:"_blank",children:o.jsx(c.Button,{variant:"text",color:"primary",children:"Open Firebase configuration"})})})]}):i.authProviderError.code==="auth/invalid-api-key"?C=o.jsx("div",{children:o.jsx(c.Box,{p:1,children:o.jsx(ue,{title:"Invalid API key",error:"auth/invalid-api-key: Check that your Firebase config is set correctly in your `firebase-config.ts` file"})})}):B.includes(i.authProviderError.code)||(i.authProviderError.code==="auth/multi-factor-auth-required"&&w(),C=o.jsx(c.Box,{p:1,children:o.jsx(ue,{error:i.authProviderError})}))),C}let x;n?x=o.jsx("img",{src:n,style:{height:"100%",width:"100%",objectFit:"cover"},alt:"Logo"}):x=o.jsx(nt,{});let m;return u&&(typeof u=="string"?m=u:u instanceof Error?m=u.message:m="It looks like you don't have access to the CMS, based on the specified Authenticator configuration"),o.jsx(c.Fade,{in:!0,timeout:800,mountOnEnter:!0,unmountOnExit:!0,children:o.jsxs(c.Box,{sx:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",minHeight:"100vh","@supports (minHeight: 100dvh)":{minHeight:"100dvh"},minWidth:"100vw",p:2},children:[o.jsx("div",{id:"recaptcha"}),o.jsxs(c.Box,{sx:{display:"flex",flexDirection:"column",alignItems:"center",width:"100%",maxWidth:480},children:[o.jsx(c.Box,{m:1,sx:{padding:1,width:260,height:260},children:x}),m&&o.jsx(c.Box,{p:2,children:o.jsx(ue,{error:m})}),E(),!h&&!p&&o.jsxs(o.Fragment,{children:[Us(i,v,f.mode,a),v.includes("password")&&o.jsx(We,{disabled:a,text:"Email/password",icon:o.jsx(yt,{fontSize:"large"}),onClick:()=>b(!0)}),v.includes("phone")&&o.jsx(We,{disabled:a,text:"Phone number",icon:o.jsx(Be.Phone,{fontSize:"large"}),onClick:()=>g(!0)}),v.includes("anonymous")&&o.jsx(We,{disabled:a,text:"Log in anonymously",icon:o.jsx(ql,{fontSize:"large"}),onClick:i.anonymousLogin}),e&&o.jsx(c.Box,{m:1,children:o.jsx(c.Button,{disabled:a,onClick:i.skipLogin,children:"Skip login"})})]}),h&&o.jsx(BA,{authController:i,onClose:()=>b(!1),mode:f.mode,noUserComponent:s,disableSignupScreen:l}),p&&o.jsx(CA,{authController:i,onClose:()=>g(!1)}),!h&&!p&&d]})]})})}function We({icon:e,onClick:n,text:r,disabled:t}){return o.jsx(c.Box,{m:.5,width:"100%",children:o.jsx(c.Button,{fullWidth:!0,variant:"outlined",disabled:t,onClick:n,children:o.jsxs(c.Box,{sx:{p:"1",display:"flex",width:"240px",height:"32px",alignItems:"center",justifyItems:"center"},children:[o.jsx(c.Box,{sx:{display:"flex",flexDirection:"column",width:"32px",alignItems:"center",justifyItems:"center"},children:e}),o.jsx(c.Box,{sx:{flexGrow:1,pl:2,textAlign:"center"},children:r})]})})})}function CA({onClose:e,authController:n}){xA();const[r,t]=A.useState(),[i,s]=A.useState(),[l,a]=A.useState(!1),d=async u=>{u.preventDefault(),i&&n.confirmationResult?(a(!1),n.confirmationResult.confirm(i).catch(f=>{f.code==="auth/invalid-verification-code"&&a(!0)})):r&&n.phoneLogin(r,window.recaptchaVerifier)};return o.jsxs("form",{onSubmit:d,children:[l&&o.jsx(c.Box,{p:2,children:o.jsx(ue,{error:"Invalid confirmation code"})}),o.jsx("div",{id:Ys}),o.jsxs(c.Grid,{container:!0,spacing:1,children:[o.jsx(c.Grid,{item:!0,xs:12,children:o.jsx(c.IconButton,{onClick:e,children:o.jsx(jn,{sx:{width:20,height:20}})})}),o.jsx(c.Grid,{item:!0,xs:12,sx:{p:1,display:"flex"},children:o.jsx(c.Typography,{align:"center",variant:"subtitle2",children:"Please enter your phone number"})}),o.jsx(c.Grid,{item:!0,xs:12,children:o.jsx(c.TextField,{placeholder:"",fullWidth:!0,value:r,disabled:!!(r&&(n.authLoading||n.confirmationResult)),type:"phone",required:!0,onChange:u=>t(u.target.value)})}),!!(r&&n.confirmationResult)&&o.jsxs(o.Fragment,{children:[o.jsx(c.Grid,{item:!0,xs:12,sx:{mt:2,p:1,display:"flex"},children:o.jsx(c.Typography,{align:"center",variant:"subtitle2",children:"Please enter the confirmation code"})}),o.jsx(c.Grid,{item:!0,xs:12,children:o.jsx(c.TextField,{placeholder:"",fullWidth:!0,value:i,type:"text",required:!0,onChange:u=>s(u.target.value)})})]}),o.jsx(c.Grid,{item:!0,xs:12,children:o.jsxs(c.Box,{sx:{display:"flex",justifyContent:"end",alignItems:"center",width:"100%"},children:[n.authLoading&&o.jsx(c.CircularProgress,{sx:{p:1},size:16,thickness:8}),o.jsx(c.Button,{type:"submit",children:"Ok"})]})})]})]})}function BA({onClose:e,authController:n,mode:r,noUserComponent:t,disableSignupScreen:i}){const s=A.useRef(null),[l,a]=A.useState(),[d,u]=A.useState(),[f,h]=A.useState(),b=d===void 0,p=d&&d.includes("password"),g=d&&!d.includes("password")&&d.length>0,v=d&&!d.includes("password");A.useEffect(()=>{(p||v)&&s.current&&s.current.focus()},[p,v]),A.useEffect(()=>{if(!document)return;const k=I=>{I.keyCode===27&&e()};return document.addEventListener("keydown",k,!1),()=>{document.removeEventListener("keydown",k,!1)}},[e]);function w(){l&&n.fetchSignInMethodsForEmail(l).then(k=>{u(k)})}function E(){l&&f&&n.emailPasswordLogin(l,f)}function x(){l&&f&&n.createUserWithEmailAndPassword(l,f)}const m=()=>{b?e():u(void 0)},C=k=>{k.preventDefault(),b?w():p?E():v&&x()},B=v?"No user found with that email. Pick a password to create a new account":p?"Please enter your password":"Please enter your email",S=v?"Create account":p?"Login":"Ok";return g?o.jsxs(c.Grid,{container:!0,spacing:1,children:[o.jsx(c.Grid,{item:!0,xs:12,children:o.jsx(c.IconButton,{onClick:m,children:o.jsx(jn,{sx:{width:20,height:20}})})}),o.jsxs(c.Grid,{item:!0,xs:12,sx:{p:1},children:[o.jsx(c.Typography,{align:"center",variant:"subtitle2",children:"You already have an account"}),o.jsxs(c.Typography,{align:"center",variant:"body2",children:["You can use one of these methods to login with ",l]})]}),o.jsx(c.Grid,{item:!0,xs:12,children:d&&Us(n,d,r,!1)})]}):o.jsx(c.Slide,{direction:"up",in:!0,mountOnEnter:!0,unmountOnExit:!0,children:o.jsx("form",{onSubmit:C,children:o.jsxs(c.Grid,{container:!0,spacing:1,children:[o.jsx(c.Grid,{item:!0,xs:12,children:o.jsx(c.IconButton,{onClick:m,children:o.jsx(jn,{sx:{width:20,height:20}})})}),o.jsx(c.Grid,{item:!0,xs:12,sx:{p:1,display:v&&i?"none":"flex"},children:o.jsx(c.Typography,{align:"center",variant:"subtitle2",children:B})}),o.jsx(c.Grid,{item:!0,xs:12,sx:{display:b?"inherit":"none"},children:o.jsx(c.TextField,{placeholder:"Email",fullWidth:!0,autoFocus:!0,value:l??"",disabled:n.authLoading,type:"email",onChange:k=>a(k.target.value)})}),o.jsx(c.Grid,{item:!0,xs:12,children:v&&t}),o.jsx(c.Grid,{item:!0,xs:12,sx:{display:p||v&&!i?"inherit":"none"},children:o.jsx(c.TextField,{placeholder:"Password",fullWidth:!0,value:f??"",disabled:n.authLoading,inputRef:s,type:"password",onChange:k=>h(k.target.value)})}),o.jsx(c.Grid,{item:!0,xs:12,children:o.jsxs(c.Box,{sx:{display:v&&i?"none":"flex",justifyContent:"end",alignItems:"center",width:"100%"},children:[n.authLoading&&o.jsx(c.CircularProgress,{sx:{p:1},size:16,thickness:8}),o.jsx(c.Button,{type:"submit",children:S})]})})]})})})}function Us(e,n,r,t){return o.jsxs(o.Fragment,{children:[n.includes("google.com")&&o.jsx(We,{disabled:t,text:"Sign in with Google",icon:gA(),onClick:e.googleLogin}),n.includes("microsoft.com")&&o.jsx(We,{disabled:t,text:"Sign in with Microsoft",icon:yA(r),onClick:e.microsoftLogin}),n.includes("apple.com")&&o.jsx(We,{disabled:t,text:"Sign in with Apple",icon:pA(r),onClick:e.appleLogin}),n.includes("github.com")&&o.jsx(We,{disabled:t,text:"Sign in with Github",icon:bA(r),onClick:e.githubLogin}),n.includes("facebook.com")&&o.jsx(We,{disabled:t,text:"Sign in with Facebook",icon:vA(r),onClick:e.facebookLogin}),n.includes("twitter.com")&&o.jsx(We,{disabled:t,text:"Sign in with Twitter",icon:wA(r),onClick:e.twitterLogin})]})}const Hs=[ee.GoogleAuthProvider.PROVIDER_ID];function EA({name:e,logo:n,logoDark:r,toolbarExtraWidget:t,authentication:i,collectionOverrideHandler:s,collections:l,views:a,textSearchController:d,allowSkipLogin:u,signInOptions:f=Hs,firebaseConfig:h,onFirebaseInit:b,appCheckOptions:p,primaryColor:g,secondaryColor:v,fontFamily:w,dateTimeFormat:E,locale:x,HomePage:m,basePath:C,baseCollectionPath:B,LoginView:S,onAnalyticsEvent:k,fields:I={},plugins:F,autoOpenDrawer:T}){qt(e,n);const{firebaseApp:D,firebaseConfigLoading:P,configError:Q}=Ws({onFirebaseInit:b,firebaseConfig:h}),{appCheckLoading:K,getAppCheckToken:L}=zs({firebaseApp:D,options:p}),z=Os({firebaseApp:D,signInOptions:f}),H=Ms(),J=Gs({firebaseApp:D,textSearchController:d,fields:I}),O=$s({firebaseApp:D}),{authLoading:G,canAccessMainView:U,notAllowedError:V}=Vs({authController:z,authentication:i,getAppCheckToken:L,appCheckForceRefresh:p&&p.forceRefresh?p.forceRefresh:!1,dataSource:J,storageSource:O}),W=Ps(),j=A.useMemo(()=>Is({mode:W.mode,primaryColor:g,secondaryColor:v,fontFamily:w}),[w,W.mode,g,v]);return Q?o.jsx(Qn,{fullScreen:!0,children:Q}):P||!D||K?o.jsxs(o.Fragment,{children:[o.jsx(c.CssBaseline,{}),o.jsx(lo,{})]}):o.jsx(fe.BrowserRouter,{basename:C,children:o.jsx(Qs,{children:o.jsx(Qt,{value:W,children:o.jsx(Fs,{collections:l,views:a,authController:z,userConfigPersistence:H,collectionOverrideHandler:s,dateTimeFormat:E,dataSource:J,storageSource:O,entityLinkBuilder:({entity:_})=>`https://console.firebase.google.com/project/${D.options.projectId}/firestore/data/${_.path}/${_.id}`,locale:x,basePath:C,baseCollectionPath:B,onAnalyticsEvent:k,plugins:F,fields:I,children:({context:_,loading:M})=>{let N;if(M||G)N=o.jsx(lo,{});else{const q=W.mode==="dark"&&r?r:n;if(U)N=o.jsxs(ws,{name:e,logo:q,toolbarExtraWidget:t,autoOpenDrawer:T,children:[o.jsx(Ts,{HomePage:m}),o.jsx(cs,{})]});else{const $=S??Ns;N=o.jsx($,{logo:q,allowSkipLogin:u,signInOptions:f??Hs,firebaseApp:D,authController:z,notAllowedError:V})}}return o.jsxs(c.ThemeProvider,{theme:j,children:[o.jsx(c.CssBaseline,{enableColorScheme:!0}),N]})}})})})})}function mA(e,n){return console.debug("Performing Algolia query",e,n),e.search(n).then(({hits:r})=>r.map(t=>t.objectID)).catch(r=>(console.error(r),[]))}y.ArrayContainer=tt,y.ArrayContainerItem=it,y.ArrayEnumPreview=gn,y.ArrayEnumSelectBinding=Br,y.ArrayItemOptions=Es,y.ArrayOfMapsPreview=ni,y.ArrayOfReferencesFieldBinding=xi,y.ArrayOfReferencesPreview=ii,y.ArrayOfStorageComponentsPreview=li,y.ArrayOfStringsPreview=ai,y.ArrayOneOfPreview=ci,y.ArrayPropertyEnumPreview=cr,y.ArrayPropertyPreview=ar,y.AsyncPreviewComponent=Fa,y.BlockFieldBinding=Li,y.BooleanPreview=fi,y.BooleanSwitch=En,y.BreadcrumbUpdater=Vd,y.COLLECTION_PATH_SEPARATOR=vi,y.CenteredView=Qn,y.CircularProgressCenter=lo,y.ColorChip=sr,y.CustomDialogActions=Ze,y.DEFAULT_FIELD_CONFIGS=Ni,y.DatePreview=ui,y.DateTimeField=Dn,y.DateTimeFieldBinding=Pi,y.DebouncedTextField=Va,y.DeleteConfirmationDialog=Wd,y.DisabledTextField=Ti,y.Drawer=ys,y.DrawerNavigationItem=rt,y.EmptyValue=vo,y.EntityCollectionTable=Jr,y.EntityCollectionView=Kr,y.EntityForm=Yi,y.EntityPreview=zr,y.EntityReference=Pe,y.EnumValuesChip=Ie,y.ErrorBoundary=re,y.ErrorView=ue,y.ExpandablePanel=qe,y.FieldDescription=xe,y.FilledMenuItem=es,y.FilledSelect=Ri,y.FireCMS=Fs,y.FireCMSAppBar=Bs,y.FireCMSContextInstance=Kn,y.FireCMSHomePage=bs,y.FireCMSLogo=nt,y.FirebaseCMSApp=EA,y.FirebaseLoginView=Ns,y.FormikArrayContainer=xn,y.GeoPoint=Oo,y.ImagePreview=Zt,y.InfoLabel=zd,y.KeyValueFieldBinding=Oi,y.KeyValuePreview=Ai,y.LabelWithIcon=Ce,y.LoginButton=We,y.MapFieldBinding=Qi,y.MapPropertyPreview=di,y.Markdown=An,y.MarkdownFieldBinding=$i,y.ModeControllerProvider=Qt,y.NavigationCollectionCard=ot,y.NavigationGroup=Mn,y.NavigationRoutes=Ts,y.NotFoundPage=vs,y.NumberPropertyPreview=hi,y.PropertyFieldBinding=so,y.PropertyPreview=we,y.ReadOnlyFieldBinding=xr,y.ReferenceFieldBinding=Mi,y.ReferencePreview=je,y.ReferenceSelectionInner=gs,y.RepeatFieldBinding=Gi,y.RouteWrapper=Gn,y.Scaffold=ws,y.SelectFieldBinding=Cr,y.SideDialogs=cs,y.SkeletonPropertyComponent=no,y.SnackbarProvider=Qs,y.StorageThumbnail=Xt,y.StorageThumbnailInternal=Rt,y.StorageUploadFieldBinding=kr,y.StringPropertyPreview=lr,y.SwitchControl=Wa,y.SwitchFieldBinding=Di,y.TextFieldBinding=Bo,y.TextInput=zo,y.TextareaAutosize=Sr,y.UrlComponentPreview=Go,y.VirtualTable=Xi,y.addInitialSlash=ea,y.buildAdditionalFieldDelegate=AA,y.buildCollection=tA,y.buildEntityCallbacks=dA,y.buildEnumValueConfig=cA,y.buildEnumValues=aA,y.buildFieldConfig=uA,y.buildProperties=sA,y.buildPropertiesOrBuilder=lA,y.buildProperty=iA,y.canCreateEntity=Sn,y.canDeleteEntity=$r,y.canEditEntity=Lr,y.cmsToFirestoreModel=ko,y.collectionIconKeys=Vr,y.createCMSDefaultTheme=Is,y.deleteEntityWithCallbacks=Ht,y.firestoreToCMSModel=ao,y.fullPathToCollectionSegments=Ne,y.getBadgeForWidget=Bc,y.getBracketNotation=mc,y.getCollectionByPathOrAlias=rn,y.getCollectionPathsCombinations=tn,y.getColorForProperty=Ec,y.getDefaultValueFor=vn,y.getDefaultValueForDataType=gr,y.getDefaultValuesFor=Wo,y.getFieldConfig=mn,y.getFieldId=Qr,y.getHashValue=ur,y.getIcon=ji,y.getIconForProperty=ye,y.getIconForView=Fn,y.getIdIcon=Hi,y.getLastSegment=oa,y.getPropertyInPath=Or,y.getRandomId=_o,y.getReferenceFrom=io,y.getReferencePreviewKeys=Wr,y.getResolvedPropertyInPath=Gr,y.getValueInPath=Ye,y.hydrateRegExp=wi,y.isEmptyObject=hr,y.isHidden=Vo,y.isObject=bn,y.isPropertyBuilder=Me,y.isReadOnly=wo,y.isReferenceProperty=Ui,y.isValidRegExp=La,y.joinCollectionLists=Ta,y.mergeCollections=br,y.mergeDeep=$e,y.performAlgoliaTextSearch=mA,y.pick=gi,y.plural=kc,y.randomColor=Oa,y.randomString=xo,y.removeFunctions=Ar,y.removeInPath=Ia,y.removeInitialAndTrailingSlashes=ge,y.removeInitialSlash=Ot,y.removeTrailingSlash=Gt,y.removeUndefined=fr,y.renderSkeletonCaptionText=ha,y.renderSkeletonIcon=rr,y.renderSkeletonImageThumbnail=nr,y.renderSkeletonText=Le,y.resolveArrayProperty=Je,y.resolveCollection=ve,y.resolveCollectionPathAliases=Zn,y.resolveDefaultSelectedView=yr,y.resolveEnumValues=No,y.resolveNavigationFrom=_t,y.resolvePermissions=Uo,y.resolveProperties=Dr,y.resolveProperty=Te,y.resolvePropertyEnum=Pr,y.sanitizeData=bi,y.saveEntityWithCallbacks=er,y.segmentsToStrippedPath=yi,y.serializeRegExp=Ga,y.singular=Sc,y.sortProperties=vr,y.stripCollectionPath=wr,y.toKebabCase=Pa,y.toSnakeCase=Qa,y.traverseValueProperty=yn,y.traverseValuesProperties=pr,y.updateDateAutoValues=pi,y.useAuthController=eo,y.useBreadcrumbsContext=dn,y.useBrowserTitleAndIcon=qt,y.useBuildLocalConfigurationPersistence=Ms,y.useBuildModeController=Ps,y.useClearRestoreValue=Se,y.useClipboard=jt,y.useCollectionFetch=Ut,y.useDataSource=Fe,y.useDebounce=wn,y.useDebounceValue=$a,y.useEntityFetch=an,y.useFireCMSContext=oe,y.useFirebaseAuthController=Os,y.useFirebaseStorageSource=$s,y.useFirestoreDataSource=Gs,y.useInitialiseFirebase=Ws,y.useInitializeAppCheck=zs,y.useModeController=cn,y.useNavigationContext=pe,y.useReferenceDialog=Qo,y.useResolvedNavigationFrom=na,y.useSelectionController=Rr,y.useSideDialogContext=Pn,y.useSideDialogsController=Mo,y.useSideEntityController=He,y.useSnackbarController=_e,y.useStorageSource=po,y.useValidateAuthenticator=Vs,Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=index.umd.js.map
